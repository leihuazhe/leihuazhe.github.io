<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>枫叶|博客</title>
  <subtitle>承蒙时光不弃 感谢一切给予</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-08-27T06:46:34.940Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>YouJie Ray</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>springmvc 拦截器模板</title>
    <link href="http://yoursite.com/2017/08/27/springmvc-%E6%8B%A6%E6%88%AA%E5%99%A8%E6%A8%A1%E6%9D%BF/"/>
    <id>http://yoursite.com/2017/08/27/springmvc-拦截器模板/</id>
    <published>2017-08-27T06:36:51.000Z</published>
    <updated>2017-08-27T06:46:34.940Z</updated>
    
    <content type="html"><![CDATA[<p>关键点：’springmvc拦截器﻿‘</p>
<h4 id="需求"><a href="#需求" class="headerlink" title="需求﻿"></a>需求﻿</h4><p>我们用jquery ajax 请求 后台 用spring 拦截session 过期 </p>
<h6 id="1-过期则跳转指定页面-怎么弄呀"><a href="#1-过期则跳转指定页面-怎么弄呀" class="headerlink" title="1. 过期则跳转指定页面 怎么弄呀"></a>1. 过期则跳转指定页面 怎么弄呀</h6><h6 id="2-session的时候-ajax-有时候也会走error-方法-这个怎么写好呢"><a href="#2-session的时候-ajax-有时候也会走error-方法-这个怎么写好呢" class="headerlink" title="2.session的时候  ajax 有时候也会走error 方法 这个怎么写好呢 ﻿"></a>2.session的时候  ajax 有时候也会走error 方法 这个怎么写好呢 ﻿</h6><a id="more"></a>
<p>﻿<br>我们先了解一下一些必要的信息。ajax 请求和普通的 http 请求是不一样的，Ajax请求是XMLHTTPRequest对象发起的，而http请求是浏览器发起的。﻿</p>
<p>二者不同地方体现在HTTP请求的头信息中。﻿</p>
<p>AJAX请求头中带有X-Requested-With信息，其值为XMLHttpRequest。而普通请求是没有的。﻿</p>
<p>﻿﻿﻿﻿﻿﻿﻿﻿﻿</p>
<p>﻿</p>
<p>在拦截器中进行配置：﻿</p>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request,﻿</span></span></div><div class="line"><span class="function"><span class="params"></span></span></div><div class="line"><span class="function"><span class="params">HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;﻿</div><div class="line"></div><div class="line">﻿</div><div class="line">Oper oper =   (Oper)request.getSession().getAttribute(Const.SESSION_LOGIN_ADMIN_USER);﻿</div><div class="line"></div><div class="line">﻿</div><div class="line">String requestCTX = urlPathHelper.getContextPath(request);﻿</div><div class="line"></div><div class="line">System.out.println(requestCTX);﻿</div><div class="line"></div><div class="line">String requestUri = request.getRequestURI(); <span class="comment">//请求完整路径，可用于登陆后跳转﻿</span></div><div class="line"></div><div class="line">String contextPath = request.getContextPath();  <span class="comment">//项目下完整路径﻿</span></div><div class="line"></div><div class="line">String url = requestUri.substring(contextPath.length()); <span class="comment">//请求页面﻿</span></div><div class="line"></div><div class="line">logger.debug(<span class="string">"======拦截器配置成功======"</span>);﻿</div><div class="line"></div><div class="line">logger.debug(<span class="string">"======拦截来自："</span>+requestUri+<span class="string">"的请求======="</span>);﻿</div><div class="line"></div><div class="line">logger.debug(<span class="string">"======拦截的页面路径是：==："</span>+url+<span class="string">"======="</span>);﻿</div><div class="line"></div><div class="line"><span class="comment">//throw new Exception("登录超时!");﻿</span></div><div class="line"></div><div class="line">﻿</div><div class="line"><span class="keyword">if</span>(oper == <span class="keyword">null</span>)&#123;<span class="comment">//如果获取不到登录的session  ﻿</span></div><div class="line"></div><div class="line"><span class="comment">//如果是ajax请求﻿</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> (request.getHeader(<span class="string">"x-requested-with"</span>) != <span class="keyword">null</span>﻿</div><div class="line"></div><div class="line">&amp;&amp;﻿</div><div class="line"></div><div class="line">request.getHeader(<span class="string">"x-requested-with"</span>).equalsIgnoreCase(<span class="string">"XMLHttpRequest"</span>))&#123;﻿</div><div class="line"></div><div class="line">response.setHeader(<span class="string">"sessionstatus"</span>, <span class="string">"timeout"</span>); <span class="comment">// 响应头设置session状态﻿</span></div><div class="line"></div><div class="line"><span class="keyword">return</span> <span class="keyword">false</span>;  <span class="comment">//session超时，ajax访问返回false﻿</span></div><div class="line"></div><div class="line">&#125;﻿</div><div class="line"></div><div class="line">&#125;﻿</div><div class="line"></div><div class="line">﻿</div><div class="line"><span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response, handler);﻿</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>判断，如果session过期的话，进行上述设置﻿</p>
<p>然后再前端页面主js文件中进行统一设置，﻿</p>
<p>有了配置文件，也有了拦截器，在拦截器中已经设置了返回的信息，而这些信息会被 JavaScript 获取到。﻿</p>
<p>﻿</p>
<p>$.ajaxSetup方法是来设置AJAX请求默认选项的，﻿</p>
<p>我们可以认为是全局的选项设置，因此可以将这段代码提到外部js文件中，在需要的页面﻿</p>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">$.ajaxSetup(&#123;﻿</div><div class="line"></div><div class="line">type: <span class="string">'POST'</span>,﻿</div><div class="line"></div><div class="line">contentType:<span class="string">"application/x-www-form-urlencoded;charset=utf-8"</span>,﻿</div><div class="line"></div><div class="line">complete: function(xhr,status) &#123;﻿</div><div class="line"></div><div class="line">var sessionStatus = xhr.getResponseHeader(<span class="string">'sessionstatus'</span>);﻿</div><div class="line"></div><div class="line"><span class="keyword">if</span>(sessionStatus == <span class="string">'timeout'</span>) &#123;﻿</div><div class="line"></div><div class="line"><span class="comment">//var top = getTopWinow();﻿</span></div><div class="line"></div><div class="line"><span class="comment">//var yes = confirm('由于您长时间没有操作, session已过期, 请重新登录.');﻿</span></div><div class="line"></div><div class="line"><span class="comment">//if (yes) &#123;﻿</span></div><div class="line"></div><div class="line">alert(<span class="string">"登录超时,请重新登录！"</span>);﻿</div><div class="line"></div><div class="line">window.location.href = <span class="string">'/admin/login/out.do'</span>;﻿</div><div class="line"></div><div class="line"><span class="comment">//&#125;﻿</span></div><div class="line"></div><div class="line">&#125;﻿</div><div class="line"></div><div class="line">&#125;﻿</div><div class="line"></div><div class="line">&#125;);﻿</div><div class="line"></div><div class="line"><span class="comment">/**﻿</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">* 在页面中任何嵌套层次的窗口中获取顶层窗口﻿</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">* <span class="doctag">@return</span> 当前页面的顶层窗口对象﻿</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span>﻿</div><div class="line"></div><div class="line"><span class="function">function <span class="title">getTopWinow</span><span class="params">()</span></span>&#123;﻿</div><div class="line"></div><div class="line">var p = window;﻿</div><div class="line"></div><div class="line"><span class="keyword">while</span>(p != p.parent)&#123;﻿</div><div class="line"></div><div class="line">p = p.parent;﻿</div><div class="line"></div><div class="line">&#125;﻿</div><div class="line"></div><div class="line"><span class="keyword">return</span> p;﻿</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>本章完</p>
<p>﻿</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关键点：’springmvc拦截器﻿‘&lt;/p&gt;
&lt;h4 id=&quot;需求&quot;&gt;&lt;a href=&quot;#需求&quot; class=&quot;headerlink&quot; title=&quot;需求﻿&quot;&gt;&lt;/a&gt;需求﻿&lt;/h4&gt;&lt;p&gt;我们用jquery ajax 请求 后台 用spring 拦截session 过期 &lt;/p&gt;
&lt;h6 id=&quot;1-过期则跳转指定页面-怎么弄呀&quot;&gt;&lt;a href=&quot;#1-过期则跳转指定页面-怎么弄呀&quot; class=&quot;headerlink&quot; title=&quot;1. 过期则跳转指定页面 怎么弄呀&quot;&gt;&lt;/a&gt;1. 过期则跳转指定页面 怎么弄呀&lt;/h6&gt;&lt;h6 id=&quot;2-session的时候-ajax-有时候也会走error-方法-这个怎么写好呢&quot;&gt;&lt;a href=&quot;#2-session的时候-ajax-有时候也会走error-方法-这个怎么写好呢&quot; class=&quot;headerlink&quot; title=&quot;2.session的时候  ajax 有时候也会走error 方法 这个怎么写好呢 ﻿&quot;&gt;&lt;/a&gt;2.session的时候  ajax 有时候也会走error 方法 这个怎么写好呢 ﻿&lt;/h6&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2017/08/27/hello-world/"/>
    <id>http://yoursite.com/2017/08/27/hello-world/</id>
    <published>2017-08-27T05:04:21.468Z</published>
    <updated>2017-08-27T05:04:21.468Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
    
    </summary>
    
    
  </entry>
  
</feed>
