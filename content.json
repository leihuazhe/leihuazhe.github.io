{"pages":[{"title":"404 Not Foundï¼šè¯¥é¡µæ— æ³•æ˜¾ç¤º","text":"å›ä¸»é¡µ Â· æ‰€æœ‰æ–‡ç«  Â· ç•™è¨€æ¿ å¯åœ¨è¾¹æ æœç´¢æ¡†ä¸­å¯¹æœ¬ç«™è¿›è¡Œæ£€ç´¢ï¼Œä»¥è·å–ç›¸å…³ä¿¡æ¯ã€‚ ä»¥ä¸‹æ˜¯åšä¸»å–œæ¬¢çš„ä¸€äº›æ­Œæ›²ï¼Œå¯ä»¥å¬å¬ï¼Œç¨ä½œä¼‘æ¯~ .article-meta { display: none; } #container .article .article-title { padding-right: 0; } .article-header { padding: 0; padding-top: 26px; border-left: none; text-align: center; } .article-header:hover { border-left: none; } .article-title { font-size: 1.6em } .article-entry hr { margin: 0;} .article-meta, #container .article-info-post.article-info { display: none;} #container .article .article-title { padding: 0; } .article-title { font-size: 2.1em; } strong a { color: #747474; } .player { margin-left: -10px; } .sign { text-align: right; font-style: italic; } .share, #page-visit, .visit span:nth-child(2), .pic br { display: none; } .center { text-align: center; height: 2.5em; font-weight: bold; } .search2 { height: 2.2em; font-size: 1em; width: 50%; margin: auto 24%; color: #727272; opacity: .6; border: 2px solid lightgray; } .search2:hover { opacity: 1; box-shadow: 0 0 10px rgba(0, 0, 0, 0.3) }; .article-entry hr { margin: 0; } .pic { text-align: center; margin: 0; }","link":"/404.html"},{"title":"æ‰€æœ‰çš„ç›¸é‡ï¼Œéƒ½æ˜¯æ—©æœ‰é¢„è°‹çš„é‡é€¢","text":"é˜¿é‡Œæ„Ÿæ‚Ÿ spring boot-æ•´åˆCAS Clientå®ç°å•ç‚¹ç™»é™†éªŒè¯ ä½¿ç”¨tokenæ€ä¹ˆåšæƒé™æ§åˆ¶çš„å‘¢ï¼Ÿ è®¾è®¡æ¨¡å¼æ€»ç»“ å¦‚ä½•æ­£ç¡®æ¥æ”¶ GitHub çš„æ¶ˆæ¯é‚®ä»¶ Angular CLI ä½¿ç”¨æ•™ç¨‹æŒ‡å—å‚è€ƒ","link":"/share/index.html"},{"title":"å…³äºæˆ‘","text":"å¬ä¼šå„¿æ­Œå§ console.error(\"ReferenceError: value is not defined\"); ä¸ªäººä¿¡æ¯ æˆ‘æ˜¯ä¸€å Java å¼€å‘è€…,ä¸“æ³¨äºåç«¯å¼€å‘,æœ¬åšå®¢å°†ä¼šåˆ†äº«æˆ‘çš„å­¦ä¹ æ‰€å¾—ã€‚ è”ç³»æ–¹å¼ emailï¼š295482300@qq.com å…³æ³¨æˆ‘ GitHub ç®€ä¹¦ åšå®¢å›­","link":"/about/index.html"},{"title":"æˆ‘æƒ³å°±è¿™æ ·ç‰µç€ä½ çš„æ‰‹ä¸æ”¾","text":"å›¾ç‰‡ç½‘ç«™ wall haven unsplash å›¾ç‰‡å‹ç¼© compressjpeg å¼€å‘å·¥å…·ç±» å‰ç«¯åœ¨çº¿å·¥å…· CSSé€ŸæŸ¥ CSSä¸‰è§’ç”Ÿæˆ CSSé€æ˜æ•ˆæœè½¬æ¢ CSS3åŠ¨ç”»å·¥å…· CSS3æ°”æ³¡å¯¹è¯æ¡†ç”Ÿæˆ CSSé˜´å½±è¾¹æ¡†ç”Ÿæˆ CSSå¼¹æ€§å¸ƒå±€flex JSè§£å‹ç¼©å·¥å…· HTMLè½¬JS æ­£åˆ™è¡¨è¾¾å¼ JSONè½¬æ¢å·¥å…· CSSè§£å‹ç¼©å·¥å…· å›¾ç‰‡è½¬Base64ç¼–ç  åœ¨çº¿äºŒç»´ç ç”Ÿæˆ HTMLè½¬æ¢JSå­—ç¬¦ä¸² W3Cåœ¨çº¿å·¥å…·é›† faviconå›¾æ ‡ç”Ÿæˆ ä»£ç ç€è‰²","link":"/tools/index.html"},{"title":"å…³äºæˆ‘","text":"ä¸ªäººä¿¡æ¯ æˆ‘æ˜¯ä¸€å Java å¼€å‘è€…,ä¸“æ³¨äºåç«¯å¼€å‘,æœ¬åšå®¢å°†ä¼šåˆ†äº«æˆ‘çš„å­¦ä¹ æ‰€å¾—ã€‚ è”ç³»æ–¹å¼ emailï¼š295482300@qq.com å…³æ³¨æˆ‘ GitHub ç®€ä¹¦ åšå®¢å›­ ä¼˜é€‰éŸ³ä¹","link":"/about/backup.html"}],"posts":[{"title":"Angularå­¦ä¹ ï¼ˆä¸€ï¼‰ Hello World","text":"Angular-Cli çš„å®‰è£…ä¸ä½¿ç”¨1.node.jsç¯å¢ƒéœ€è¦æœ‰npmåŒ…ç®¡ç†å·¥å…·ï¼Œç”±äºnpmæ˜¯å›½å¤–èµ„æºï¼Œå¯èƒ½ç§ç§åŸå› å¯¼è‡´npmå®‰è£…æ¯”è¾ƒæ…¢ï¼Œè¿™é‡Œæˆ‘ä»¬é‡‡ç”¨æ·˜å®çš„npmé•œåƒ 1npm install cnpm -g --registry=https://registry.npm.taobao.org ç„¶åé‡‡ç”¨cnpmå®‰è£…angular-cli 1cnpm install -g @angular/cli || cnpm install -g @angular/cli@latest å®‰è£…å®Œæˆä¹‹åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½åæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯ 1ng version 2.åˆ›å»ºangularé¡¹ç›®æˆ‘ä»¬é‡‡ç”¨å…ˆåˆ›å»ºé¡¹ç›®ï¼Œå†ç”¨cpmä¸‹è½½æ¨¡å—çš„æ–¹å¼åˆ›å»ºangularé¡¹ç›®ï¼Œè¿™æ ·é€Ÿåº¦æ¯”è¾ƒå¿«ã€‚ 1ng new my-app --skip install é€šè¿‡åé¢è¿™ä¸ªå‚æ•°ï¼Œå…ˆä¸å®‰è£…æ¨¡å— 12cd my-appcnpm install ç„¶åå¯åŠ¨ 1ng server || ng serve --host 0.0.0.0 --port 4201 ||ng serve --port 4201 è®¿é—®æµè§ˆå™¨ 1localhost:4200 3.Cliå¸¸ç”¨æŒ‡ä»¤1ng help å¯ä»¥æŸ¥çœ‹å„ç§æŒ‡ä»¤çš„ä¿¡æ¯API 1ng new my-app æ–°å»ºä¸€ä¸ªé¡¹ç›® å‚æ•°åˆ†ç±» --dry-run åªæŠŠåˆ›å»ºç¯èŠ‚èµ°ä¸€éï¼Œä¸ä¼šäº§ç”Ÿä»»ä½•æ–‡ä»¶ä¹‹ç±»ã€‚--prefix ç”¨Cliåˆ›å»ºç»„ä»¶Component,å‘½ä»¤å¦‚ä¸‹ï¼š 1ng g component test åˆ›å»ºç»„ä»¶test åˆ›å»ºService, åˆ›å»ºçš„serviceè¦åœ¨æ ¹moduleä¸Šè¿›è¡Œæ³¨å†Œ, è¿™é‡Œç”¨ -mæ¥è¿›è¡Œæ³¨å†Œ 1ng g service test -m src/app/app.module.ts åˆ›å»ºæœåŠ¡ï¼Œå¹¶ä¸”åœ¨æ ¹moduleä¸Šæ³¨å†Œ æ‰“åŒ…å‘½ä»¤ 1ng build å¤§æ¦‚4Må·¦å³ 1ng build -aot é¢„ç¼–è¯‘ å‹ç¼© 2.9M 1ng build -prod ç”Ÿäº§ç¯å¢ƒ å‹ç¼© 404k 4.helloworldå·¥ç¨‹ 5.å·¥ç¨‹ç›®å½•è¯´æ˜ package.jsonï¼šç”¨æ¥æ ‡è®°å‡ºæœ¬é¡¹ç›®æ‰€éœ€çš„ npm ä¾èµ–åŒ…ã€‚ tsconfig.jsonï¼šå®šä¹‰äº† TypeScript ç¼–è¯‘å™¨å¦‚ä½•ä»é¡¹ç›®æºæ–‡ä»¶ç”Ÿæˆ JavaScript ä»£ç ã€‚ typings.jsonï¼šä¸ºé‚£äº› TypeScript ç¼–è¯‘å™¨æ— æ³•è¯†åˆ«çš„åº“æä¾›äº†é¢å¤–çš„å®šä¹‰æ–‡ä»¶ã€‚ webpack.config.jsï¼šä¸ºæ„å»ºAngularåº”ç”¨æ‰€è¿›è¡Œçš„ä¸€ç³»åˆ—webpacké…ç½®ã€‚ karma.conf.jsï¼šKarmaå•å…ƒæµ‹è¯•é…ç½®ã€‚ æˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™ä¸»è¦å°±æ˜¯åœ¨src/appæ–‡ä»¶ä¸­ï¼ˆè¿™ä¸ªå‰é¢æœ‰æåˆ°è¿‡ï¼‰ src/app/app.component.tsï¼š è¿™ä¸ªå°±æ˜¯å¤„ç†ç»„ä»¶ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ã€‚ src/app/app.component.htmlï¼š è¿™ä¸ªå°±æ˜¯ç¼–å†™ç»„ä»¶çš„é¡µé¢çš„htmlçš„åœ°æ–¹ã€‚ src/app/app.component.cssï¼š è¿™ä¸ªå°±æ˜¯é¡µé¢çš„æ ·å¼ç¼–è¾‘æ–‡ä»¶ã€‚ src/app/app.module.tsï¼š æ ¹æ¨¡å—æ–‡ä»¶ï¼Œç”¨æ¥å¯åŠ¨é¡¹ç›®çš„æ–‡ä»¶ã€‚ src/app/app.component.spec.tsï¼š ç”¨äºå•å…ƒæµ‹è¯•ã€‚ï¼ˆå¯é€‰ï¼‰ã€‚ å…·ä½“å…¶ä»–çš„æ–‡ä»¶æˆ–è€…é…ç½®é¡¹åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹çš„README.mdä¸­æœ‰è§£é‡Šã€‚ â€“ end â€“","link":"/p/e3e0b9b4.html"},{"title":"APPæ¥å£å®‰å…¨TOKENè®¾è®¡","text":"ä½ æ˜¯å¦çœŸçš„éœ€è¦ç™»å½•åŠŸèƒ½ï¼ŸæŠŠè¿™ä¸ªé—®é¢˜æ”¾åœ¨æœ€å‰é¢å¹¶ä¸æ˜¯çŒæ°´ï¼Œè€Œæ˜¯çœŸçš„è§è¿‡å¾ˆå¤šå¹¶ä¸éœ€è¦ç™»å½•çš„APPå»åšäº†ç™»å½•åŠŸèƒ½ï¼Œæˆ–è€…æ˜¯å¹¶ä¸éœ€è¦å¼ºåˆ¶ç™»å½•çš„APPæŠŠç™»å½•ä½œä¸ºå¯åŠ¨é¡µã€‚ç”¨æˆ·å¯¹ä½ çš„APPä¸€æ— æ‰€çŸ¥ï¼Œä½ å°±è¦æ±‚å¯¹æ–¹æ³¨å†Œå¹¶ç™»å½•ï¼Œé™¤éAPPæœ¬èº«å·²ç»å¾ˆæœ‰åæ°”æˆ–è€…æ˜¯ç”¨æˆ·æœ‰å¼ºéœ€æ±‚ï¼Œå¦åˆ™æ­£å¸¸äººåº”è¯¥ä¼šç›´æ¥æŠŠå®ƒåˆ æ‰ã€‚æ¯”è¾ƒæ¸©å’Œçš„æ–¹å¼æ˜¯å°†ä¸€äº›å¹¶ä¸éœ€è¦ç™»å½•ï¼Œä½†å¯ä»¥ç»™ç”¨æˆ·å¸¦æ¥å¸®åŠ©çš„ä¸œè¥¿ï¼Œç¬¬ä¸€æ—¶é—´å±•ç°ç»™ä»–ä»¬ï¼Œè®©ä»–ä»¬äº§ç”Ÿå…´è¶£ï¼Œå†åœ¨åˆé€‚çš„æ—¶æœºå¼•å¯¼ä»–ä»¬æ³¨å†Œï¼ˆæ¯”å¦‚ä½¿ç”¨éœ€è¦ä½¿ç”¨æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œæˆ–ç”¨æˆ·éœ€è¦æ”¶è—æŸä¸ªå–œæ¬¢çš„ä¿¡æ¯æ—¶ï¼‰ã€‚ ç™»å½•å’Œæ³¨å†Œè¦è¶³å¤Ÿç®€å•è¿™æ˜¯å°å°çš„æ‰‹æœºç«¯ï¼Œç”¨å†å¥½çš„è¾“å…¥æ³•ï¼Œæ‰“å­—ä¹Ÿæ˜¯ä¸æ–¹ä¾¿çš„ï¼Œæ‰€ä»¥åˆ«æŠŠç™»å½•é¡µè®¾è®¡å¾—éœ€è¦å¡«å¾ˆå¤šä¸œè¥¿ã€‚å¦‚æœæœ‰å¯èƒ½çš„è¯ï¼Œåªå¡«æ‰‹æœºå·ï¼Œè®©ç”¨æˆ·æ”¶åˆ°çŸ­ä¿¡éªŒè¯ç å°±å®Œæˆæ³¨å†Œæ˜¯æœ€å¥½ä¸è¿‡çš„äº†ã€‚æƒ³è·å¾—æ›´å¤šä¿¡æ¯ï¼Ÿæƒ³æƒ³å¤§å…¬å¸çš„APPæ˜¯æ€ä¹ˆåšçš„ï¼Œä»–ä»¬ä¼šå‘Šè¯‰ç”¨æˆ·ï¼Œç°åœ¨çš„ä¸ªäººèµ„æ–™å®Œå–„ç¨‹åº¦æ˜¯30%ï¼Œå¦‚æœæƒ³è·å¾—æ›´å¤šç§¯åˆ†ï¼Œä½ éœ€è¦å¡«å®Œã€‚tips:å¦‚æœä½ æƒ³å‘å¸ƒåœ¨Appstoreå¹¶ä¸”åŒæ—¶åŒ…å«æ³¨å†ŒåŠŸèƒ½ï¼Œé‚£ä¹ˆæ³¨å†Œé¡µé¢å¿…é¡»åšä¸€ä¸ªç”¨æˆ·è®¸å¯åè®®çš„é“¾æ¥ï¼Œå¦åˆ™æœ‰å¯èƒ½é€šä¸è¿‡å®¡æ ¸ã€‚ å®ç°ç™»å½•åçš„sessionæœ‰å‡ ç§æ–¹å¼ï¼ŸAPPå½“æµè§ˆå™¨ç”¨ï¼Œç›´æ¥è½½å…¥è¿œç¨‹é¡µé¢è¿™ç§æƒ…å†µæ˜¯å¾ˆå¤šå·æ‡’çš„ç¨‹åºå‘˜æˆ–è€…å‚»Xçš„è€æ¿é€‰æ‹©çš„æ–¹å¼ï¼Œå› ä¸ºåšèµ·æ¥å®åœ¨å¤ªå¿«ã€‚å¦‚æœæœ¬èº«ç½‘ç«™æ˜¯å“åº”å¼å¸ƒå±€ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½ä¸éœ€è¦åšä»€ä¹ˆæ›´æ”¹ï¼Œå°±åªè¦åœ¨å¼€å‘æ—¶æ‰“å¼€é¦–é¡µå°±å¥½äº†ï¼Œè¿™æ ·Hybirdçš„APPå¤–å£³å°±çº¯ç²¹æˆä¸ºäº†ä¸€ä¸ªæµè§ˆå™¨ã€‚ä½†æ¯”èµ·è¿™æ ·åšå¸¦æ¥çš„æ— æ•°ç¼ºç‚¹æ¥ï¼Œå¼€å‘é€Ÿåº¦å¿«çš„ä¼˜ç‚¹å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚é¦–å…ˆï¼Œåœ¨ç½‘ç»œç¯å¢ƒä¸ä½³æ—¶ï¼Œçº¯å¤§ç™½é¡µï¼Œç”¨æˆ·ä½“éªŒ0ï¼›ç„¶åï¼ŒCSSå’ŒJSç­‰èµ„æºä¸åœ¨æœ¬åœ°ï¼Œéœ€è¦è¿œç¨‹è½½å…¥ï¼Œå¦‚æœä½¿ç”¨äº†bootstrapä¹‹ç±»çš„æ¡†æ¶ï¼Œé‚£ç”¨æˆ·ä¸ºäº†å¼€ä¸€ä¸‹APPè€Œè€—è´¹çš„æµé‡çœŸæ˜¯ä»¤äººæ„ŸåŠ¨ï¼›å†ç„¶åï¼Œç½‘é¡µé‡Œå¸¸ç”¨çš„jqueryï¼Œåœ¨æ‰‹æœºçš„webviewé‡Œé€Ÿåº¦å¹¶ä¸ç†æƒ³ï¼Œè€Œå¦‚æœæ˜¯éajaxçš„ç½‘é¡µé‚£å°±æ›´ç³Ÿå¿ƒäº†ï¼Œæ¯æ¬¡æ“ä½œéƒ½è¦è·³è½¬å’Œé¡µé¢æ¸²æŸ“ï¼Œè¦è®©äººæŠŠå®ƒå½“æˆAPPé‚£å®åœ¨æ˜¯ç¬‘è¯ã€‚å†å†ç„¶åï¼Œè¿™æ ·çš„æ‰€è°“APPï¼Œè¦é€šè¿‡Appstoreçš„å®¡æŸ¥ï¼Œé‚£æ˜¯åšæ¢¦çš„ï¼ˆé™¤éå®¡æ ¸å‘˜å½“å¤©é—¹è‚šå­ä¸¥é‡ï¼Œæ‹¿ç€çº¸å·¾å¥”å‘å•æ‰€å‰è¯¯ç‚¹äº†é€šè¿‡â€¦â€¦ï¼‰ï¼Œè‹¹æœçš„è¦æ±‚æ˜¯ï¼Œè¿™å¾—æ˜¯APPï¼Œè€Œä¸èƒ½æ˜¯æŸä¸ªç½‘ç«™åšæˆAPPçš„æ ·å­ï¼Œé‚£æ ·çš„æƒ…å†µé€‚åˆåšWeb APPã€‚è€Œæ®æˆ‘æ‰€çŸ¥ï¼Œå›½å†…å‡ ä¸ªè¾ƒå¤§çš„Androidå¸‚åœºï¼Œè¿™æ ·çš„APPä¹Ÿæ˜¯æ— æ³•é€šè¿‡å®¡æ ¸çš„ã€‚ è°ƒç”¨åç«¯æ¥å£è¿™æ˜¯ä¸ªå¾ˆå¥½çš„æ—¶ä»£ï¼Œå› ä¸ºæ— è®ºåç«¯ä½ æ˜¯ç”¨Javaã€PHPï¼Œè¿˜æ˜¯node.jsï¼Œéƒ½å¯ä»¥é€šè¿‡xmlã€jsonæ¥å’ŒAPPé€šè®¯ã€‚æŠŠåˆšæ‰é‚£ä¸ªç”¨APPå½“æµè§ˆå™¨ä½¿çš„æ¡ˆä¾‹çš„æ‰€æœ‰ç¼ºç‚¹åè¿‡æ¥çœ‹ï¼Œå°±æ˜¯è¿™æ ·åšçš„ä¼˜ç‚¹ï¼Œåœ¨ä¼˜åŒ–å®Œå–„çš„æƒ…å†µä¸‹ä½“éªŒæ¥è¿‘åŸç”Ÿï¼Œè€Œä¸”é€šè®¯æµé‡æå°‘ï¼Œé€šè¿‡å„ç§å®¡æ ¸ä¹Ÿæ˜¯å¦¥å¦¥çš„ã€‚tips:é€šè¿‡pluså¯¹è±¡ä¸­çš„XMLHttpRequestæ¥Getã€Postè¿œç¨‹çš„åç«¯æ¥å£ï¼Œæˆ–è€…ä½¿ç”¨Muiä¸­å°è£…å¥½çš„AJAXç›¸å…³å‡½æ•°ã€‚ æ’ä¸€æ®µä»£ç ï¼Œæˆ‘æŠŠmuiçš„ajaxåˆåšäº†è¿›ä¸€æ­¥çš„å°è£…ï¼Œå¯¹è¶…æ—¶è¿›è¡Œäº†è‡ªåŠ¨é‡è¯•ï¼Œè€Œå¯¹invalid_tokenç­‰æƒ…å†µä¹Ÿåšç›¸åº”å¤„ç†ï¼š 12345678910111213141516171819202122232425mui.web_query = function(func_url, params, onSuccess, onError, retry){ var onSuccess = arguments[2]?arguments[2]:function(){}; var onError = arguments[3]?arguments[3]:function(){}; var retry = arguments[4]?arguments[4]:3; func_url = 'http://www.xxxxxx.com/ajax/?fn=' + func_url; mui.ajax(func_url, { data:params, dataType:'json', type:'post', timeout:3000, success:function(data){ if(data.err === 'ok'){ onSuccess(data); } else{ onError(data.code); } }, error:function(xhr,type,errorThrown){ retry--; if(retry &gt; 0) return mui.web_query(func_url, params, onSuccess, onError, retry); onError('FAILED_NETWORK'); } })}; 123456789101112131415var onError = function(errcode){ switch(errcode){ case 'FAILED_NETWORK': mui.toast('ç½‘ç»œä¸ä½³'); break; case 'INVALID_TOKEN': wv_login.show(); break; default: console.log(errcode); }};var params = {per:10, pageno:coms_current_pageno};mui.web_query('get_com_list', params, onSuccess, onError, 3); è°ƒç”¨åç«¯æ¥å£æ€ä¹ˆæ ·æ‰å®‰å…¨ï¼Ÿåœ¨APPä¸­ä¿å­˜ç™»å½•æ•°æ®ï¼Œæ¯æ¬¡è°ƒç”¨æ¥å£æ—¶ä¼ è¾“ç¨‹åºå‘˜æ€»èƒ½ç»™è‡ªå·±æ‰¾åˆ°å·æ‡’çš„æ–¹æ³•ï¼Œæœ‰çš„ç¨‹åºä¸ºäº†çœäº‹ï¼Œä¼šåœ¨ç”¨æˆ·ç™»å½•åï¼Œç›´æ¥æŠŠç”¨æˆ·åå’Œå¯†ç ä¿å­˜åœ¨æœ¬åœ°ï¼Œç„¶åæ¯æ¬¡è°ƒç”¨åç«¯æ¥å£æ—¶ä½œä¸ºå‚æ•°ä¼ é€’ã€‚çœŸçœäº‹å„¿å•Šï¼å¯è¿™ç§æ–¹æ³•ç®€å•å°±åƒæ‹¿ç€ä¸€è¢‹å­é’±åœ¨è·¯ä¸Šè¾¹èµ°è¾¹å–Šâ€œå¿«æ¥æŠ¢æˆ‘å‘€ï¼å¿«æ¥æŠ¢æˆ‘å‘€ï¼â€ï¼Œä¸€ä¸ªå°å°çš„å—…æ¢å™¨å°±èƒ½æŠŠç”¨æˆ·çš„å¯†ç æ‹¿åˆ°æ‰‹ï¼Œå¦‚æœç”¨æˆ·ä¹ æƒ¯åœ¨æ‰€æœ‰åœ°æ–¹ç”¨ä¸€ä¸ªå¯†ç ï¼Œé‚£ä¹ˆä½ é—¯å¤§ç¥¸äº†ï¼Œé»‘å®¢é€šè¿‡æ’åº“çš„æ–¹æ³•èƒ½æŠŠç”¨æˆ·çš„æ‰€æœ‰ä¿¡æ¯ä¸€é”…ç«¯ã€‚ ç™»å½•æ—¶è¯·æ±‚ä¸€æ¬¡tokenï¼Œä¹‹åç”¨tokenè°ƒç”¨æ¥å£è¿™æ˜¯æ¯”è¾ƒå®‰å…¨çš„æ–¹å¼ï¼Œç”¨æˆ·åœ¨ç™»å½•æ—¶ï¼ŒAPPè°ƒç”¨è·å–tokençš„æ¥å£ï¼ˆæ¯”å¦‚http://api.abc.com/get_token/ï¼‰ï¼Œç”¨postå°†ç”¨æˆ·åå’Œå¯†ç çš„æ‘˜è¦ä¼ é€’ç»™æœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨æ¯”å¯¹æ•°æ®åº“ä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒ¹é…åˆ™è¿”å›ç»‘å®šè¯¥ç”¨æˆ·çš„tokenï¼ˆè¿™ä¸€èˆ¬ç¿»è¯‘ä¸ºä»¤ç‰Œï¼Œå¾ˆç›´è§‚çš„åå­—ï¼Œä¸€çœ‹å°±çŸ¥é“æ˜¯æœ‰äº†è¿™ç©æ„ï¼Œå°±ä¼šå¯¹ä½ æ”¾è¡Œï¼‰ï¼Œè€Œæ•°æ®åº“ä¸­ï¼Œåœ¨ç”¨æˆ·çš„tokenè¡¨ä¸­ä¹ŸåŒæ—¶æ’å…¥äº†è¿™ä¸ªtokenç›¸å…³çš„æ•°æ®ï¼šè¿™ä¸ªtokenå±äºè°ï¼Ÿè¿™ä¸ªtokençš„æœ‰æ•ˆæœŸæ˜¯å¤šä¹…ï¼Ÿè¿™ä¸ªtokenå½“å‰ç™»å½•çš„ipåœ°å€æ˜¯ï¼Ÿè¿™ä¸ªtokenå¯¹åº”çš„deviceidæ˜¯ï¼Ÿâ€¦â€¦è¿™æ ·å³ä¾¿tokenè¢«æœ‰å¿ƒäººæˆªè·ï¼Œä¹Ÿä¸ä¼šé€ æˆå¤ªå¤§çš„å®‰å…¨é£é™©ã€‚å› ä¸ºæ²¡æœ‰ç”¨æˆ·åå’Œå¯†ç ï¼Œç„¶åå¦‚æœé»‘å®¢é€šè¿‡è¿™ä¸ªtokenä¼ªé€ ç”¨æˆ·è¯·æ±‚ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡å™¨ç«¯æ¥å£è¢«è°ƒç”¨æ—¶å°±å¯ä»¥å¯¹å‘èµ·è¯·æ±‚çš„ipåœ°å€ã€user-agentä¹‹ç±»çš„ä¿¡æ¯ä½œæ¯”å¯¹ï¼Œä»¥é˜²æ­¢ä¼ªé€ ã€‚å†ç„¶åï¼Œå¦‚æœtokençš„æœ‰æ•ˆæœŸè®¾å¾—å°ï¼Œè¿‡ä¸€ä¼šå„¿å®ƒå°±è¿‡æœŸäº†ï¼Œé™¤éé»‘å®¢å¯ä»¥æŒç»­æˆªè·ä½ çš„tokenï¼Œå¦åˆ™ä»–åªèƒ½å¹²çªçœ¼ã€‚ï¼ˆæ’ä¸€å¥é¢˜å¤–è¯ï¼šçœ‹åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯æ˜ç™½ä¸ºä»€ä¹ˆä¸æ¨èåœ¨å¤–é¢éšä¾¿æ¥å…¥æ¥å†ä¸æ˜çš„wifiçƒ­ç‚¹äº†ï¼Ÿï¼‰tips:tokenå¦‚ä½•ç”Ÿæˆï¼Ÿ å¯ä»¥æ ¹æ®ç”¨æˆ·çš„ä¿¡æ¯åŠä¸€äº›éšæœºä¿¡æ¯ï¼ˆæ¯”å¦‚æ—¶é—´æˆ³ï¼‰å†é€šè¿‡hashç¼–ç ï¼ˆæ¯”å¦‚md5ã€sha1ç­‰ï¼‰ç”Ÿæˆå”¯ä¸€çš„ç¼–ç ã€‚tips:tokençš„å®‰å…¨çº§åˆ«ï¼Œå–å†³äºä½ çš„å®é™…éœ€æ±‚ï¼Œæ‰€ä»¥å¦‚æœä¸æ˜¯æ¶‰åŠè´¢äº§å®‰å…¨çš„é¢†åŸŸï¼Œå¹¶ä¸å»ºè®®å¤ªä¸¥æ ¼ï¼ˆæ¯”å¦‚ç”¨æˆ·èµ°ç€èµ°ç€ï¼Œ3Gæ¢äº†ä¸ªåŸºç«™ï¼Œé—ªæ–­äº†ä¸€ä¸‹IPåœ°å€å˜äº†ï¼Œå°¼ç›tokenè¿‡æœŸäº†ï¼Œè¿™å°±å±äºä¸ºäº†ä¸å¿…è¦çš„å®‰å…¨ä¸¢äº†ç”¨æˆ·ä½“éªŒï¼Œå½“ç„¶å¦‚æœå˜æ¢çš„IPåœ°å€è·¨çœçš„è¯è¿˜æ˜¯åº”è¯¥éªŒè¯ä¸€ä¸‹çš„ï¼Œæƒ³æƒ³QQæœ‰æ—¶å€™ä¼šè®©å¡«éªŒè¯ç å°±æ˜ç™½äº†ï¼‰ã€‚tips:æ¥å£åœ¨è¿”å›ä¿¡æ¯æ—¶ï¼Œå¯ä»¥åŒ…å«æœ¬æ¬¡è¯·æ±‚çš„çŠ¶æ€ï¼Œæ¯”å¦‚æˆåŠŸè°ƒç”¨ï¼Œé‚£ä¹ˆresult[â€˜statusâ€™]å¯èƒ½å°±æ˜¯â€™successâ€™ï¼Œè€Œåä¹‹åˆ™æ˜¯â€™errorâ€™ï¼Œè€Œå¦‚æœæ˜¯â€™errorâ€™ï¼Œåˆ™result[â€˜errcodeâ€™]ä¸­å°±å¯ä»¥åŒ…å«é”™è¯¯çš„åŸå› ï¼Œæ¯”å¦‚errcodeä¸­æ˜¯â€™invalid_tokenâ€™å°±å¯ä»¥å‘Šè¯‰APPè¿™ä¸ªtokenè¿‡æœŸæˆ–æ— æ•ˆï¼Œè¿™æ—¶APPåº”å¼¹å‡ºç™»å½•æ¡†æˆ–è€…ç”¨æœ¬åœ°å­˜å‚¨çš„ç”¨æˆ·åæˆ–å¯†ç å†æ¬¡è¯·æ±‚tokenï¼ˆç”¨æˆ·é€‰æ‹©â€œè®°ä½å¯†ç â€ï¼Œå°±åº”è¯¥åœ¨æœ¬åœ°ä¿å­˜ç”¨æˆ·åå’Œå¯†ç çš„æ‘˜è¦ï¼Œæ–¹æ³•è§plus.storageçš„æ–‡æ¡£ï¼‰ã€‚ å†æ’ç‚¹ä»£ç ï¼ŒåŸºäºplus.storageçš„ç”¨æˆ·ä¿¡æ¯ç±»ï¼Œæ³¨æ„ï¼šéœ€è¦åœ¨plusReadyä¹‹åå†ä½¿ç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263function UserInfo(){};//æ¸…é™¤ç™»å½•ä¿¡æ¯UserInfo.clear = function(){ plus.storage.removeItem('username'); plus.storage.removeItem('password'); plus.storage.removeItem('token');}//æ£€æŸ¥æ˜¯å¦åŒ…å«è‡ªåŠ¨ç™»å½•çš„ä¿¡æ¯UserInfo.auto_login = function(){ var username = UserInfo.username(); var pwd = UserInfo.password(); if(!username || !pwd){ return false; } return true;}//æ£€æŸ¥æ˜¯å¦å·²ç™»å½•UserInfo.has_login = function(){ var username = UserInfo.username(); var pwd = UserInfo.password(); var token = UserInfo.token(); if(!username || !pwd || !token){ return false; } return true;};UserInfo.username = function(){ if(arguments.length == 0){ return plus.storage.getItem('username'); } if(arguments[0] === ''){ plus.storage.removeItem('username'); return; } plus.storage.setItem('username', arguments[0]);};UserInfo.password = function(){ if(arguments.length == 0){ return plus.storage.getItem('password'); } if(arguments[0] === ''){ plus.storage.removeItem('password'); return; } plus.storage.setItem('password', arguments[0]);};UserInfo.token = function(){ if(arguments.length == 0){ return plus.storage.getItem('token'); } if(arguments[0] === ''){ plus.storage.removeItem('token'); return; } plus.storage.setItem('token', arguments[0]);}; è¿™æ ·å½“ç”¨æˆ·å¯åŠ¨APPæˆ–ä½¿ç”¨äº†éœ€è¦ç™»å½•æ‰èƒ½ä½¿ç”¨çš„åŠŸèƒ½æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨UserInfo.has_login()æ¥åˆ¤æ–­æ˜¯å¦å·²ç»ç™»å½•ï¼Œå¦‚æœå·²ç™»å½•ï¼Œåˆ™ä½¿ç”¨UserInfo.token()æ¥è·å–åˆ°tokenæ•°æ®ï¼Œä½œä¸ºå‚æ•°è°ƒç”¨è¿œç¨‹çš„åç«¯æ¥å£ã€‚ 123456if(UserInfo.has_login()){ //æ‰“å¼€éœ€è¦å±•ç¤ºç»™ç”¨æˆ·çš„é¡µé¢ï¼Œæˆ–è€…æ˜¯è°ƒç”¨è¿œç«¯æ¥å£}else{ wv_login.show('slide-in-up'); //ä»åº•éƒ¨å‘ä¸Šæ»‘å‡ºç™»å½•é¡µé¢} åœ¨ç™»å½•é¡µé¢ä¸­ï¼Œç”¨æˆ·è¾“å…¥äº†ç”¨æˆ·åå’Œå¯†ç åï¼Œå¹¶ç‚¹å‡»äº†â€ç™»å½•â€œæŒ‰é’®ï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥åšä»€ä¹ˆï¼Ÿå†æ’æ®µä»£ç ï¼ˆæ³¨æ„ï¼šæ­¤å¤„ä½¿ç”¨çš„æ˜¯æˆ‘åˆšæ‰ä»£ç ä¸­æ‰©å±•çš„web_queryå‡½æ•°ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨muiçš„ajaxï¼‰ï¼š 123456789101112131415161718192021222324252627282930function get_pwd_hash(pwd){ var salt = 'hbuilder'; //æ­¤å¤„çš„saltæ˜¯ä¸ºäº†é¿å…é»‘å®¢æ’åº“ï¼Œè€Œåœ¨md5ä¹‹å‰å¯¹åŸæ–‡åšä¸€å®šçš„å˜å½¢ï¼Œå¯ä»¥è®¾ä¸ºè‡ªå·±å–œæ¬¢çš„ï¼Œåªè¦å’ŒæœåŠ¡å™¨éªŒè¯æ—¶çš„saltä¸€è‡´å³å¯ã€‚ return md5(salt + pwd); //æ­¤å¤„å‡è®¾ä½ å·²ç»å¼•ç”¨äº†md5ç›¸å…³çš„åº“ï¼Œæ¯”å¦‚githubä¸Šçš„JavaScript-MD5}//è¿™é‡Œå‡è®¾ä½ å·²ç»é€šè¿‡DOMæ“ä½œè·å–åˆ°äº†ç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ†åˆ«ä¿å­˜åœ¨usernameå’Œpasswordå˜é‡ä¸­ã€‚var username = xxx;var password = xxx;var pwd_hash = get_pwd_hash(password);var onSuccess = function(data){ UserInfo.username(username); UserInfo.password(pwd_hash); UserInfo.token(data.token); //æŠŠè·å–åˆ°çš„tokenä¿å­˜åˆ°storageä¸­ var wc = plus.webview.currentWebview(); wc.hide('slide-out-bottom'); //æ­¤å¤„å‡è®¾æ˜¯éšè—ç™»å½•é¡µå›åˆ°ä¹‹å‰çš„é¡µé¢ï¼Œå®é™…ä½ ä¹Ÿå¯ä»¥å¹²ç‚¹å„¿åˆ«çš„}var onError = function(errcode){ switch(errcode){ case 'INCORRECT_PASSWORD': mui.toast('å¯†ç ä¸æ­£ç¡®'); break; case 'USER_NOT_EXISTS': mui.toast('ç”¨æˆ·å°šæœªæ³¨å†Œ'); break; }}mui.web_query('get_token', {username:username,password:pwd_hash}, onSuccess, onError, 3); æ›´å®‰å…¨ä¸€ç‚¹ï¼Œè·å–tokené€šè¿‡SSLåˆšæ‰çš„æ–¹æ³•ï¼Œæœºæ™ºä¸€ç‚¹å„¿çš„è¯»è€…å¤§æ¦‚ä¼šå¿ƒå­˜ç–‘è™‘ï¼šé‚£è·å–tokenæ—¶ä¸è¿˜æ˜¯å¾—æ˜æ–‡ä¼ è¾“ä¸€æ¬¡å¯†ç å—ï¼Ÿæ˜¯çš„ï¼Œä½ å¯ä»¥å°†è¿™ä¸ªè·å–tokençš„åœ°å€ï¼Œç”¨SSLæ¥ä¿æŠ¤ï¼ˆæ¯”å¦‚https://api.abc.com/get_token/ï¼‰ï¼Œè¿™æ ·é»‘å®¢å³ä½¿æˆªäº†åŒ…ï¼Œä¸€æ—¶åŠä¼šå„¿ä¹Ÿè§£ä¸å‡ºä»€ä¹ˆä¿¡æ¯ã€‚SSLè¯ä¹¦çš„è·å–æ¸ é“å¾ˆå¤šï¼Œæˆ‘ç›¸ä¿¡ä½ æ€»æœ‰åŠæ³•æŸ¥åˆ°ï¼Œæ‰€ä»¥ä¸åºŸè¯äº†ã€‚ä¸è¿‡è¯è¯´namecheapä¸Šçš„SSLè¯ä¹¦æ¯”godaddyçš„è¦ä¾¿å®œå¾—å¤šâ€¦â€¦ï¼ˆè¿™æ˜¯åæ§½ï¼‰tips:å‰æ®µæ—¶é—´OpenSSLæ¼æ´è®©å¾ˆå¤šæœåŠ¡å™¨é­æ®ƒï¼Œæ‰€ä»¥å¦‚æœè‡ªå·±æ­æœåŠ¡å™¨ï¼Œä¸€å®šè®°å¾—è£…è¡¥ä¸ã€‚tips:å¯ä»¥æŠŠæ‰€æœ‰æ¥å£éƒ½å¼„æˆSSLçš„å—ï¼Ÿå¯ä»¥ã€‚ä½†ä¼šæ‹–æ…¢æœåŠ¡å™¨ï¼Œå¦‚æœæ˜¯é…ç½®å¹¶ä¸è‡ªä¿¡çš„VPSï¼Œå»ºè®®ä¸æŠ˜è…¾ã€‚ å¦‚æœæ›´å®‰å…¨å‘¢ï¼Ÿè¿˜è®°å¾—åˆšæ‰APPå‘æœåŠ¡å™¨è¯·æ±‚tokenæ—¶ï¼Œå¯ä»¥åŠ å…¥çš„ç”¨æˆ·ä¿¡æ¯å—ï¼Ÿæ¯”å¦‚ç”¨æˆ·çš„è®¾å¤‡deviceidã€‚å¦‚æœæˆ‘ä»¬åœ¨è°ƒç”¨æ¥å£æ—¶ï¼Œè¿˜é™„å¸¦ä¸€ä¸ªå½“å‰æ—¶é—´æˆ³å‚æ•°timestampï¼ŒåŒæ—¶ï¼Œç”¨deviceidå’Œè¿™ä¸ªæ—¶é—´æˆ³å†ç”Ÿæˆä¸€ä¸ªå‚æ•°signï¼Œæ¯”å¦‚ md5(deviceid timestamp token)è¿™æ ·çš„å½¢å¼ã€‚è€ŒæœåŠ¡ç«¯é¦–å…ˆéªŒè¯ä¸€ä¸‹å‚æ•°ä¸­çš„æ—¶é—´æˆ³ä¸å½“å‰æœåŠ¡å™¨æ—¶é—´æ˜¯å¦ä¸€è‡´ï¼ˆè¯¯å·®ä¿æŒåœ¨åˆç†èŒƒå›´å†…å³å¯ï¼Œæ¯”å¦‚5åˆ†é’Ÿï¼‰ï¼Œç„¶åæ ¹æ®ç”¨æˆ·ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­çš„deviceidæ¥å¯¹å‚æ•°ä¸­çš„æ—¶é—´æˆ³è¿›è¡Œç›¸åŒçš„å˜å½¢ï¼ŒéªŒè¯æ˜¯å¦åŒ¹é…ï¼Œé‚£ä¾¿è‡ªç„¶â€œæ›´æ›´å®‰å…¨â€äº†ã€‚tips:å¦‚æœå¯¹æ•´ä¸ªè°ƒç”¨è¯·æ±‚ä¸­çš„å‚æ•°è¿›è¡Œæ’åºï¼Œå†ä»¥deviceidå’ŒtimestampåŠ ä¸Šæ’åºåçš„å‚æ•°æ¥å¯¹æ•´ä¸ªè°ƒç”¨ç”Ÿæˆ1ä¸ªsignï¼Œé»‘å®¢å³ä½¿æˆªè·signï¼Œä¸åŒçš„æ—¶é—´ç‚¹ã€å‚æ•°è¯·æ±‚æ‰€ä½¿ç”¨çš„signä¹Ÿæ˜¯ä¸åŒçš„ï¼Œéš¾ä»¥ä¼ªé€ ï¼Œè‡ªç„¶ä¼šæ›´å®‰å…¨ã€‚å½“ç„¶ï¼Œå†™èµ·æ¥ä¹Ÿæ›´è´¹äº‹ã€‚tips:æ˜ç™½äº†åŸç†ï¼Œæ•´ä¸ªéªŒè¯è¿‡ç¨‹æ˜¯å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ”¹é€ çš„ã€‚","link":"/p/821bbecd.html"},{"title":"ğŸ Dubbo SPI ä¹‹ Adaptive è‡ªé€‚åº”ç±»","text":"ç¿»çœ‹ Dubbo çš„æºç ï¼Œä¸éš¾å‘ç°ï¼Œæ¡†æ¶åˆ°å¤„éƒ½åœ¨ç”¨ SPI æœºåˆ¶è¿›è¡Œæ‰©å±•ã€‚è¿™æ˜¯ç”±äº Dubbo æ¡†æ¶å¯¹å„ç§å±‚åšäº†å¾ˆå¤šçš„å®ç°æ–¹å¼ï¼Œç„¶åç”±ç”¨æˆ·è‡ªå·±å»é€‰æ‹©å…·ä½“çš„å®ç°æ–¹å¼ã€‚æ¯”å¦‚ Protocolï¼ŒDubbo æä¾›çš„å®ç°å°±æœ‰ dubboï¼Œhessianï¼Œthriftï¼Œredisï¼ŒinJvm ç­‰ç­‰ã€‚è¿™ä¹ˆå¤šçš„å®ç°æ–¹å¼ï¼ŒDubbo æ˜¯å¦‚ä½•åšåˆ°åŠ¨æ€çš„åˆ‡æ¢çš„å‘¢ï¼Ÿ æ¥å£è‡ªé€‚åº”ä¸ @Adaptive æ³¨è§£ Dubbo æ²¡æœ‰é‡‡ç”¨ JDK æä¾›çš„ SPI æœºåˆ¶ï¼Œè€Œæ˜¯è‡ªå·±å®ç°äº†ä¸€å¥—ï¼Œå¢å¼ºäº†å¾ˆå¤šåŠŸèƒ½ã€‚å…·ä½“ç»†èŠ‚å¯ä»¥æµè§ˆç½‘ä¸Šå…¶ä»–åšå®¢ã€‚ Dubbo å……åˆ†åˆ©ç”¨é¢å‘å¯¹è±¡æ€æƒ³ï¼Œæ¯ä¸€ä¸ªç»„ä»¶å†…å¼•å…¥å…¶ä»–ç»„ä»¶éƒ½æ˜¯ä»¥æ¥å£çš„å½¢å¼è¿›è¡Œä¾èµ–ï¼ŒåŠ¨æ€çš„ inject å®ç°ç±»ã€‚æ‰€ä»¥è¿™ç§æ€æƒ³ä¸Šä¹Ÿç”¨åˆ°äº† AOP å’Œ DI çš„æ€æƒ³ã€‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¥å£ Registryï¼Œå‡å®šå®ƒçš„åŠŸèƒ½æ˜¯å°†æœ¬åœ°æœåŠ¡æš´éœ²åˆ°æ³¨å†Œä¸­å¿ƒï¼Œä»¥åŠä»æ³¨å†Œä¸­å¿ƒè·å–å¯ç”¨æœåŠ¡ï¼Œå±äº RPC æ¡†æ¶ä¸­çš„æœåŠ¡æ³¨å†Œä¸å‘ç°ç»„ä»¶ã€‚ 12345678910111213@SPI(&quot;zookeeper&quot;)public interface Registry { /** * æ³¨å†ŒæœåŠ¡ */ @Adaptive() String register(URL url, String content); /** * å‘ç°æœåŠ¡ */ @Adaptive() String discovery(URL url, String content);} @SPI æ³¨è§£æ ‡æ³¨è¿™æ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„ç»„ä»¶ï¼Œæ³¨è§£å†…çš„å†…å®¹åæ–‡è¯¦ç»†ä»‹ç»ã€‚ è¯¥æ¥å£å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³• registerå’Œ discoveryï¼Œåˆ†åˆ«ä»£è¡¨æ³¨å†ŒæœåŠ¡å’Œå‘ç°æœåŠ¡ã€‚ä¸¤ä¸ªæ–¹æ³•ä¸­éƒ½æœ‰ URL å‚æ•°ï¼Œè¯¥ç±»æ˜¯ Dubbo å†…ç½®çš„ç±»ï¼Œä»£è¡¨äº† Dubbo æ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å„ç±»é…ç½®ä¿¡æ¯ï¼Œå‚æ•°ç­‰ã€‚content ä»£è¡¨å¤‡æ³¨ä¿¡æ¯ã€‚ @Adaptive()æ³¨è§£è¡¨æ˜è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è‡ªé€‚åº”æ–¹æ³•ï¼Œå…·ä½“ä½œç”¨åæ–‡åˆ†æã€‚ ä¸‹é¢åˆ†åˆ«æ˜¯ä¸¤ä¸ªå®ç°ç±» ZookeeperRegistry ã€EtcdRegistry ZookeeperRegistry123456789101112131415161718public class ZookeeperRegistry implements Registry { private Logger logger = LoggerFactory.getLogger(ZookeeperRegistry.class); @Override public String register(URL url, String content) { logger.info(&quot;æœåŠ¡: {} å·²æ³¨å†Œåˆ°zookeeperä¸Šï¼Œå¤‡æ³¨: {}&quot;, url.getParameter(&quot;service&quot;), content); return &quot;Zookeeper register already! &quot;; } @Override public String discovery(URL url, String content) { logger.info(&quot;zookeeperä¸Šå‘ç°æœåŠ¡: {} , å¤‡æ³¨: {}&quot;, url.getParameter(&quot;service&quot;), content); return &quot;Zookeeper discovery already! &quot;; }} EtcdRegistry123456789101112131415161718public class EtcdRegistry implements Registry { private Logger logger = LoggerFactory.getLogger(ZookeeperRegistry.class); @Override public String register(URL url, String content) { logger.info(&quot;æœåŠ¡: {} å·²æ³¨å†Œåˆ° Etcd ä¸Šï¼Œå¤‡æ³¨: {}&quot;, url.getParameter(&quot;service&quot;), content); return &quot;Etcd register already! &quot;; } @Override public String discovery(URL url, String content) { logger.info(&quot;Etcd ä¸Šå‘ç°æœåŠ¡: {} , å¤‡æ³¨: {}&quot;, url.getParameter(&quot;service&quot;), content); return &quot;Etcd discovery already! &quot;; }} æˆ‘ä»¬å¯ä»¥å°†æœåŠ¡æ³¨å†Œä¿¡æ¯æ³¨å†Œåˆ°è€ç‰Œæ³¨å†Œä¸­å¿ƒ zookeeper ä¸Šï¼Œæˆ–è€…ä½¿ç”¨æ–°å…´æµè¡Œè½»é‡çº§æ³¨å†Œä¸­å¿ƒ etcd ä¸Šã€‚ é…ç½®æ‰©å±•ç‚¹å®ç°ä¿¡æ¯åˆ° Resource ç›®å½•ä¸‹åœ¨ Resource ä¸‹çš„ META-INF.dubbo ä¸‹æ–°å»º ä»¥ Registry å…¨é™å®šåä¸ºåçš„æ–‡ä»¶ï¼Œé…ç½®å®ç°ç±»ä¿¡æ¯ï¼Œä»¥ key-value çš„å½¢å¼ã€‚ï¼ˆè¿™é‡Œè¦æ³¨æ„ä¸ JDK é»˜è®¤çš„ SPI æœºåˆ¶çš„åŒºåˆ«ï¼‰ æ–‡ä»¶å†…å†…å®¹å¦‚ä¸‹: 12etcd=com.maple.spi.impl.EtcdRegistryzookeeper=com.maple.spi.impl.ZookeeperRegistry æµ‹è¯• Dubbo SPI è‡ªé€‚åº”ç±»123456789101112public class Main { public static void main(String[] args) { URL url = URL.valueOf(&quot;test://localhost/test&quot;) .addParameter(&quot;service&quot;, &quot;helloService&quot;); Registry registry = ExtensionLoader.getExtensionLoader(Registry.class) .getAdaptiveExtension(); String register = registry.register(url, &quot;maple&quot;); System.out.println(register); }} è¯¥ç¨‹åºé¦–å…ˆé€šè¿‡ Registry æ¥å£å¾—åˆ°å®ƒä¸“å±çš„ ExtensionLoader å®ä¾‹ï¼Œç„¶åè°ƒç”¨ getAdaptiveExtension æ‹¿åˆ°è¯¥æ¥å£çš„è‡ªé€‚åº”ç±»ã€‚Dubbo ä¼šåˆ¤æ–­æ˜¯å¦æœ‰å®ç°ç±»(å³å®ç°äº† Registry æ¥å£) ä¸Šæœ‰æ³¨è§£ @Adaptiveï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šåŠ¨æ€ç”Ÿæˆã€‚æœ¬ä¾‹å­å°†ä¼šåŠ¨æ€ç”Ÿæˆã€‚ ç›´æ¥è¿è¡Œç¨‹åºç»“æœå¦‚ä¸‹,ç¨‹åºæœ€ç»ˆé€‰æ‹©çš„å®ç°ç±»æ˜¯ ZookeeperRegistryï¼Œæ§åˆ¶å°ç»“æœå¦‚ä¸‹: 1209-20 23:43:13 323 main INFO - æœåŠ¡: helloService å·²æ³¨å†Œåˆ°zookeeperä¸Šï¼Œå¤‡æ³¨: mapleZookeeper register already! ä¸Šé¢ä»£ç æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°ä»»ä½•å®ç°ç±»çš„ä¿¡æ¯ï¼ŒDubbo SPI æœºåˆ¶ä¼šä¸ºåŠ¨æ€çš„å»è°ƒç”¨å®ç°ç±»ã€‚ æˆ‘ä»¬é‡ç‚¹åˆ†æ getAdaptiveExtension æ–¹æ³•æ‰¾åˆ°çš„æ˜¯ Registry çš„è‡ªé€‚åº”ç±»ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ Registry çš„ä¸€ä¸ª é€‚é…å™¨å’Œä»£ç†ç±»ã€‚å¦‚æœè¯¥é€‚é…å™¨ç±»ä¸å­˜åœ¨ï¼ŒDubbo ä¼šé€šè¿‡åŠ¨æ€ä»£ç†æ–¹å¼åœ¨è¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè‡ªé€‚åº”ç±»ã€‚ æ‰“å¼€ DEBUG æ—¥å¿—ï¼Œåœ¨æ§åˆ¶å°æˆ‘ä»¬çœ‹åˆ°äº† Dubbo ç”Ÿæˆçš„ç±»çš„æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425package com.maple.spi;import com.alibaba.dubbo.common.extension.ExtensionLoader;public class Registry$Adaptive implements com.maple.spi.Registry { public java.lang.String register(com.alibaba.dubbo.common.URL arg0, java.lang.String arg1) { if (arg0 == null) throw new IllegalArgumentException(&quot;url == null&quot;); com.alibaba.dubbo.common.URL url = arg0; String extName = url.getParameter(&quot;registry&quot;, &quot;zookeeper&quot;); if (extName == null) throw new IllegalStateException(&quot;Fail to get extension(com.maple.spi.Registry) name from url(&quot; + url.toString() + &quot;) use keys([registry])&quot;); com.maple.spi.Registry extension = (com.maple.spi.Registry) ExtensionLoader.getExtensionLoader(com.maple.spi.Registry.class).getExtension(extName); return extension.register(arg0, arg1); } public java.lang.String discovery(com.alibaba.dubbo.common.URL arg0, java.lang.String arg1) { if (arg0 == null) throw new IllegalArgumentException(&quot;url == null&quot;); com.alibaba.dubbo.common.URL url = arg0; String extName = url.getParameter(&quot;registry&quot;, &quot;zookeeper&quot;); if (extName == null) throw new IllegalStateException(&quot;Fail to get extension(com.maple.spi.Registry) name from url(&quot; + url.toString() + &quot;) use keys([registry])&quot;); com.maple.spi.Registry extension = (com.maple.spi.Registry) ExtensionLoader.getExtensionLoader(com.maple.spi.Registry.class).getExtension(extName); return extension.discovery(arg0, arg1); }} çœ‹ä»£ç ï¼Œè¯¥é€‚é…å™¨ç±»çš„ä½œç”¨æ˜¯ç±»ä¼¼äº AOP çš„åŠŸèƒ½ï¼Œå†è°ƒç”¨å…·ä½“çš„å®ç°ç±»ä¹‹å‰ï¼Œå…ˆé€šExtensionLoader.getExtensionLoader(Registry.class).getExtension(extName);æ ¹æ® extName å» loader å…·ä½“çš„å®ç°ç±»ï¼Œç„¶åå†å»è°ƒç”¨å®ç°ç±»çš„ç›¸åº”çš„æ–¹æ³•ã€‚ åˆ†æä¸Šé¢ä»£ç ä¸­çš„ä¸€å¥: 1String extName = url.getParameter(&quot;registry&quot;, &quot;zookeeper&quot;); extName å¯ä»¥é€šè¿‡ url è¿›è¡Œä¼ é€’ï¼Œé»˜è®¤å€¼ä¸º zookeeper, è¯¥é»˜è®¤å€¼å³ä¸ºæˆ‘ä»¬å®šä¹‰çš„æ¥å£ä¸Šçš„æ³¨è§£ @SPI é‡Œçš„å†…å®¹ï¼Œä¸Šæ–‡æˆ‘ä»¬å®šä¹‰çš„ @SPI(&quot;zookeeper&quot;)ï¼Œæ‰€ä»¥è¿™é‡Œçš„é»˜è®¤å€¼ä¸º zookeeper, å½“ url ä¸­æ²¡æœ‰å¯¹åº”çš„å‚æ•°æ—¶ï¼Œæˆ‘ä»¬ä¼šå»æ‹¿é»˜è®¤å€¼ã€‚ æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ Main æµ‹è¯•ç¨‹åºï¼Œå¢åŠ  key ä¸º registry çš„ parameter 1234567891011public static void main(String[] args) { URL url = URL.valueOf(&quot;test://localhost/test&quot;).addParameter(&quot;service&quot;, &quot;helloService&quot;) .addParameter(&quot;registry&quot;,&quot;etcd&quot;); Registry registry = ExtensionLoader.getExtensionLoader(Registry.class).getAdaptiveExtension(); String register = registry.register(url, &quot;maple&quot;); System.out.println(register); } åœ¨ URL ä¸­å¢åŠ  Keyï¼Œå¹¶è®¾ç½®å€¼ä¸º etcdï¼Œè¿è¡Œç¨‹åºï¼Œç»“æœå¦‚ä¸‹ï¼š 1209-20 23:44:00 009 main INFO - æœåŠ¡: helloService å·²æ³¨å†Œåˆ° Etcd ä¸Šï¼Œå¤‡æ³¨: mapleEtcd register already! å®ç°ç±»å·²ç»åˆ‡æ¢ä¸º EtcdRegistry äº†ã€‚ @Adaptive æ³¨æ„ç»†èŠ‚@Adaptive æºç  123public @interface Adaptive { String[] value() default {};} ç»†å¿ƒçš„è¯»è€…å·²ç»å‘ç°äº† @Adaptive æœ‰valueè¿™ä¸ªå±æ€§ã€‚ä¸Šæ–‡åœ¨æ¥å£æ–¹æ³•ä¸Šå®šä¹‰çš„ @Adaptive æ˜¯æ²¡æœ‰è®¾ç½®å€¼çš„ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰å€¼ï¼ŒDubbo é»˜è®¤ä¼šä½¿ç”¨ä¸€ç§ç­–ç•¥ç”Ÿæˆã€‚è¿™ç§ç­–ç•¥æ˜¯å°†ç±»åå®šä¹‰çš„é©¼å³°æ³•åˆ™è½¬æ¢ä¸ºå°å†™ï¼Œå¹¶ä»¥ . å·åŒºåˆ†ã€‚ ä¾‹å¦‚ä¸Šæ–‡çš„æ¥å£åä¸º Registryï¼Œé‚£ä¹ˆè¿™ä¸ªKey å€¼å°±æ˜¯ registryã€‚å¦‚æœæ¥å£åä¸º HelloWorldï¼ŒKey å€¼å°±ä¸º hello.worldã€‚ å½“ç„¶å¦‚æœ @Adaptive æ˜¯æœ‰å€¼çš„è¯ï¼Œä¼˜å…ˆæŒ‰é‡Œé¢çš„è¿™ä¸ªå€¼æ¥ä½œä¸º Keyï¼Œä¾‹å¦‚ Dubbo æ¡†æ¶ä¸­çš„æ¥å£ RegistryFactory ,è¯¥æ¥å£çš„è‡ªé€‚åº”ç±»å°†ä¼šä» URL ä»¥ protocol ä¸º key æ¥æ‰¾å®ç°ç±»çš„ extNameã€‚ 12345@SPI(&quot;dubbo&quot;)public interface RegistryFactory { @Adaptive({&quot;protocol&quot;}) Registry getRegistry(URL url);} æ€»ç»“Dubbo Adaptive æ¨¡å¼åœ¨æ•´ä¸ªæ¡†æ¶ä¸­è¿ç”¨ååˆ†å¹¿æ³›ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰åœ¨ URL ä¸­è¿›è¡Œè‡ªå®šä¹‰ï¼ŒDubbo é»˜è®¤ä¼šå»åŠ è½½æ‰©å±•ç‚¹æ¥å£ä¸Š @SPI æ ‡æ³¨çš„å†…å®¹,å¦‚æœæ­¤æ³¨è§£æ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¿…é¡»è¦åœ¨ URL ä¸­è¿›è¡Œå€¼çš„ä¼ é€’äº†ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦†ç›– Dubbo é»˜è®¤çš„å®ç°ç­–ç•¥ã€‚å¯ä»¥é€šè¿‡åœ¨ URL ä¸­å¢åŠ  key-value çš„å½¢å¼æ¥æ”¹å˜ã€‚ è¿™æ ·ä¸€ä¸ªç»„ä»¶å……åˆ†ä½“ç°äº†è®¾è®¡æ¨¡å¼,å¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾çš„åŸåˆ™ã€‚å½“æˆ‘ä»¬æƒ³è‡ªå·±å®ç° Dubbo ä¸­çš„æŸä¸ªç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡ Dubbo Adaptive æ¥åŠ¨æ€çš„åˆ‡æ¢ç¨‹åºä½¿ç”¨æˆ‘ä»¬æä¾›çš„ç»„ä»¶ã€‚ å½»åº•ç†è§£ Dubbo SPI æ¨¡å¼ï¼Œä»¥åŠ Adaptive è‡ªé€‚åº”ç±», Activate æ¿€æ´»ç±»ç­‰ï¼Œæ˜¯çœ‹ Dubbo æºç çš„åŸºç¡€ã€‚å¦‚æœæˆ‘ä»¬æƒ³ååˆ†æµç•…çš„å»åˆ†æ Dubbo å†…éƒ¨å…¶ä»–ç»„ä»¶çš„å®ç°æœºåˆ¶ï¼Œç¬¬ä¸€é“è¦è·¨è¿‡çš„åä¾¿æ˜¯ Dubbo SPIã€‚","link":"/p/22fedb28.html"},{"title":"ğŸ Dubbo SPI ä¹‹æ‰©å±•ç‚¹è‡ªåŠ¨åŒ…è£… Wrapper ç±»","text":"ä¹‹å‰çš„æ–‡ç« æˆ‘ä»¬åˆ†æäº† Dubbo çš„æ‰©å±•ç‚¹è‡ªé€‚åº”æœºåˆ¶ã€‚Dubbo SPI ä¸»è¦æ€æƒ³ä¹Ÿæ˜¯æ¥è‡ªäº JDK åŸç”Ÿçš„ SPI æœºåˆ¶ã€‚æ¡†æ¶å®šä¹‰å¥½æ‰©å±•ç‚¹æ¥å£ï¼ŒæœåŠ¡æä¾›è€…å®ç°æ¥å£ã€‚æ¡†æ¶å¯ä»¥é€šè¿‡SPIæœºåˆ¶åŠ¨æ€çš„å°†æœåŠ¡æä¾›å•†åˆ‡å…¥åˆ°åº”ç”¨ä¸­ã€‚ä½¿æˆ‘ä»¬çš„ç¨‹åºå¯ä»¥é¢å‘æ¥å£ï¼Œå¯¹æ‰©å±•å¼€æ”¾ã€‚ Dubbo SPI ä¸ JDK SPIJDK SPI éœ€è¦åœ¨ classpath ä¸‹ META-INF/services ç›®å½•ä¸‹åˆ›å»ºä»¥æ‰©å±•ç‚¹æ¥å£å…¨é™å®šåå‘½åçš„æ–‡ä»¶ï¼Œé‡Œé¢å†…å®¹ä¸ºå®ç°ç±»çš„åç§°(å®Œæ•´åŒ…å)ï¼Œå¤šä¸ªå®ç°ç±»æ¢è¡Œåˆ†éš”ã€‚æ–‡ä»¶åç§°: JDKåŠ è½½æ‰©å±•ç‚¹å®ç°ç±»çš„æ–¹å¼: 1Iterator&lt;Registry&gt; registryImpls = ServiceLoader.load(Registry.class).iterator(); ç»“è®ºJDK SPI ä¼šåŠ è½½ classpath ä¸‹çš„æ‰€æœ‰ META-INF/services ä¸‹çš„æ‰€æœ‰æ¥å£å¯¹åº”çš„å®ç°ç±»ã€‚å¦‚æœè¯¥å®ç°ç±»åœ¨ classpath å­˜åœ¨ï¼Œåˆ™ä¼šé€šè¿‡ServiceLoaderåŠ è½½å‡ºæ¥ã€‚å¦‚æœæœ‰å¤šä¸ªå®ç°ç±»ï¼Œå¤šä¸ªå®ç°ç±»éƒ½ä¼šè¢«åŠ è½½å‡ºæ¥ï¼Œç”¨æˆ·åˆ™ä¼šé€‰æ‹©ä½¿ç”¨å“ªä¸ªã€‚ Dubbo SPI æ”¹è¿› ä¸ä¸€æ¬¡æ€§å®ä¾‹åŒ–æ‰©å±•ç‚¹æ‰€æœ‰å®ç°ï¼Œå†ç”¨åˆ°çš„æ—¶å€™ï¼Œå†é€‰æ‹©æ€§åŠ è½½ï¼Œå¯ä»¥å‡å°‘èµ„æºæµªè´¹ã€‚ æ‰©å±•ç‚¹åŠ è½½å¤±è´¥å¼‚å¸¸è·‘å‡ºæ›´æ˜ç¡®çš„ä¿¡æ¯ æä¾›æ‰©å±•ç‚¹å®ç°ç±»ä¸å®ç°ç±»ä¹‹é—´çš„Wrapper æ“ä½œï¼Œå¯ä»¥ç”¨æ¥èšåˆå…¬å…±éƒ¨åˆ†é€»è¾‘ã€‚ æä¾› IOC å’Œ AOP ç­‰åŠŸèƒ½ã€‚ Dubbo æ‰©å±•ç‚¹åŒ…è£… Wrapper ç±»ä¸€ä¸ªå…¸å‹çš„Wrapperç±»å¦‚ä¸‹: 1234567891011121314151617181920public class CommonRegistry implements Registry { // æŒæœ‰ æ‰©å±•ç‚¹æ¥å£ private Registry registry; // æ„é€ å™¨æ³¨å…¥ public CommonRegistry(Registry registry) { this.registry = registry; } @Override public String register(URL url, String msg) { // doSomething return registry.register(url,msg); } @Override public String discovery(URL url, String content) { // doSomething return registry.register(url,msg); }} åˆ†æä¸Šé¢çš„åŒ…è£…ç±»ï¼Œæˆ‘ä»¬å¾—å‡º Dubbo è®¤ä¸ºçš„åŒ…è£…ç±»éœ€è¦æ»¡è¶³çš„ä¸¤ä¸ªæ¡ä»¶ 1.æŒæœ‰æ‰©å±•ç‚¹æ¥å£å¯¹è±¡å±æ€§ï¼Œå¹¶é€šè¿‡æ„é€ å™¨æ–¹å¼åˆå§‹åŒ–è¯¥å±æ€§ 2.è¿™ä¸ªç±»ä¹Ÿè¦å®ç°æ‰©å±•ç‚¹æ¥å£ç±»ï¼Œå¹¶åœ¨å®ç°æ–¹æ³•ä¸­è¿›è¡Œå¢å¼ºæ“ä½œ Wrapper åŒ…è£…ç±»å®æˆ˜ ä¸Šä¸€ç¯‡æ–‡ç«  [Dubbo SPI ä¹‹ Adaptive è‡ªé€‚åº”ç±»] æˆ‘ä»¬ä»‹ç»è¿‡ä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒçš„å®ç°ã€‚è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ–°çš„éœ€æ±‚ï¼Œéœ€è¦å¯¹æ¯ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒçš„æ³¨å†ŒæœåŠ¡å’Œå‘ç°æœåŠ¡ç»Ÿè®¡ä¸€ä¸‹è€—æ—¶ï¼Œå¢åŠ ä¸€äº›å…±æœ‰é€»è¾‘ã€‚æ‰€ä»¥æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Wrapper ç±»ã€‚ 1234567891011121314151617181920212223public class CommonRegistry implements Registry { private Logger logger = LoggerFactory.getLogger(CommonRegistry.class); // æŒæœ‰ æ‰©å±•ç‚¹æ¥å£ private Registry registry; // æ„é€ å™¨æ³¨å…¥ public CommonRegistry(Registry registry) { this.registry = registry; } @Override public String register(URL url, String msg) { long begin = System.currentTimeMillis(); String register = registry.register(url, msg); long end = System.currentTimeMillis(); logger.info(&quot;register method å¤„ç†è€—æ—¶ cost: {} ms&quot;, end - begin); return register; } @Override public String discovery(URL url, String content) { //...å®ç°åŒä¸Š }} åœ¨ META-INF/dubbo/com.maple.spi.Registryé‡Œé¢å¢åŠ  wrapper ç±»çš„ä¿¡æ¯ï¼š 1common=com.maple.spi.impl.CommonRegistry æµ‹è¯• Main 1234567891011public static void main(String[] args) { URL url = URL.valueOf(&quot;test://localhost/test&quot;) .addParameter(&quot;service&quot;, &quot;helloService&quot;) .addParameter(&quot;registry&quot;,&quot;etcd&quot;); //.addParameter(&quot;registry&quot;,&quot;zookeeper&quot;); Registry registry = ExtensionLoader.getExtensionLoader(Registry.class) .getAdaptiveExtension(); System.out.println(registry.register(url, &quot;maple&quot;););} åˆ†åˆ«å°è¯•ä½¿ç”¨ etcd å’Œ zookeeperï¼Œæ§åˆ¶å°æ‰“å°å¦‚ä¸‹ï¼š 12345678//Etcd09-26 00:55:16 707 main INFO - æœåŠ¡: helloService å·²æ³¨å†Œåˆ° Etcd ä¸Šï¼Œå¤‡æ³¨: maple09-26 00:55:16 709 main INFO - register method å¤„ç†è€—æ—¶ cost: 2 msEtcd register already! // zookeeper09-26 00:56:17 282 main INFO - æœåŠ¡: helloService å·²æ³¨å†Œåˆ°zookeeperä¸Šï¼Œå¤‡æ³¨: maple09-26 00:56:17 284 main INFO - register method å¤„ç†è€—æ—¶ cost: 2 msZookeeper register already! æˆ‘ä»¬çœ‹åˆ°äº† register method å¤„ç†è€—æ—¶ cost: 2 ms è¿™æ¡æ—¥å¿—ï¼Œè¯´æ˜ CommonRegistry çš„é€»è¾‘å·²ç»è¿è¡Œäº†ã€‚ç¨‹åºå…ˆæ„é€  CommonRegistryï¼Œä»å®ƒçš„æ„é€ å™¨ä¸­ä¼ å…¥çš„æ˜¯æ‰©å±•ç‚¹å®ç°ç±»ï¼Œç¨‹åºä¼šå…ˆè°ƒç”¨wrapperç±»å¯¹åº”çš„æ–¹æ³•ï¼Œ ç„¶ååœ¨æ–¹æ³•å†…éƒ¨å†è°ƒç”¨æ‰©å±•ç‚¹å®ç°ç±»çš„å¯¹åº”æ–¹æ³•ã€‚ç±»ä¼¼äºè£…é¥°å™¨æ¨¡å¼ï¼Œä¸ºæ‰©å±•ç‚¹å®ç°ç±»å¢å¼ºäº†åŠŸèƒ½ã€‚é€šè¿‡è¿™ç§è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªæ‰©å±•ç‚¹å®ç°å…±ç”¨çš„å…¬å…±é€»è¾‘éƒ½ç§»åˆ°æ­¤ç±»ä¸­æ¥ã€‚ Wrapper ç±»ä¸å±äºå€™é€‰çš„æ‰©å±•ç‚¹å®ç° Wrapper ç±»ä¸å±äºæ‰©å±•ç‚¹å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è¿›è¡ŒéªŒè¯: 12345Set&lt;String&gt; extens = ExtensionLoader .getExtensionLoader(Registry.class) .getSupportedExtensions();//ç»“æœ[etcd, zookeeper] é€šè¿‡ getSupportedExtensions å¯ä»¥è·å–æ‰©å±•ç‚¹æ¥å£ Registry å½“å‰æ‰€æœ‰çš„æœåŠ¡æ‰©å±•å®ç°çš„ key å€¼ã€‚æ§åˆ¶å°çš„ç»“æœåªæœ‰ etcd å’Œ zookeeperã€‚ å› æ­¤ï¼Œwrapper ä¸å±äº æ‰©å±•ç‚¹å®ç°ï¼ŒåŒç† ä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»çš„è‡ªé€‚åº”ç±» Adaptiveï¼Œ ä¹Ÿä¸å±äºæ‰©å±•ç‚¹å®ç°ã€‚ æ€»ç»“é€šè¿‡æœ¬æ–‡æ€»ç»“ JDK SPI åŸç†å’Œä½¿ç”¨æ–¹å¼ï¼Œç„¶åå’Œ Dubbo SPI è¿›è¡Œå¯¹æ¯”ã€‚ Dubbo æ‰©å±•ç‚¹è‡ªåŠ¨åŒ…è£…Wrapperç±»ï¼Œç±»ä¼¼ä¸AOPï¼Œä¸ºæ‰©å±•ç‚¹å®ç°å¢åŠ æ›´å¤šå‰ç½®æˆ–è€…åç½®åŠŸèƒ½æ¨¡å—ã€‚å®ç°åŸç†é‡‡ç”¨è£…é¥°å™¨è®¾è®¡æ¨¡å¼ï¼Œå°†çœŸæ­£çš„æ‰©å±•ç‚¹å®ç°åŒ…è£…åœ¨Wrapperç±»ä¸­ã€‚æ‰©å±•ç‚¹çš„Wrapperå¯ä»¥æœ‰å¤šä¸ªï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚æ–°å¢ã€‚ &emsp;&emsp;æ‰«ä¸€æ‰«ï¼Œå…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å· ![å…¬ä¼—å·.png](https://upload-images.jianshu.io/upload_images/6393906-457a99e16106e3a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/600)","link":"/p/ac54f348.html"},{"title":"etcd v3åŸºæœ¬çŸ¥è¯†æ¦‚è§ˆ","text":"etcdå‘½ä»¤è¡Œ v3 api è®¾ç½®é”®ã€ä¿®æ”¹é”® 1etcdctl put /maple value åˆ é™¤é”® 1234etcdctl del /maple#åˆ é™¤æ‰€æœ‰/testå‰ç¼€çš„èŠ‚ç‚¹etcdctl del /test --prefix æŸ¥è¯¢Key 12345etcdctl get /test/ok# å‰ç¼€æŸ¥è¯¢etcdctl get /test/ok --prefix# æŸ¥è¯¢æ‰€æœ‰é”®etcdctl --prefix --keys-only=true get / watch key 1234etcdctl watch /maple/services#watchå­èŠ‚ç‚¹etcdctl watch /maple/services --prefix ç”³è¯·ç§Ÿçº¦ã€æˆæƒç§Ÿçº¦ 1234567891011121314# ç”³è¯·ç§Ÿçº¦etcdctl lease grant 40 lease 4e5e5b853f528859 granted with TTL(40s)# æˆæƒç§Ÿçº¦etcdctl put --lease=4e5e5b853f528859 /maple/s 123# æ’¤é”€etcdctl lease revoke 4e5e5b853f5286cc#ç§Ÿçº¦ç»­çº¦etcdctl lease keep-alive 4e5e5b853f52892b ä¸´æ—¶èŠ‚ç‚¹ åœ¨å®ç°æœåŠ¡å‘ç°æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šç”¨åˆ°ZooKeeperçš„ä¸´æ—¶èŠ‚ç‚¹ï¼Œåªè¦å®¢æˆ·ç«¯ä¸ZooKeeperä¹‹é—´çš„sessionä¼šè¯æ²¡æœ‰ä¸­æ–­ï¼ˆè¿‡æœŸï¼‰ï¼Œé‚£ä¹ˆåˆ›å»ºçš„ä¸´æ—¶èŠ‚ç‚¹å°±ä¼šå­˜åœ¨ã€‚å½“å®¢æˆ·ç«¯æ‰çº¿ä¸€æ®µæ—¶é—´ï¼Œå¯¹åº”çš„zk sessionä¼šè¿‡æœŸï¼Œé‚£ä¹ˆå¯¹åº”çš„ä¸´æ—¶èŠ‚ç‚¹å°±ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚ åœ¨etcdä¸­å¹¶æ²¡æœ‰ä¸´æ—¶èŠ‚ç‚¹çš„æ¦‚å¿µï¼Œä½†æ˜¯æ”¯æŒleaseç§Ÿçº¦æœºåˆ¶ã€‚ ä»€ä¹ˆå«leaseï¼Ÿå…¶å®å°±æ˜¯etcdæ”¯æŒç”³è¯·å®šæ—¶å™¨ï¼Œæ¯”å¦‚ï¼šå¯ä»¥ç”³è¯·ä¸€ä¸ªTTL=10ç§’çš„leaseï¼ˆç§Ÿçº¦ï¼‰ï¼Œä¼šè¿”å›ç»™ä½ ä¸€ä¸ªlease IDæ ‡è¯†å®šæ—¶å™¨ã€‚ä½ å¯ä»¥åœ¨setä¸€ä¸ªkeyçš„åŒæ—¶æºå¸¦lease IDï¼Œé‚£ä¹ˆå°±å®ç°äº†ä¸€ä¸ªè‡ªåŠ¨è¿‡æœŸçš„keyã€‚ åœ¨etcdä¸­ï¼Œä¸€ä¸ªleaseå¯ä»¥å…³è”ç»™ä»»æ„å¤šçš„Keyï¼Œå½“leaseè¿‡æœŸåæ‰€æœ‰å…³è”çš„keyéƒ½å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚ é‚£ä¹ˆå¦‚ä½•å®ç°ä¸´æ—¶èŠ‚ç‚¹å‘¢ï¼Ÿ é¦–å…ˆç”³è¯·ä¸€ä¸ªTTL=Nçš„leaseï¼Œç„¶åsetä¸€ä¸ªkey with leaseä½œä¸ºè‡ªå·±çš„ä¸´æ—¶èŠ‚ç‚¹ï¼Œåœ¨ç¨‹åºä¸­å®šæ—¶çš„ä¸ºleaseï¼ˆç§Ÿçº¦ï¼‰è¿›è¡Œç»­çº¦ï¼Œä¹Ÿå°±æ˜¯é‡ç½®TTL=Nï¼Œè¿™æ ·å…³è”çš„keyå°±ä¸ä¼šè¿‡æœŸäº†ã€‚ äº‹ä»¶æœºåˆ¶ åœ¨æˆ‘ä»¬ç”¨ZooKeeperå®ç°æœåŠ¡å‘ç°æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šgetChildrenAndWatchæ¥è·å–ä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰åœ¨çº¿èŠ‚ç‚¹ï¼Œè¿™ä¸ªAPIä¼šå…ˆè·å–å½“å‰çš„å­©å­åˆ—è¡¨å¹¶åŒæ—¶æ³¨å†Œäº†ä¸€ä¸ªè§‚å¯Ÿå™¨ã€‚æ¯å½“ZooKeeperå‘ç°å­èŠ‚ç‚¹æœ‰å˜åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šwatchå›è°ƒç»™å®¢æˆ·ç«¯ï¼ˆåŒæ—¶å…³é—­è§‚å¯Ÿå™¨,ï¼‰ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¼šå†æ¬¡è°ƒç”¨getChildrenAndWatchå†æ¬¡è·å–æœ€æ–°çš„å­èŠ‚ç‚¹åˆ—è¡¨å¹¶é‡æ–°æ³¨å†Œè§‚å¯Ÿå™¨ã€‚ Zookeeperçš„äº‹ä»¶æ¨¡å‹ï¼Ÿç®€å•çš„æ¥è¯´ï¼ŒZooKeeperæä¾›äº†ä¸€ä¸ªåŸå­APIï¼Œå®ƒå…ˆè·å–å½“å‰çŠ¶æ€ï¼ŒåŒæ—¶æ³¨å†Œä¸€ä¸ªè§‚å¯Ÿå™¨ï¼Œå½“åç»­å˜åŒ–å‘ç”Ÿæ—¶ä¼šå‘é€ä¸€æ¬¡é€šçŸ¥åˆ°å®¢æˆ·ç«¯ï¼šè·å–å¹¶è§‚å¯Ÿ-&gt;æ”¶åˆ°å˜åŒ–äº‹ä»¶-&gt;è·å–å¹¶è§‚å¯Ÿ-&gt;æ”¶åˆ°å˜åŒ–äº‹ä»¶-&gt;â€¦â€¦ï¼Œå¦‚æ­¤å¾€å¤ã€‚ ZooKeeperçš„äº‹ä»¶æ¨¡å‹éå¸¸å¯é ï¼Œä¸ä¼šå‡ºç°å‘ç”Ÿäº†æ›´æ–°è€Œå®¢æˆ·ç«¯ä¸çŸ¥é“çš„æƒ…å†µï¼Œä½†æ˜¯ç‰¹ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šäº‹ä»¶ä¸åŒ…å«æ•°æ®ï¼Œä»…ä»…æ˜¯é€šçŸ¥å˜åŒ–ã€‚å¤šæ¬¡è¿ç»­çš„æ›´æ–°ï¼Œé€šçŸ¥ä¼šåˆå¹¶æˆä¸€ä¸ªï¼›å³ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°é€šçŸ¥å†æ¬¡æ‹‰å–æ•°æ®ï¼Œä¼šè·³è¿‡ä¸­é—´çš„å¤šä¸ªç‰ˆæœ¬ï¼Œåªæ‹¿åˆ°æœ€æ–°æ•°æ®ã€‚è¿™äº›ç‰¹ç‚¹å¹¶ä¸æ˜¯ç¼ºç‚¹ï¼Œå› ä¸ºä¸€èˆ¬åº”ç”¨åªå…³æ³¨æœ€æ–°çŠ¶æ€ï¼Œå¹¶ä¸å…³æ³¨ä¸­é—´çš„è¿ç»­å˜åŒ–ã€‚ é‚£ä¹ˆetcdçš„äº‹ä»¶æ¨¡å‹å‘¢?åœ¨ç°åœ¨ï¼Œä½ åªéœ€è¦è®°ä½etcdçš„äº‹ä»¶æ˜¯åŒ…å«æ•°æ®çš„ï¼Œå¹¶ä¸”é€šå¸¸æƒ…å†µä¸‹è¿ç»­çš„æ›´æ–°ä¸ä¼šè¢«åˆå¹¶é€šçŸ¥ï¼Œè€Œæ˜¯é€æ¡é€šçŸ¥åˆ°å®¢æˆ·ç«¯ã€‚ å…·ä½“etcdäº‹ä»¶æ¨¡å‹å¦‚ä½•å·¥ä½œï¼Œè¦æ±‚å¯¹etcdçš„K-Vå­˜å‚¨åŸç†å…ˆåšäº†è§£ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä¼šç»“åˆä¸€äº›ç®€å•çš„æºç ï¼Œè¯´ä¸€ä¸‹etcdçš„å­˜å‚¨æ¨¡å‹ï¼Œæœ€åå†æ¥è¯´å®ƒçš„äº‹ä»¶æ¨¡å‹ã€‚","link":"/p/5d3c61fa.html"},{"title":"ğŸ Dubboå®æˆ˜ æ•´åˆ SpringBoot å®ç°è‡ªåŠ¨è£…é…","text":"å¦‚ä»Š Spring Boot åœ¨å¾®æœåŠ¡é¢†åŸŸå·²ååˆ†é£é¡ï¼Œå¼€ç®±å³ç”¨çš„ç‰¹æ€§ï¼Œç®€åŒ–äº†å¾ˆå¤šå¼€å‘å·¥ä½œã€‚è€Œ Dubbo åœ¨ 2017 å¹´é‡æ–°å¾—åˆ°ç»´æŠ¤ä»¥åï¼Œç¤¾åŒºé€æ¸æ´»è·ƒï¼ŒDubbo RPC ååˆ†ä¼˜ç§€ï¼Œæœ¬æ–‡æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ„å»ºä¸€ä¸ªåŸºäº Spring Boot çš„Dubbo å¾®æœåŠ¡å·¥ç¨‹ã€‚ Dubbo Spring Boot Starter é¡¹ç›® æˆ‘ä»¬åœ¨é‡‡ç”¨ Dubbo ä½œä¸º å¾®æœåŠ¡æ¡†æ¶æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¾èµ–è¿™ä¸ªé¡¹ç›®æ¥è½»æ¾æ•´åˆ SpringBoot ä¸Šé¢æ˜¯ Dubbo Spring Boot å·¥ç¨‹åœ°å€ ã€‚Dubbo Spring Boot å·¥ç¨‹è‡´åŠ›äºç®€åŒ– Dubbo RPC æ¡†æ¶åœ¨ Spring Boot åº”ç”¨åœºæ™¯çš„å¼€å‘ã€‚åŒæ—¶ä¹Ÿæ•´åˆäº† Spring Boot ç‰¹æ€§ï¼š SpringBoot Dubbo é¡¹ç›®å®æˆ˜ æˆ‘ä»¬å°†å®ç°ä¸€ä¸ªç®€å•çš„åŸºäºSpringBoot å’Œ Dubbo çš„å¾®æœåŠ¡ä¾‹å­æ¥è¿›è¡Œè®²è§£ã€‚é¡¹ç›®é‡‡ç”¨å¤šæ¨¡å—çš„å½¢å¼æ‰“åŒ…ã€‚åˆ†ä¸ºå¦‚ä¸‹ä¸‰ä¸ªå·¥ç¨‹ï¼š dubbo-boot-apiç»Ÿä¸€ä½¿ç”¨çš„APIå·¥ç¨‹ï¼Œæä¾›ç»™ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼ŒåŒ…æ‹¬æœåŠ¡æ¥å£ç­‰ï¼Œå®ä½“æ¨¡å‹ç­‰ã€‚ dubbo-boot-consumeræœåŠ¡æ¶ˆè´¹ç«¯ï¼Œè¯¥å·¥ç¨‹å°†ä¼šæä¾›webæœåŠ¡ï¼Œå¹¶è°ƒç”¨ Dubbo æä¾›çš„å¾®æœåŠ¡ã€‚ dubbo-boot-provideræœåŠ¡æä¾›æ–¹ï¼Œæä¾›æœåŠ¡ä¾›æ¶ˆè´¹è€…è¿›è¡Œè°ƒç”¨ POM ä¾èµ– é¡¹ç›®æ ¹ POM æ–‡ä»¶ éœ€è¦ä¾èµ– SpringBoot çš„ Parent å·¥ç¨‹ ä½œä¸º çˆ¶å·¥ç¨‹ä»¥æ–¹ä¾¿ç®¡ç†Springçš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬é‡‡ç”¨çš„ç‰ˆæœ¬å·ä¸º Spring Boot 2.0.0.RELEASE 12345&lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.0.0.RELEASE&lt;/version&gt;&lt;/parent&gt; æœåŠ¡æä¾›è€… (dubbo-boot-provider) ã€æœåŠ¡æ¶ˆè´¹è€… (dubbo-boot-consumer) éƒ½éœ€è¦ä¾èµ– dubbo æ•´åˆ Spring çš„dubbo-spring-boot-starterå·¥ç¨‹ï¼Œä»¥åŠ spring-boot-starter-webï¼Œé€šè¿‡ web ä½œä¸ºæœåŠ¡å¯åŠ¨è¿è¡Œè½½ä½“ã€‚ 12345678910111213&lt;!-- Dubbo æ•´åˆ Boot Dubbo ä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt;&lt;/dependency&gt;&lt;!-- Spring Boot Web ä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;&lt;/dependency&gt; API å·¥ç¨‹ dubbo-boot-api apiå·¥ç¨‹ä¸»è¦æä¾›å®ä½“ç±»å’Œå…¬ç”¨æœåŠ¡æ¥å£ï¼Œ providerã€consumer éƒ½ä¼šä¾èµ–å®ƒ å®ä½“ç±» City 123public class City implements Serializable { private String name; private String from; æœåŠ¡æ¥å£ CityService 12345678public interface CityService { /** * æ ¹æ®åŸå¸‚åç§°ï¼ŒæŸ¥è¯¢åŸå¸‚ä¿¡æ¯ * * @param cityName */ City findCityByName(String cityName);} Provider æœåŠ¡æä¾›å·¥ç¨‹ dubbo-boot-provideræœåŠ¡æä¾›å®ç° CityServiceImpl 12345678910111213@Service( version = &quot;${demo.service.version}&quot;, application = &quot;${dubbo.application.id}&quot;, protocol = &quot;${dubbo.protocol.id}&quot;, registry = &quot;${dubbo.registry.id}&quot;)public class CityServiceImpl implements CityService { public City findCityByName(String cityName) { System.out.println(&quot;request cityName: &quot; + cityName); return new City(&quot;æ­¦æ±‰&quot;, &quot;æ¹–åŒ—&quot;); }}å¯åŠ¨ç±» AppProvider ä½¿ç”¨é web çš„å½¢å¼å¯åŠ¨ SpringBoot å®¹å™¨ï¼Œæä¾› Dubbo Rpc æœåŠ¡ 12345678910@SpringBootApplication@EnableDubboConfigurationpublic class App { public static void main(String[] args) { //ä½¿ç”¨é Web ç¯å¢ƒå¯åŠ¨ Springå®¹å™¨ï¼Œæä¾›dubbo rpc æœåŠ¡ new SpringApplicationBuilder().sources(AppProvider.class) .web(WebApplicationType.NONE) .run(args); }} application.properties12345678910111213141516# Spring boot applicationspring.application.name = dubbo-provider-demo## Providerç±»é…ç½®demo.service.version=1.0.0dubbo.application.id = dubbo-boot-providerdubbo.application.name = dubbo-boot-provider## ä½¿ç”¨é€šè®¯åè®®ã€æš´éœ²ç«¯å£dubbo.protocol.id = dubbodubbo.protocol.name = dubbodubbo.protocol.port = 20880## æ³¨å†Œä¸­å¿ƒ ï¼ˆä¸ä½¿ç”¨ï¼Œç›´æ¥æœ¬åœ°äº’è¿ï¼‰dubbo.registry.id = my-registrydubbo.registry.address = N/A Consumer æ¶ˆè´¹è€…å·¥ç¨‹ dubbo-boot-provider Spring Boot Controller ç±»ï¼Œæä¾› Rest æ¥å£ã€‚å¼•ç”¨ Dubbo æœåŠ¡æ¥å£ CityService 12345678910111213@RestControllerpublic class HelloController { @Reference(version = &quot;${demo.service.version}&quot;, application = &quot;${dubbo.application.id}&quot;, url = &quot;${dubbo.service.url}&quot;) private CityService cityService; @RequestMapping(&quot;/hello&quot;) public Object hello() { return cityService.findCityByName(&quot;æ­¦æ±‰&quot;); }} å¯åŠ¨ç±» æä¾› web æœåŠ¡ä¾›å‰ç«¯è°ƒç”¨ 1234567@SpringBootApplicationpublic class AppConsumerServer { public static void main(String[] args) { SpringApplication.run(AppConsumerServer.class, args); }} application.properties æœ¬ä¾‹å­æ²¡æœ‰é‡‡ç”¨æ³¨å†Œä¸­å¿ƒï¼Œè€Œæ˜¯é€šè¿‡æœ¬åœ° url äº’ç›¸ç›´è¿æœåŠ¡ç«¯è¿›è¡Œè°ƒç”¨ã€‚ 123456789spring.application.name=dubbo-boot-consumerdemo.service.version=1.0.0dubbo.application.id=dubbo-boot-consumerdubbo.application.name=dubbo-boot-consumer# é€šè¿‡ç›´è¿æ–¹å¼dubbo.service.url=dubbo://127.0.0.1:20880 æµ‹è¯•åˆ†åˆ«è¿è¡Œå¯åŠ¨æœåŠ¡ç«¯(AppServer) å’Œæ¶ˆè´¹ç«¯(AppConsumerServer) ç±»ã€‚ç„¶åæ‰“å¼€æµè§ˆå™¨è®¿é—® localhost:8080/hello ç»“æœæ˜¾ç¤ºå·²ç»è°ƒç”¨æˆåŠŸã€‚æ•´ä¸ªæ‰§è¡Œé“¾ä¸ºï¼Œå‰ç«¯è®¿é—® url è°ƒç”¨æ¶ˆè´¹ç«¯ Spring Restæ¥å£ï¼ŒController é‡Œé€šè¿‡ Dubbo Rpc è°ƒç”¨ æœåŠ¡ç«¯æä¾›çš„æœåŠ¡ï¼Œç„¶åè¿”å›ã€‚ æ€»ç»“é‡‡ç”¨ Spring Boot å·¥ç¨‹ï¼Œå¼•å…¥ Dubbo æ•´åˆ Spring Boot çš„ ä¾èµ–ï¼Œå°†ä¼šä½¿æˆ‘ä»¬éå¸¸ç®€å•è½»æ¾çš„ä½¿ç”¨ Dubbo æ¥æä¾›å¾®æœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨ Spring Boot çš„ æ³¨è§£é©±åŠ¨ã€è‡ªåŠ¨è£…é…ã€å¤–éƒ¨åŒ–é…ç½®ã€Actuator ç›‘æ§ç­‰ç‰¹æ€§ï¼Œæ¥è½»æ¾ç®¡ç†åŸºäºDubbo çš„å¾®æœåŠ¡ã€‚ ç¤¾åŒºæä¾›çš„ dubbo-spring-boot-starter å·¥ç¨‹ æ•´åˆäº†ä¸ Spring Boot è¿™äº›è‡ªåŠ¨é…ç½®ã€ä¾èµ–ç­‰ã€‚æ‰€ä»¥ä¸‹ä¸€æ­¥æˆ‘ä»¬å°†ä¼šç ”ç©¶ å®ƒæ˜¯å¦‚ä½•å®ç°ä¸ Spring Boot æ— ç¼æ•´åˆçš„ã€‚ æ¨èæœ€åæ¨èä¸€ä¸‹æœ¬äººå¾®ä¿¡å…¬ä¼—å·ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ã€‚","link":"/p/b7f8f92f.html"},{"title":"ç¨‹åºå‘˜å¦‚ä½•ä¿æŒä¼˜ç§€","text":"ç¨‹åºå‘˜å¦‚ä½•ä¿æŒä¼˜ç§€ æœ¬æ–‡æ˜¯è‹±æ–‡åŸæ–‡ How to be an Excellent Programmer for Many Years çš„ç¿»è¯‘, æ‘˜æŠ„è‡ª oldrat lee çš„åšå®¢ 1.å°èŒƒå›´çš„é€‰æ‹©ä¸€äº›æœ‰ç”¨æŠ€æœ¯ï¼Œé€å½»çš„å­¦ä¹ å®ƒä»¬ï¼Œæ‹¥æŠ±å®ƒä»¬ã€‚ç„¶åä¸æ–­çš„æ‰©å±•è¿™ä¸ªèŒƒå›´ã€‚ 2.ç†è§£å„ç§æ•°æ®ç»“æ„çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼ŒåŒ…æ‹¬å®ƒä»¬åœ¨å†…å­˜ä¸­å’Œåœ¨ç¡¬ç›˜ä¸Šçš„å„è‡ªè¡¨ç°ã€‚ 3.ç†è§£å„ç§ç®—æ³•çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚ 4.äº†è§£ä½ çš„å·¥ä½œé¢†åŸŸã€‚å…³ä¸Šç”µè„‘ï¼Œå»åšä½ çš„ç”¨æˆ·ä»¬åœ¨åšçš„äº‹ã€‚ 5.æœ‰å‡†å¤‡ï¼Œæœ‰æ„¿æœ›ï¼Œæœ‰èƒ½åŠ›åœ¨ä»»ä½•æ—¶å€™æŠ•å…¥åˆ°å¤šç§æŠ€æœ¯å±‚é¢ä¸­ã€‚ä½ å¿…é¡»çŸ¥é“è¡¨è±¡ä¸‹çš„æŠ€æœ¯åŸç†ã€‚åœ¨â€œå„ä¸ªæŠ€æœ¯å±‚é¢çš„æŒæ¡ç¨‹åº¦â€å’Œâ€œç¼–ç¨‹èƒ½åŠ›â€ä¸Šæœ‰ç€å¯†åˆ‡çš„è”ç³»ã€‚ 6.å‘æŒ¥ä½ çš„æƒ³è±¡åŠ›ã€‚æ°¸è¿œéƒ½è¦é—®ï¼Œâ€œæœ‰æ›´å¥½çš„æ–¹æ³•å—ï¼Ÿâ€è·³å‡ºå¸¸è§„æ€ç»´çº¦æŸã€‚æœ€å¥½çš„è§£å†³æ–¹æ¡ˆä¹Ÿè®¸è¿˜æ²¡æœ‰è¢«å‘ç°ã€‚ 7.ä¼˜ç§€ç¨‹åºå‘˜ï¼šæˆ‘ä¼˜åŒ–ä»£ç ã€‚æ›´ä¼˜ç§€ç¨‹åºå‘˜ï¼šæˆ‘è®¾è®¡æ•°æ®ã€‚æœ€ä¼˜ç§€ç¨‹åºå‘˜ï¼šä»–ä»¬çš„ä¸åŒä¹‹å¤„æ˜¯ä»€ä¹ˆï¼Ÿ 8.æ­£ç¡®çš„æ„é€ ä½ çš„æ•°æ®ã€‚ä»»ä½•çš„ç¼ºé™·éƒ½å°†é€ æˆä½ çš„ä»£ç é‡Œæ— å°½çš„æŠ€æœ¯å€ºåŠ¡ã€‚ 9.æ­£ç¡®çš„å‘½åäº‹ç‰©ã€‚ä½¿ç”¨â€œåŠ¨è¯-å½¢å®¹è¯-åè¯â€æ ¼å¼æ¥å‘½åç¨‹åºå’Œå‡½æ•°ã€‚å˜é‡åè¦è¶³å¤Ÿé•¿ï¼Œå°½é‡çŸ­ï¼Œæœ‰æ„ä¹‰ã€‚å¦‚æœå…¶ä»–ç¨‹åºå‘˜ä¸èƒ½å¤Ÿç†è§£ä½ çš„ä»£ç ï¼Œè¯´æ˜ä½ å†™çš„ä¸å¤Ÿæ¸…æ¥šã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé’ˆå¯¹ä¸‹ä¸€ä¸ªç¨‹åºå‘˜è€Œç¼–ç è¦æ¯”é’ˆå¯¹ç¯å¢ƒè€Œç¼–ç é‡è¦çš„å¤šã€‚ 10.æŠŠåˆ†æå’Œç¼–ç¨‹åˆ†ç¦»å¼€åšã€‚å®ƒä»¬ä¸æ˜¯åŒç±»çš„äº‹ç‰©ï¼Œéœ€è¦ä¸åŒç±»å‹çš„åŠ³åŠ›èµ„æºï¼Œéœ€è¦åœ¨å®Œå…¨ä¸åŒçš„æ—¶é—´å’Œåœ°ç‚¹åˆ†å¼€åšã€‚å¦‚æœåŒæ—¶åšå®ƒä»¬ï¼Œä½ ä¸€æ ·éƒ½åšä¸å¥½ã€‚(æˆ‘å–œæ¬¢åœ¨ä¸€å¤©çš„æœ«å°¾åšä¸æ¶‰åŠæŠ€æœ¯çš„åˆ†æï¼Œè€Œåœ¨ç¬¬äºŒå¤©æ—©ä¸Šè¿›è¡Œç¼–ç¨‹ã€‚) 11.æ°¸è¿œä¸è¦å›¾çœäº‹èµ°è¿‘é“ã€‚æ°¸è¿œä¸è¦æŠŠç›¸åŒçš„ä»£ç éƒ¨ç½²ä¸¤æ¬¡ã€‚æ°¸è¿œä¸è¦æŠŠä¸€ä¸ªå˜é‡å‘½åæˆå¦ä¸€ä¸ªå˜é‡åçš„ä¸€éƒ¨åˆ†ã€‚ä¹Ÿè®¸ä½ ä¸æ˜ç™½è¿™äº›è§„åˆ™ï¼Œä¹Ÿè®¸ä½ è¦è¾©è§£ã€‚ä½†å¦‚æœä½ æ˜¯éµå®ˆç€è¿™æ ·åšçš„ï¼Œè¿™äº›è§„åˆ™å°±ä¼šçº¦æŸä½ æ­£ç¡®çš„æ„é€ ä½ çš„ç¨‹åºã€‚å›¾çœäº‹çš„åšæ³•æ˜¯è®©é‚£äº›ä½ç­‰çº§çš„ç¨‹åºå‘˜æ°¸è¿œåœç•™åœ¨ä½ç­‰çº§çš„åŸå› ã€‚ 12.å­¦ä¹ å¦‚ä½•æµ‹è¯„ç¨‹åºæ€§èƒ½ã€‚ä½ ä¼šæƒŠå¥‡çš„å‘ç°ä»ä¸­èƒ½å­¦åˆ°å¾ˆå¤šä¹‹å¤–çš„çŸ¥è¯†ã€‚ 13.å­¦ä¼šåŒºåˆ«å¯¹å¾…é—®é¢˜ç»†èŠ‚å’Œé—®é¢˜åæœã€‚é—®é¢˜ç»†èŠ‚ä¸ä¼šå¯¼è‡´å¤ªå¤§çš„å·®åˆ«ï¼Œè€Œé—®é¢˜åæœèƒ½å¯¼è‡´ä¸–ç•Œç­äº¡ã€‚åªå…³æ³¨åæœã€‚ 14.å¯†åˆ‡å…³æ³¨ä½ çš„ç”¨æˆ·/å®¢æˆ·/ç®¡ç†äººå‘˜ã€‚å¸®åŠ©ä»–ä»¬è®¤æ¸…æ¥šä»–ä»¬çš„â€œwhatâ€ï¼Œè¿™æ¯”å¸®åŠ©ä»–ä»¬æ˜ç™½ä»–ä»¬çš„â€œhowâ€è¦é‡è¦çš„å¤šã€‚ 15.å†™ä¸€ä¸ªæ¡†æ¶ï¼Œä¸è®ºä½ æ˜¯å¦æ‰“ç®—ç”¨å®ƒã€‚ä½ å°†ä»ä¸­å­¦åˆ°ä»å…¶å®ƒé€”å¾„ä¸­å­¦ä¸åˆ°çš„ä¸œè¥¿ã€‚ 16.æŠŠä½ çŸ¥é“çš„ä¸œè¥¿æ•™ç»™ä»–äººâ€”â€”é€šè¿‡å£å£äº¤æµæˆ–é€šè¿‡å†™ä½œã€‚æœ€ç»ˆè¿™å°†æˆä¸ºæ•™è‚²è‡ªå·±çš„æœºä¼šã€‚ 17.æ°¸è¿œè¦å¯¹ä½ çš„å®¢æˆ·/ç”¨æˆ·è¯´â€œYesâ€ï¼Œå³ä½¿åœ¨ä½ ä¸ç¡®å®šçš„æƒ…å†µä¸‹ã€‚90%çš„æƒ…å†µä¸‹ï¼Œä½ ä¼šæœ€ç»ˆæ‰¾åˆ°æ–¹æ³•å®ç°å®ƒã€‚10%çš„æœºä¼šï¼Œä½ å°†ä¼šå»å‘ä»–ä»¬é“æ­‰ã€‚è¿™æ˜¯é‡è¦çš„ä¸ªäººæˆé•¿ä¸­ä»˜å‡ºçš„ä¸€ç‚¹å°ä»£ä»·ã€‚ 18.å¯»æ‰¾åˆ«äººçš„åšå‡ºç¥å¥‡çš„äº‹æƒ…ä½†å´ä¸€æ»©ç³Šæ¶‚çš„ä»£ç ã€‚é‡æ„å®ƒã€‚ç„¶åä¸¢æ‰å®ƒï¼Œå¹¶å‘èª“è‡ªå·±æ°¸è¿œä¸è¦çŠ¯ä»–ä»¬çŠ¯ä¸‹çš„ç›¸åŒé”™è¯¯ã€‚(è¿™æ ·çš„ç¨‹åºä½ ä¼šå‘ç°å¾ˆå¤šã€‚) 19.æ•°æ®æ°¸è¿œ &gt; ç†è®ºæˆ–è§‚ç‚¹ã€‚é€šè¿‡å¼€å‘ä¸œè¥¿æ¥å­¦ä¹ æ•°æ®ã€‚ 20.æœ‰å¯èƒ½çš„è¯ï¼Œå¼€åˆ›è‡ªå·±çš„ä¸šåŠ¡(æœåŠ¡æˆ–äº§å“)ã€‚ä½ å°†ä»ä¸­å­¦åˆ°å¾ˆå¤šä½ åšé›‡å‘˜æ°¸è¿œå­¦ä¸åˆ°çš„å…³äºç¼–ç¨‹çš„çŸ¥è¯†ã€‚ 21.å¦‚æœä¸å–œçˆ±ä½ ç°åœ¨çš„å·¥ä½œï¼Œå°±æ¢ä¸€ä¸ªã€‚","link":"/p/c81b0f21.html"},{"title":"Hello World","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.i just change something by hexo-tag-aplayer Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","link":"/p/4a17b156.html"},{"title":"Jqueryéå†ä¸JSäº‹ä»¶å•ç‹¬å¤„ç†","text":"æœ€è¿‘åœ¨å·¥ä½œä¸Šé¢ç¢°åˆ°å¦‚ä¸‹éœ€æ±‚ï¼Œè¦å°†ä¸‹é¢ä¸‰åˆ—ä¸­çš„å¤§äº100%çš„æ•°æ®éƒ½ä»¥100%æ˜¾ç¤ºï¼Œå°äºçš„åˆ™ä¸å¤„ç†ã€‚ç”±äºæŠ¥è¡¨æ•°æ®æ˜¯åœ¨åå°ç»„åˆçš„ï¼Œæ¯ä¸ªæŒ‡æ ‡é—´çš„æ•°æ®éƒ½æ˜¯å–è‡ªç¼“å­˜ï¼Œå¦‚æœç›´æ¥åœ¨åå°è¿›è¡Œé€»è¾‘å¤„ç†ï¼Œä¼šæ‰“ä¹±å¾ˆå¤šä¸šåŠ¡å¤„ç†æµç¨‹ï¼Œå› æ­¤ç»è¿‡ä¸€ç•ªç¢ç£¨åï¼Œå†³å®šåœ¨å‰å°é¡µé¢è¿›è¡Œä¿®æ”¹ï¼Œç­‰æŠ¥è¡¨ç»„åˆå®Œæ¯•åã€‚ éœ€æ±‚åˆ†æ è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼ŒæŠ¥è¡¨å±•ç¤ºé¡µé¢ä¸ºé™æ€çš„HTMLæ–‡ä»¶ï¼Œå‰åå°æ˜¯åˆ†ç¦»çš„ï¼Œæ•°æ®é€šè¿‡AJAXè°ƒç”¨åå°æ¥å£ï¼Œå› æ­¤ï¼Œè¯·æ±‚ä¸åŒçš„IDä¼šæœ‰ä¸åŒçš„æŠ¥è¡¨åœ¨ç›¸åŒçš„é¡µé¢è¿›è¡Œå±•ç¤ºï¼Œå¦‚æœç›´æ¥åœ¨JSä¸­å†™å¤„ç†é€»è¾‘çš„è¯ï¼Œä¼šå¯¼è‡´å…¶ä»–æŠ¥è¡¨çš„TABLEç›¸åŒçš„éƒ¨åˆ†ä¹Ÿä¼šè¢«å¤„ç†ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚ è¿™æ˜¯éœ€æ±‚ è¿™æ˜¯å¤„ç†åçš„ç»“æœ å‰å°æ•°æ®ä¿®æ”¹ é€šè¿‡Jqueryåœ¨æŠ¥è¡¨ç”Ÿæˆä¹‹åï¼Œå¯¹æŒ‡å®šçš„æ•°æ®è¿›è¡Œä¿®æ”¹ 12345678910111213var str = &quot;0,1,2&quot;;function reset_percent(str){ var arr=str.split(&quot;,&quot;); if (arr.length&gt;0){ $(&quot;.table_body table tbody tr&quot;).each(function(i,n){ for (var j=0; j&lt;arr.length;j++){ if(parseInt($(n).children(&quot;td:eq(&quot;+parseInt(arr[j])+&quot;)&quot;).html())&gt;=100){ $(n).children(&quot;td:eq(&quot;+parseInt(arr[j])+&quot;)&quot;).html(&quot;100%&quot;); } } }) } } åˆ†æ,æˆ‘ä»¬å…ˆåˆ†ææŠ¥è¡¨çš„ç»„æˆç»“æ„ï¼Œç±»ä¼¼äºå¦‚ä¸‹ç»“æ„ 123456789101112131415161718&lt;table&gt; &lt;thead&gt; &lt;tr&gt; &lt;th&gt;&lt;/th&gt; &lt;th&gt;&lt;/th&gt; &lt;th&gt;&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt;&lt;tbody&gt; &lt;tr&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt;&lt;/table&gt; æˆ‘ä»¬å¯ä»¥é€šè¿‡Jqueryé€‰æ‹©å™¨å…ˆæ‰¾åˆ°tableï¼Œç„¶åæ‰¾åˆ°tbodyï¼Œå†æ‰¾åˆ°tbodyä¸‹é¢çš„trï¼Œç„¶åé€šè¿‡eachå‡½æ•°å¯¹trè¿›è¡Œéå†ï¼Œä½¿å¾—æ¯ä¸ªträ¸‹é¢å…·ä½“éœ€è¦çš„ç¬¬å‡ ä¸ªtdçš„æ•°æ®è¿›è¡Œæ”¹å˜ï¼Œå› æ­¤ä»£ç å¦‚ä¸‹ 12345678910111213//é‡ç½® ä¸‰åˆ—çš„ç™¾åˆ†æ¯”function reset_percent(str){ var arr=str.split(&quot;,&quot;); if (arr.length&gt;0){ $(&quot;.table_body table tbody tr&quot;).each(function(i,n){ for (var j=0; j&lt;arr.length;j++){ if(parseInt($(n).children(&quot;td:eq(&quot;+parseInt(arr[j])+&quot;)&quot;).html())&gt;=100){ $(n).children(&quot;td:eq(&quot;+parseInt(arr[j])+&quot;)&quot;).html(&quot;100%&quot;); } } }) } } å¦‚ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡éå†æ¯ä¸€ä¸ªtrå…ƒç´ ï¼Œæ‰¾åˆ°trå…ƒç´ ä¸‹é¢å…·ä½“çš„tdè¿›è¡Œä¿®æ”¹ï¼Œæˆ‘ä»¬åœ¨å…¶ä»–åœ°æ–¹è°ƒç”¨ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œä¼ å…¥éœ€è¦æ”¹å˜çš„å‡ åˆ—çš„å­—ç¬¦ä¸²ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtdçš„indexæ˜¯ä»¥0å¼€å¤´çš„ï¼Œæ‰€ä»¥æ”¹å˜ç¬¬ä¸€åˆ—tdçš„è¯ï¼Œå°±ä»0å¼€å§‹ã€‚ åå°å¤„ç† åå°æŠ¥è¡¨æ¨¡å‹é‡Œé¢æ·»åŠ ï¼ŒJSäº‹ä»¶å¤„ç†ï¼Œå³æ¯ä¸€ä¸ªæŠ¥è¡¨éƒ½å¯ä»¥é…ç½®è‡ªå·±éœ€è¦çš„JS Handler äº‹ä»¶ï¼Œå½“ç„¶ï¼Œè¿™äº›äº‹ä»¶æå‰å†™å¥½åœ¨ä¸€ä¸ªJSæ–‡ä»¶é‡Œï¼Œåªæ˜¯æˆ‘ä»¬æ ¹æ®ä¸åŒçš„æŠ¥è¡¨å»å…·ä½“çš„è°ƒç”¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒæŠ¥è¡¨Açš„æ¨¡å‹é‡Œæœ‰ä¸€æ æ˜¯å†™JSçš„ï¼Œå¦‚ä¸‹ï¼š å°†é…ç½®å†™åœ¨æ¨¡å‹çš„sqlä¸­è¿›è¡Œä¿å­˜ï¼Œä»¥XMLæ ¼å¼ä¿å­˜ï¼Œç„¶åé€šè¿‡Simple XMLè¿›è¡Œè§£æï¼Œæˆ‘ä¹‹å‰ä¹Ÿå†™è¿‡Simple XMLè§£æXMLçš„æ–¹å¼ï¼Œä¼ é€é—¨ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ç»„è£…æŠ¥è¡¨ä¹‹å‰ï¼Œå’Œç»„è£…æŠ¥è¡¨ä¹‹åï¼Œåˆ†åˆ«åˆ¤æ–­ä»åå°ä¼ æ¥çš„ç»“æœæ˜¯å¦åŒ…å«é¢å¤–çš„äº‹ä»¶å¤„ç† 12345678function build_table_simple(jsonData){ reset_title_link(); //æ˜¯å¦æœ‰é™„åŠ å¤„ç†js if (additionHandle!=null &amp;&amp; additionHandle.execute_time==&quot;create_table_before&quot;){ eval(additionHandle.execute_function); } .... çœç•¥ å¦‚æœæœ‰è¦å¤„ç†çš„è¯ï¼Œé€šè¿‡eval()è§£æå­—ç¬¦ä¸²ï¼Œè®©å­—ç¬¦ä¸²å…·æœ‰JSçš„äº‹ä»¶å¤„ç†èƒ½åŠ›ï¼Œä¼ æ¥çš„å­—ç¬¦ä¸²ç›¸å½“äºè°ƒç”¨äº†ä¸Šé¢å†™çš„é‚£ä¸ªæ–¹æ³•ï¼Œå¹¶ä¼ å…¥äº†å…·ä½“éœ€è¦ä¿®æ”¹çš„tdåˆ—ã€‚ æ€»ç»“ æˆ‘ä»¬åœ¨ä¸šåŠ¡å¤„ç†ä¸­ï¼Œå¾ˆå¤šè¡¨æ ¼éƒ½æ˜¯é€šè¿‡éå†æ¥ç»„æˆçš„ï¼Œå› æ­¤ä½ æ— æ³•æ‰‹åŠ¨å»ä¿®æ”¹è¡¨æ ¼é‡Œé¢å“ªä¸€è¡Œé‚£ä¸€åˆ—å…·ä½“çš„å€¼ã€‚è€Œä¸”å¾ˆå¤šé¡µé¢æ˜¯å…¬ç”¨çš„ï¼Œä»–é€šè¿‡ä¼ å…¥IDçš„ä¸åŒå±•ç¤ºä¸åŒçš„è¡¨æ ¼å’Œæ•°æ®ï¼Œè¿™æ ·çš„è¯ï¼Œä½ å¦‚æœåœ¨é¡µé¢å¼•ç”¨çš„JSé‡Œé¢ç›´æ¥è°ƒç”¨å¤„ç†å‡½æ•°ï¼Œè¿™æ ·å…¶ä»–çš„æŠ¥è¡¨ä¹Ÿä¼šå—åˆ°å½±å“ï¼Œå› æ­¤ï¼Œæœ€å¥½çš„æ–¹æ³•å°±æ˜¯ï¼Œä¸åŒçš„æŠ¥è¡¨é…ç½®ä¸åŒçš„äº‹åJSå¤„ç†äº‹ä»¶ï¼Œå­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå½“è°ƒç”¨è¿™ä¸ªæŠ¥è¡¨æ—¶ï¼Œä¹Ÿè°ƒç”¨ç›¸å¯¹åº”çš„JSå¤„ç†å‡½æ•°ï¼Œè¿™æ ·éœ€æ±‚ä¹Ÿå°±è§£å†³äº†ã€‚ END","link":"/p/15049d29.html"},{"title":"hexo+githubæ­å»ºåšå®¢","text":"ä½¿ç”¨github pagesæœåŠ¡æ­å»ºåšå®¢çš„å¥½å¤„æœ‰ï¼šå…¨æ˜¯é™æ€æ–‡ä»¶ï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼›å…è´¹æ–¹ä¾¿ï¼Œä¸ç”¨èŠ±ä¸€åˆ†é’±å°±å¯ä»¥æ­å»ºä¸€ä¸ªè‡ªç”±çš„ä¸ªäººåšå®¢ï¼Œä¸éœ€è¦æœåŠ¡å™¨ä¸éœ€è¦åå°ï¼›å¯ä»¥éšæ„ç»‘å®šè‡ªå·±çš„åŸŸåï¼Œä¸ä»”ç»†çœ‹çš„è¯æ ¹æœ¬çœ‹ä¸å‡ºæ¥ä½ çš„ç½‘ç«™æ˜¯åŸºäºgithubçš„ï¼›æ•°æ®ç»å¯¹å®‰å…¨ï¼ŒåŸºäºgithubçš„ç‰ˆæœ¬ç®¡ç†ï¼Œæƒ³æ¢å¤åˆ°å“ªä¸ªå†å²ç‰ˆæœ¬éƒ½è¡Œï¼›åšå®¢å†…å®¹å¯ä»¥è½»æ¾æ‰“åŒ…ã€è½¬ç§»ã€å‘å¸ƒåˆ°å…¶å®ƒå¹³å°ï¼› åˆå§‹åŒ–hexoä¹‹åï¼Œè¦å®‰è£…è¿™ä¸ªæ’ä»¶ è¿™ä¸ªæ’ä»¶çš„ä¸»è¦ä½œç”¨æ˜¯ç«™å†…æœç´¢ï¼Œinsight.jsä¾èµ–è¿™ä¸ªåŒ…ç®¡ç† 1$ npm install hexo-generator-json-content@2.2.0 --save å®‰è£…å®Œæˆä¹‹åï¼Œæ£€æŸ¥ç‰ˆæœ¬ 1$ npm hexo-generator-json-content -v é…ç½®SSH Key é€šè¿‡git bash æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ 1$ cd ~/. ssh #æ£€æŸ¥æœ¬æœºå·²å­˜åœ¨çš„sshå¯†é’¥ å¦‚æœæç¤ºï¼šNo such file or directory è¯´æ˜ä½ æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨gitã€‚ 1ssh-keygen -t rsa -C &quot;yourname@qq.com&quot; ç„¶åè¿ç»­3æ¬¡å›è½¦ï¼Œæœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åœ¨ç”¨æˆ·ç›®å½•ä¸‹ï¼Œæ‰“å¼€ç”¨æˆ·ç›®å½•ï¼Œæ‰¾åˆ°.ssh\\id_rsa.pubæ–‡ä»¶ï¼Œè®°äº‹æœ¬æ‰“å¼€å¹¶å¤åˆ¶é‡Œé¢çš„å†…å®¹ï¼Œæ‰“å¼€ä½ çš„githubä¸»é¡µï¼Œè¿›å…¥ä¸ªäººè®¾ç½® -&gt; SSH and GPG keys -&gt; New SSH keyï¼š æµ‹è¯•æ˜¯å¦æˆåŠŸ 1$ ssh -T git@github.com # æ³¨æ„ç›´æ¥æ•²è¿™æ¡å‘½ä»¤,é‚®ç®±åœ°å€ä¸ç”¨æ”¹ å¦‚æœæç¤ºAre you sure you want to continue connecting (yes/no)?ï¼Œè¾“å…¥yesï¼Œç„¶åä¼šçœ‹åˆ°ï¼š 1Hi leihuazhe! Youâ€™ve successfully authenticated, but GitHub does not provide shell access. çœ‹åˆ°è¿™ä¸ªä¿¡æ¯è¯´æ˜SSHå·²é…ç½®æˆåŠŸï¼ æ­¤æ—¶ä½ è¿˜éœ€è¦é…ç½®ï¼š 12$ git config --global user.name &quot;leihuazhe&quot;// ä½ çš„githubç”¨æˆ·åï¼Œéæ˜µç§°$ git config --global user.email &quot;xxx@qq.com&quot;// å¡«å†™ä½ çš„githubæ³¨å†Œé‚®ç®± è¿™æ˜¯gitçš„åˆå§‹å…¨å±€é…ç½® hexoçš„éƒ¨åˆ†å‘½ä»¤ 123456$ cnpm install -g hexo #å®‰è£…hexo$ hexo init #åˆå§‹åŒ–$ hexo g #ç¼–è¯‘ç”Ÿæˆpublic$ hexo s #å¯åŠ¨æœ¬åœ°æœåŠ¡ï¼Œå¯ä»¥åœ¨localhost:4200è¿›è¡Œé¢„è§ˆ$ hexo d #æ¨é€åˆ°githubä¸Š,ä¸‹é¢è¯¦ç»†ä»‹ç»$ hexo clean #åˆ é™¤publicæ–‡ä»¶å¤¹ å¦‚æœä½ ä¸€åˆ‡éƒ½é…ç½®å¥½äº†ï¼Œå‘å¸ƒä¸Šä¼ å¾ˆå®¹æ˜“ï¼Œä¸€å¥hexo då°±æå®šï¼Œå½“ç„¶å…³é”®è¿˜æ˜¯ä½ è¦æŠŠæ‰€æœ‰ä¸œè¥¿é…ç½®å¥½ã€‚ é¦–å…ˆï¼Œssh keyè‚¯å®šè¦é…ç½®å¥½ã€‚ å…¶æ¬¡ï¼Œé…ç½®_config.ymlä¸­æœ‰å…³deployçš„éƒ¨åˆ†ï¼š 1234deploy: type: git repository: git@github.com:liuxianan/liuxianan.github.io.git branch: master å¦‚æœéƒ½é…ç½®å¥½äº†ï¼Œè¿˜æ—¶æŠ¥ä¸‹é¢çš„é”™ 12$ hexo dERROR Deployer not found: git è¯•ä¸‹å®‰è£…å¦‚ä¸‹æ’ä»¶ 1cnpm install hexo-deployer-git --save ç„¶åä¸€åˆ‡okï¼Œhexoåšå®¢æ­å»ºæˆåŠŸ å¸¸è§é—®é¢˜ å½“æˆ‘åœ¨å¦ä¸€å°ç”µè„‘ä¸Šé¢æŠŠæºç ä¸‹è½½ä¸‹æ¥åï¼Œé‡æ–°éƒ¨ç½²æ—¶ï¼Œå‘ç°æ‰€æœ‰çš„ç›®å½•éƒ½è¢«ä¸Šä¼ åˆ°äº†githubä¸Š è§£å†³æ–¹æ³•ï¼š åˆ é™¤ç›®å½•ä¸‹çš„ .deploy_git å…·ä½“æ­å»ºè¯·å‚è€ƒ END","link":"/p/1bda8925.html"},{"title":"ç©è½¬nginx  nginxå¸¸ç”¨é…ç½®ä¹‹è´Ÿè½½å‡è¡¡","text":"nginx ä½œä¸ºé™æ€æ–‡ä»¶æœåŠ¡å™¨1234567891011121314server { listen 8001; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_connect_timeout 600; proxy_read_timeout 600; proxy_send_timeout 600; proxy_set_header X-Forwarded-For $http_x_forwarded_for; client_max_body_size 20m; location / { root /etc/nginx/html/store_app/dist/; index index.html; } nginx åå‘ä»£ç†åˆ°ä¸Šè¿°èŠ‚ç‚¹1234567891011121314server { listen 8000; root /etc/nginx/html/store_app; location ~* /store_app/ { autoindex on; rewrite ^/(.*)$ http://10.10.10.36:8001 permanent; break; } error_log /var/log/nginx/demo.log; access_log /var/log/nginx/demo.log;} ç”Ÿäº§ nginx eywa é…ç½®1234567891011121314151617181920212223242526272829303132333435363738394041424344454647upstream eywa { server 192.168.10.125:8081; server 192.168.20.115:8081; ip_hash;}server { listen 80; server_name eywa.today36524.com rewrite / https://eywa.today36524.com$uri permanent;}server { listen 443 ssl; server_name eywa.today36524.com; ssl_certificate /etc/nginx/cert/today36524.com.pem; ssl_certificate_key /etc/nginx/cert/today36524.com.key; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers xxxxxxxxxxxxx xxxxxxx access_log /var/log/nginx/eywa-443.log error_log /var/log/nginx/eywa-error443.log proxy_connect_timeout 600; proxy_read_timeout 600; proxy_send_timeout 6000; gzip off; gzip_buffers 16 8k; gzip_comp_level 5; gzip_ location /{ send_timeout 300; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwardad_for; proxy_pass http://eywa; }}","link":"/p/cbcade0e.html"},{"title":"HttpClientåŸºç¡€(ä¸€)","text":"HttpClientæ˜¯ Apache Jakarta Commonä¸‹çš„å­é¡¹ç›®,å¯ä»¥ç”¨æ¥æä¾›é«˜æ•ˆçš„ã€æœ€æ–°çš„ã€åŠŸèƒ½ä¸°å¯Œçš„æ”¯æŒHTTPåè®®çš„å®¢æˆ·ç«¯ç¼–ç¨‹å·¥å…·åŒ…ï¼Œæœ¬æ–‡é‡‡ç”¨çš„HttpClientç‰ˆæœ¬æ˜¯4.4.1è®¸å¤šéœ€è¦åå°æ¨¡æ‹Ÿè¯·æ±‚çš„ç³»ç»Ÿæˆ–è€…æ¡†æ¶éƒ½ç”¨çš„æ˜¯httpclientã€‚æ‰€ä»¥ä½œä¸ºä¸€ä¸ªjavaå¼€å‘äººå‘˜ï¼Œæœ‰å¿…è¦å­¦ä¸€å­¦ã€‚æœ¬æ–‡æä¾›äº†ä¸€ä¸ªç®€å•çš„demoï¼Œä¾›åˆå­¦è€…å‚è€ƒã€‚ ä½¿ç”¨HttpClientå‘é€è¯·æ±‚ã€æ¥æ”¶å“åº”å¾ˆç®€å•ï¼Œä¸€èˆ¬éœ€è¦å¦‚ä¸‹å‡ æ­¥å³å¯ï¼š åˆ›å»ºCloseableHttpClientå¯¹è±¡ã€‚ åˆ›å»ºè¯·æ±‚æ–¹æ³•çš„å®ä¾‹ï¼Œå¹¶æŒ‡å®šè¯·æ±‚URLã€‚å¦‚æœéœ€è¦å‘é€GETè¯·æ±‚ï¼Œåˆ›å»ºHttpGetå¯¹è±¡ï¼›å¦‚æœéœ€è¦å‘é€POSTè¯·æ±‚ï¼Œåˆ›å»ºHttpPostå¯¹è±¡ã€‚ å¦‚æœéœ€è¦å‘é€è¯·æ±‚å‚æ•°ï¼Œå¯å¯è°ƒç”¨setEntity(HttpEntity entity)æ–¹æ³•æ¥è®¾ç½®è¯·æ±‚å‚æ•°ã€‚setParamsæ–¹æ³•å·²è¿‡æ—¶ï¼ˆ4.4.1ç‰ˆæœ¬ï¼‰ã€‚ è°ƒç”¨HttpGetã€HttpPostå¯¹è±¡çš„setHeader(String name, String value)æ–¹æ³•è®¾ç½®headerä¿¡æ¯ï¼Œæˆ–è€…è°ƒç”¨setHeaders(Header[] headers)è®¾ç½®ä¸€ç»„headerä¿¡æ¯ã€‚ è°ƒç”¨CloseableHttpClientå¯¹è±¡çš„execute(HttpUriRequest request)å‘é€è¯·æ±‚ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªCloseableHttpResponseã€‚ è°ƒç”¨HttpResponseçš„getEntity()æ–¹æ³•å¯è·å–HttpEntityå¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…è£…äº†æœåŠ¡å™¨çš„å“åº”å†…å®¹ã€‚ç¨‹åºå¯é€šè¿‡è¯¥å¯¹è±¡è·å–æœåŠ¡å™¨çš„å“åº”å†…å®¹ï¼› è°ƒç”¨CloseableHttpResponse çš„getAllHeaders()ã€getHeaders(String name)ç­‰æ–¹æ³•å¯è·å–æœåŠ¡å™¨çš„å“åº”å¤´ã€‚ é‡Šæ”¾è¿æ¥ã€‚æ— è®ºæ‰§è¡Œæ–¹æ³•æ˜¯å¦æˆåŠŸï¼Œéƒ½å¿…é¡»é‡Šæ”¾è¿æ¥ ä¸‹é¢æ˜¯ä¸€ä¸ªPOSTå¸¦å‚æ•°è¯·æ±‚çš„ä¾‹å­ï¼Œè®¿é—®å¤©æ°”ç½‘ç«™,ç”¨åˆ°çš„HttpClientç‰ˆæœ¬æ˜¯4.4.1 12345678910111213141516171819202122232425262728293031323334353637public static String send(String url, Map&lt;String, String&gt; map, String encoding) throws IOException{ String body = &quot;&quot;; //1.åˆ›å»ºå¯¹è±¡ CloseableHttpClient httpClient = HttpClients.createDefault(); //2.åˆ›å»ºè¯·æ±‚æ–¹å¼ HttpPost post = new HttpPost(url); //3.è£…å¡«å‚æ•° List&lt;NameValuePair&gt; nvp = new ArrayList&lt;&gt;(); if(map !=null){ for (Entry&lt;String, String&gt; entry : map.entrySet()) { nvp.add(new BasicNameValuePair(entry.getKey(), entry.getValue())); } } //4.è®¾ç½®å‚æ•°åˆ°è¯·æ±‚å¯¹è±¡ä¸­ post.setEntity(new UrlEncodedFormEntity(nvp,encoding)); System.out.println(&quot;è¯·æ±‚åœ°å€ï¼š----&quot;+url); System.out.println(&quot;è¯·æ±‚å‚æ•°ï¼š-----&quot;+nvp.toString()); //5.è®¾ç½®å¤´éƒ¨ä¿¡æ¯ post.setHeader(&quot;Content-type&quot;, &quot;application/x-www-form-urlencoded&quot;); post.setHeader(&quot;User-Agent&quot;, &quot;Mozilla/4.0 (compatible; MSIE 5.0; Windows NT; DigExt)&quot;); //6.æ‰§è¡Œè¯·æ±‚ CloseableHttpResponse response = httpClient.execute(post); //7.è·å–ç»“æœ HttpEntity entity = response.getEntity(); if(entity!=null){ //æŒ‰æŒ‡å®šç¼–ç è½¬æ¢ç»“æœå®ä½“ä¸ºStringç±»å‹ System.out.println(&quot;entity----&quot;+entity); body = EntityUtils.toString(entity, encoding); } response.close(); return body;} æµ‹è¯•1234567891011121314151617181920212223public static void main(String[] args) throws IOException { String url=&quot;http://php.weather.sina.com.cn/iframe/index/w_cl.php&quot;; Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;(); map.put(&quot;code&quot;, &quot;js&quot;); map.put(&quot;day&quot;, &quot;0&quot;); map.put(&quot;city&quot;, &quot;æ­¦æ±‰&quot;); map.put(&quot;dfc&quot;, &quot;1&quot;); map.put(&quot;charset&quot;, &quot;utf-8&quot;); String body = send(url1, map,&quot;utf-8&quot;); System.out.println(&quot;äº¤æ˜“å“åº”ç»“æœï¼š&quot;); System.out.println(body); System.out.println(&quot;-----------------------------------&quot;); map.put(&quot;city&quot;, &quot;åŒ—äº¬&quot;); body = send(url, map, &quot;utf-8&quot;); System.out.println(&quot;äº¤æ˜“å“åº”ç»“æœï¼š&quot;); System.out.println(body); } ç»“æœ12345678è¯·æ±‚åœ°å€ï¼š----http://php.weather.sina.com.cn/iframe/index/w_cl.phpè¯·æ±‚å‚æ•°ï¼š-----[dfc=1, charset=utf-8, code=js, city=æ­¦æ±‰, day=0]entity----org.apache.http.client.entity.DecompressingEntity@548e7350äº¤æ˜“å“åº”ç»“æœï¼š(function(){var w=[];w['æ­¦æ±‰']=[{s1:'æ™´',s2:'æ™´',f1:'qing',f2:'qing',t1:'28',t2:'20',p1:'â‰¤3',p2:'â‰¤3',d1:'æ— æŒç»­é£å‘',d2:'æ— æŒç»­é£å‘'}];var add={now:'2017-09-11 20:14:23',time:'1505132063',update:'åŒ—äº¬æ—¶é—´09æœˆ11æ—¥17:10æ›´æ–°',error:'0',total:'1'};window.SWther={w:w,add:add};})();//0 æ³¨æ„ï¼Œé™æ€æ–‡ä»¶ä¸æ¥å—postè¯·æ±‚Apacheã€IISã€Nginxç­‰ç»å¤§å¤šæ•°webæœåŠ¡å™¨ï¼Œéƒ½ä¸å…è®¸é™æ€æ–‡ä»¶å“åº”POSTè¯·æ±‚ï¼Œå¦åˆ™ä¼šè¿”å›HTTP/1.1 405 Method not allowedé”™è¯¯ã€‚ è§£å†³æ–¹æ³•ï¼Œä¿®æ”¹nginxé…ç½®12345location ^~ /m/coupon { root /data/server/h5.weidian.com; error_page 405 =200 https://$host$request_uri;} é™„å„ç§è¯·æ±‚çš„å†™æ³•1.GETè¯·æ±‚12345678910111213141516171819202122232425262728293031public class DoGET { public static void main(String[] args) throws Exception { // åˆ›å»ºHttpclientå¯¹è±¡ CloseableHttpClient httpclient = HttpClients.createDefault(); // åˆ›å»ºhttp GETè¯·æ±‚ HttpGet httpGet = new HttpGet(&quot;http://www.baidu.com/&quot;); CloseableHttpResponse response = null; try { // æ‰§è¡Œè¯·æ±‚ response = httpclient.execute(httpGet); // åˆ¤æ–­è¿”å›çŠ¶æ€æ˜¯å¦ä¸º200 if (response.getStatusLine().getStatusCode() == 200) { String content = EntityUtils.toString(response.getEntity(), &quot;UTF-8&quot;); System.out.println(&quot;å†…å®¹é•¿åº¦ï¼š&quot; + content.length()); } } finally { if (response != null) { response.close(); } httpclient.close(); } }} 2.å¸¦å‚æ•°çš„GETè¯·æ±‚123456789101112131415161718192021222324252627282930313233343536public class DoGETParam { public static void main(String[] args) throws Exception { // åˆ›å»ºHttpclientå¯¹è±¡ CloseableHttpClient httpclient = HttpClients.createDefault(); // å®šä¹‰è¯·æ±‚çš„å‚æ•° URI uri = new URIBuilder(&quot;http://www.baidu.com/s&quot;).setParameter(&quot;wd&quot;, &quot;java&quot;).build(); System.out.println(uri); // åˆ›å»ºhttp GETè¯·æ±‚ HttpGet httpGet = new HttpGet(uri); CloseableHttpResponse response = null; try { // æ‰§è¡Œè¯·æ±‚ response = httpclient.execute(httpGet); // åˆ¤æ–­è¿”å›çŠ¶æ€æ˜¯å¦ä¸º200 if (response.getStatusLine().getStatusCode() == 200) { String content = EntityUtils.toString(response.getEntity(), &quot;UTF-8&quot;); System.out.println(content); } } finally { if (response != null) { response.close(); } httpclient.close(); } }} 3.POSTè¯·æ±‚1234567891011121314151617181920212223242526272829303132public class DoPOST { public static void main(String[] args) throws Exception { // åˆ›å»ºHttpclientå¯¹è±¡ CloseableHttpClient httpclient = HttpClients.createDefault(); // åˆ›å»ºhttp POSTè¯·æ±‚ HttpPost httpPost = new HttpPost(&quot;http://www.oschina.net/&quot;); CloseableHttpResponse response = null; try { // æ‰§è¡Œè¯·æ±‚ response = httpclient.execute(httpPost); // åˆ¤æ–­è¿”å›çŠ¶æ€æ˜¯å¦ä¸º200 if (response.getStatusLine().getStatusCode() == 200) { String content = EntityUtils.toString(response.getEntity(), &quot;UTF-8&quot;); System.out.println(content); } } finally { if (response != null) { response.close(); } httpclient.close(); } }} 4.å¸¦å‚æ•°çš„POSTè¯·æ±‚123456789101112131415161718192021222324252627282930313233343536373839public class DoPOSTParam { public static void main(String[] args) throws Exception { // åˆ›å»ºHttpclientå¯¹è±¡ CloseableHttpClient httpclient = HttpClients.createDefault(); // åˆ›å»ºhttp POSTè¯·æ±‚ HttpPost httpPost = new HttpPost(&quot;http://www.oschina.net/search&quot;); // è®¾ç½®2ä¸ªpostå‚æ•°ï¼Œä¸€ä¸ªæ˜¯scopeã€ä¸€ä¸ªæ˜¯q List&lt;NameValuePair&gt; parameters = new ArrayList&lt;NameValuePair&gt;(0); parameters.add(new BasicNameValuePair(&quot;scope&quot;, &quot;project&quot;)); parameters.add(new BasicNameValuePair(&quot;q&quot;, &quot;java&quot;)); // æ„é€ ä¸€ä¸ªformè¡¨å•å¼çš„å®ä½“ UrlEncodedFormEntity formEntity = new UrlEncodedFormEntity(parameters); // å°†è¯·æ±‚å®ä½“è®¾ç½®åˆ°httpPostå¯¹è±¡ä¸­ httpPost.setEntity(formEntity); CloseableHttpResponse response = null; try { // æ‰§è¡Œè¯·æ±‚ response = httpclient.execute(httpPost); // åˆ¤æ–­è¿”å›çŠ¶æ€æ˜¯å¦ä¸º200 if (response.getStatusLine().getStatusCode() == 200) { String content = EntityUtils.toString(response.getEntity(), &quot;UTF-8&quot;); System.out.println(content); } } finally { if (response != null) { response.close(); } httpclient.close(); } } }","link":"/p/e103ddbe.html"},{"title":"ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (äº”) 2.5.x ç‰ˆæœ¬è‡ªå®šä¹‰ Action","text":"ç”±äºç›®å‰åœ¨å…¬å¸ä½¿ç”¨çš„ Play ç‰ˆæœ¬æ˜¯ 2.5.4ï¼Œæœ¬ç« å°†ä¼šè®²è§£ä¸€ä¸‹å¯¹æ­¤ç‰ˆæœ¬ Action çš„ç›¸å…³çŸ¥è¯†ã€‚ ä½¿ç”¨ ActionBuilder æ„å»ºä¸€ä¸ªé€šç”¨çš„ Action12345678910object LogAction extends ActionBuilder[Request] { override def invokeBlock[A](request: Request[A], block: (Request[A]) =&gt; Future[Result]): Future[Result] = { val start = System.currentTimeMillis() block(request).map { result =&gt; val duration = System.currentTimeMillis() - start println(s&quot;è¯·æ±‚ $request è€—æ—¶ $duration&quot;) result } }}","link":"/p/6e951315.html"},{"title":"ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (ä¸‰) Asynchronous results","text":"æœ¬ç« æˆ‘ä»¬å°†è®²è§£ä½¿ç”¨ Play è¿›è¡Œå¼‚æ­¥éé˜»å¡ç¼–ç¨‹æƒ…å†µä¸‹ï¼Œå¦‚ä½•å¤„ç†å¼‚æ­¥è¿”å›ç»“æœçš„é—®é¢˜ã€‚ Handling asynchronous results ä»ç°åœ¨å¼€å§‹æˆ‘ä»¬å°†è¿›å…¥å¼‚æ­¥ http ç¼–ç¨‹æ¨¡å—ï¼Œæœ¬ç« å°†ä¼šä»‹ç»å¦‚ä½•å¤„ç†å¼‚æ­¥è¿”å›ç»“æœã€‚ Make controllers asynchronous ä½¿ controllers å˜ä¸ºå¼‚æ­¥çš„ åœ¨ Play Framework å†…éƒ¨ï¼Œå…¶æœºåˆ¶æ˜¯è‡ªåº•å‘ä¸Šå…¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼çš„ï¼ŒPlay ä¼šä»¥å¼‚æ­¥ã€éé˜»å¡çš„æ–¹å¼å¤„ç†æ¯ä¸ªè¯·æ±‚ã€‚ é»˜è®¤é…ç½®(configuration) é’ˆå¯¹å¼‚æ­¥æ§åˆ¶å™¨(asynchronous controllers) è¿›è¡Œäº†ä¼˜åŒ–ã€‚æ¢å¥è¯è¯´ï¼Œåº”ç”¨ç¨‹åºä»£ç åº”è¯¥å°½é‡é¿å…åœ¨æ§åˆ¶å™¨ä¸­è¿›è¡Œé˜»å¡,è¿™æ ·ä¼šå¯¼è‡´æ§åˆ¶å™¨ä¸€ç›´ç­‰å¾…é‚£ä¸ªé˜»å¡çš„æ“ä½œã€‚æ­¤ç±»é˜»å¡æ“ä½œçš„å¸¸è§ç¤ºä¾‹æœ‰JDBCè°ƒç”¨ã€æµAPIã€HTTPè¯·æ±‚å’Œé•¿è®¡ç®—ç­‰ã€‚ è™½ç„¶å¯ä»¥å¢åŠ é»˜è®¤ executionContext ä¸­çº¿ç¨‹çš„æ•°é‡ï¼Œä»¥å…è®¸é˜»å¡æ§åˆ¶å™¨å¤„ç†æ›´å¤šçš„å¹¶å‘è¯·æ±‚ï¼Œä½†æ˜¯éµå¾ªå»ºè®®çš„ä¿æŒæ§åˆ¶å™¨å¼‚æ­¥çš„æ–¹æ³•å¯ä»¥æ›´å®¹æ˜“åœ°è¿›è¡Œæ‰©å±•ï¼Œå¹¶åœ¨è´Ÿè½½ä¸‹ä¿æŒç³»ç»Ÿå“åº”ã€‚ Creating non-blocking actions åˆ›å»ºéé˜»å¡çš„ actions ç”±äº Play çš„å·¥ä½œæ–¹å¼ï¼Œaction ä»£ç å¿…é¡»å°½å¯èƒ½å¿«ï¼Œå³éé˜»å¡ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿˜æ²¡æœ‰ç”Ÿæˆç»“æœæƒ…å½¢ä¸‹ï¼Œå¦‚ä½•è¿”å›ç»“æœå‘¢?ç­”æ¡ˆæ˜¯ä½¿ç”¨ Futureã€‚ A Future[Result] will eventually be redeemed with a value of type Result. By giving a Future[Result] instead of a normal Result, we are able to quickly generate the result without blocking. Play will then serve the result as soon as the promise is redeemed. The web client will be blocked while waiting for the response, but nothing will be blocked on the server, and server resources can be used to serve other clients. Using a Future is only half of the picture though! ç„¶è€Œï¼Œä½¿ç”¨Futureåªæ˜¯è¿™å¹…ç”»çš„ä¸€åŠ. (ä½¿ç”¨ Future åªæ˜¯ Play å¼‚æ­¥ç¼–ç¨‹çš„ä¸€åŠ) If you are calling out to a blocking API such as JDBC,then you still will need to have your ExecutionStage(æ‰§è¡Œé˜¶æ®µ) run with a different executor, to move it off Playâ€™s rendering thread pool. You can do this by creating a subclass of play.api.libs.concurrent.CustomExecutionContextwith a reference to the custom dispatcher. è¿™é‡Œæ„æ€æ˜¯å¦‚æœé’ˆå¯¹é•¿æ—¶é—´é˜»å¡çš„ä»»åŠ¡ï¼Œæ¯”å¦‚JDBCï¼Œåƒä¸Šè¿°æ–¹å¼æ“ä½œï¼Œæˆ‘ä»¬åªä¸è¿‡æ˜¯æŠŠå½“å‰ä»»åŠ¡çš„æ‰§è¡Œæ”¾åˆ°äº†å¦å¤–ä¸€æ¡çº¿ç¨‹ä¸­ç»§ç»­é˜»å¡äº†è€Œå·²ï¼Œå› æ­¤ä»ç„¶æ˜¯å‡å¼‚æ­¥ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è‡ªå®šä¹‰çš„CustomExecutionContext 1234567891011121314151617import play.api.libs.concurrent.CustomExecutionContext//è¯·ç¡®ä¿ä½¿ç”¨&quot;Scala Dependency Injection&quot;æ–‡æ¡£é¡µé¢ä¸­åˆ—å‡ºçš„ custom binding æŠ€æœ¯ä¹‹ä¸€//å°† new context ç»‘å®šåˆ°å½“å‰ trait trait MyExecutionContext extends ExecutionContextclass MyExecutionContextImpl @Inject()(system: ActorSystem) extends CustomExecutionContext(system, &quot;my.executor&quot;) with MyExecutionContextclass HomeController @Inject()(myExecutionContext: MyExecutionContext, val controllerComponents: ControllerComponents) extends BaseController { def index = Action.async { Future { // Call some blocking API Ok(&quot;result of blocking call&quot;) }(myExecutionContext) }} How to create a Future[Result] è¦åˆ›å»ºä¸€ä¸ª Future[Result]ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¦ä¸€ä¸ªfuture, è¿™ä¸ª future ä¼šç»™æˆ‘ä»¬è¿”å›æˆ‘ä»¬éœ€è¦è®¡ç®—çš„å®é™…çš„ç»“æœã€‚ 1234val futurePIValue: Future[Double] = computePIAsynchronously()val futureResult: Future[Result] = futurePIValue.map { pi =&gt; Ok(&quot;PI value computed: &quot; + pi)} All of Playâ€™s asynchronous API calls give you a Future. This is the case whether you are calling an external web service using the play.api.libs.WS API, or using Akka to schedule asynchronous tasks or to communicate with actors using play.api.libs.Akka. PlayFramework æ‰€æœ‰å¼‚æ­¥çš„ API è¿”å›çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ª Futureï¼Œæ— è®ºä½ æ˜¯é€šè¿‡ play.api.libs.WS API è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨çš„ web æœåŠ¡ï¼Œæˆ–è€…ä½¿ç”¨Akkaè°ƒåº¦å¼‚æ­¥ä»»åŠ¡ï¼Œæˆ–è€…ä½¿ç”¨ play. API .lib .Akkaä¸ actor é€šä¿¡ç­‰ç­‰ï¼Œè¿”å›éƒ½æ˜¯ Futureã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡å¼‚æ­¥æ¨¡å¼æ‰§è¡Œä¸€æ®µé˜»å¡çš„ä»£ç ï¼Œå¹¶è¿”å›ä¸€ä¸ª Future ç®€å•çš„ä¾‹å­ 123val futureInt: Future[Int] = scala.concurrent.Future { intensiveComputation()} æ³¨æ„ç‚¹Itâ€™s important to understand which thread code runs on with futures. In the two code blocks above, there is an import on Plays default execution context. This is an implicit parameter that gets passed to all methods on the future API that accept callbacks. The execution context will often be equivalent to a thread pool, though not necessarily. ç†è§£å“ªäº›çº¿ç¨‹ä»£ç åœ¨ Future ä¸Šè¿è¡Œæ˜¯å¾ˆé‡è¦çš„ã€‚åœ¨ä¸Šé¢çš„ä¸¤ä¸ªä»£ç å—ä¸­ï¼Œåœ¨ Play é»˜è®¤ executionContext ä¸Šæœ‰ä¸€ä¸ªå¯¼å…¥ã€‚è¿™æ˜¯ä¸€ä¸ªéšå¼å‚æ•°ï¼Œä¼ é€’ç»™ future APIä¸Šæ‰€æœ‰æ¥å—å›è°ƒçš„æ–¹æ³•ã€‚executionContext é€šå¸¸ç­‰ä»·äºçº¿ç¨‹æ± ï¼Œä½†ä¹Ÿä¸ä¸€å®šã€‚ You canâ€™t magically turn synchronous IO into asynchronous by wrapping it in a Future. If you canâ€™t change the applicationâ€™s architecture to avoid blocking operations, at some point that operation will have to be executed, and that thread is going to block. So in addition to enclosing the operation in a Future, itâ€™s necessary to configure it to run in a separate execution context that has been configured with enough threads to deal with the expected concurrency. See Understanding Play thread pools for more information, and download the play example templates that show database integration. ä½ ä¸èƒ½é€šè¿‡å°†ä»£ç å—åŒ…è£…åœ¨ä¸€ä¸ª Futureä¸‹æ¥ç¥å¥‡åœ°æŠŠåŒæ­¥IOå˜æˆå¼‚æ­¥çš„ã€‚å¦‚æœæ‚¨ä¸èƒ½æ›´æ”¹åº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„ä»¥é¿å…é˜»å¡æ“ä½œï¼Œé‚£ä¹ˆåœ¨æŸä¸ªæ—¶åˆ»ï¼Œè¯¥æ“ä½œå°†ä¸å¾—ä¸æ‰§è¡Œï¼Œè€Œè¯¥çº¿ç¨‹å°†é˜»å¡ã€‚ å› æ­¤ï¼Œé™¤äº†å°†æ“ä½œå°è£…åœ¨ Future ä¸­ä¹‹å¤–ï¼Œè¿˜éœ€è¦å°†å…¶é…ç½®ä¸ºåœ¨ä¸€ä¸ªå•ç‹¬çš„ executionContext ä¸­è¿è¡Œï¼Œè¯¥ä¸Šä¸‹æ–‡ä¸­å·²ç»é…ç½®äº†è¶³å¤Ÿçš„çº¿ç¨‹æ¥å¤„ç†é¢„æœŸçš„å¹¶å‘ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§äº†è§£Playçº¿ç¨‹æ± ï¼Œå¹¶ä¸‹è½½æ˜¾ç¤ºæ•°æ®åº“é›†æˆçš„Playç¤ºä¾‹æ¨¡æ¿ It can also be helpful to use Actors for blocking operations. Actors provide a clean model for handling timeouts and failures, setting up blocking execution contexts, and managing any state that may be associated with the service. Also Actors provide patterns like ScatterGatherFirstCompletedRouter to address simultaneous cache and database requests and allow remote execution on a cluster of backend servers. But an Actor may be overkill depending on what you need. å¯¹äºé˜»å¡æ“ä½œåœºæ™¯ï¼Œä½¿ç”¨ Actors æ¨¡å¼æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚Actors æä¾›äº†ä¸€ä¸ªç®€å•ä¸€ä¸ªç®€å•çš„æ¨¡å‹ï¼Œæ¥å¤„ç†è¶…æ—¶ã€æ•…éšœã€è®¾ç½®é˜»å¡çš„ executionContext ä»¥åŠä¸æœåŠ¡å…³è”çš„ä»»ä½•çŠ¶æ€ã€‚ Actors è¿˜æä¾›äº†åƒ â€œScatterGatherFirstCompletedRouterâ€ è¿™æ ·çš„æ¨¡å¼æ¥å¤„ç†åŒæ­¥ç¼“å­˜å’Œæ•°æ®åº“è¯·æ±‚ï¼Œå¹¶å…è®¸åœ¨åç«¯æœåŠ¡å™¨é›†ç¾¤ä¸Šè¿œç¨‹æ‰§è¡Œã€‚ä½†æ˜¯ä¸€ä¸ª actor å¯èƒ½ä¼šå› ä¸ºä½ çš„éœ€è¦è€Œ overkillã€‚ Returning futures è¿”å› futures While we were using the Action.apply builder method to build actions until now, to send an asynchronous result we need to use the Action.async builder method: å½“æˆ‘ä»¬ä½¿ç”¨ Action.apply æ—¶ï¼Œå°† builder æ–¹æ³•åº”ç”¨äº actions ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¦å‘é€å¼‚æ­¥ç»“æœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¼‚æ­¥çš„ Actiton builder æ–¹æ³• 1234def index = Action.async { val futureInt = scala.concurrent.Future { intensiveComputation() } futureInt.map(i =&gt; Ok(&quot;Got result: &quot; + i))} Actions are asynchronous by default é»˜è®¤æƒ…å†µä¸‹ï¼ŒActions æ˜¯å¼‚æ­¥çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„æ§åˆ¶å™¨ä»£ç ä¸­ï¼Œä»£ç çš„{Ok(â€¦)} éƒ¨åˆ†ä¸æ˜¯æ§åˆ¶å™¨çš„æ–¹æ³•ä½“ã€‚å®ƒæ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¢«ä¼ é€’ç»™ Action å¯¹è±¡çš„ applyæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ª Action ç±»å‹çš„å¯¹è±¡ã€‚åœ¨å†…éƒ¨ï¼Œæ‚¨ç¼–å†™çš„åŒ¿åå‡½æ•°å°†è¢«è°ƒç”¨ï¼Œå…¶ç»“æœå°†è¿”å›åœ¨ Futureä¸­ã€‚ 123def echo = Action { request =&gt; Ok(&quot;Got request [&quot; + request + &quot;]&quot;)} Note: Both Action.apply and Action.async create Action objects that are handled internally in the same way. There is a single kind of Action, which is asynchronous, and not two kinds (a synchronous one and an asynchronous one). The .async builder is just a facility to simplify creating actions based on APIs that return a Future, which makes it easier to write non-blocking code. æ³¨æ„Action.apply å’Œ Action.async åœ¨å†…éƒ¨éƒ½ä»¥ç›¸åŒçš„æ–¹å¼æ¥å¤„ç† Action å¯¹è±¡ã€‚ æœ‰ä¸€ç§å•ç‹¬çš„ Actionï¼Œå®ƒæ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯ä¸æ˜¯a synchronous one and an asynchronous one ä¸­çš„ä¸€ç§ã€‚ .async builderåªæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºåœ¨åˆ›å»º actions æ—¶åŸºäºè¿”å› Future result çš„ api çš„æ“ä½œè¿›è¡Œç®€åŒ–ï¼Œè¿™ä½¿å¾—ç¼–å†™éé˜»å¡ä»£ç æ›´åŠ å®¹æ˜“ã€‚ Handling time-outs å¤„ç†è¶…æ—¶æƒ…å†µ æ­£ç¡®å¤„ç†è¶…æ—¶ï¼Œé¿å… web æµè§ˆå™¨é˜»å¡å¹¶åœ¨å‡ºç°é—®é¢˜æ—¶ç­‰å¾…ï¼Œè¿™é€šå¸¸å¾ˆæœ‰ç”¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ play.api.libs.concurrent.Futures æ¥å°†éé˜»å¡çš„è¶…æ—¶åŒ…è£…åœ¨ä¸€ä¸ª Futures ä¸­ 123456789101112import scala.concurrent.duration._import play.api.libs.concurrent.Futures._def index = Action.async { // ä½ å¯ä»¥éšå¼çš„æä¾›ä¸€ä¸ªè¶…æ—¶å‚æ•°ï¼Œè¿™é¢˜å“¦ä½ æ­Œå”±å¯ä»¥é€šè¿‡controllerçš„æ„é€ å‚æ•°æ¥è¾¾åˆ°ã€‚ intensiveComputation().withTimeout(1.seconds).map { i =&gt; Ok(&quot;Got result: &quot; + i) }.recover { case e: scala.concurrent.TimeoutException =&gt; InternalServerError(&quot;timeout&quot;) }} æ³¨æ„è¶…æ—¶(Timeout)ä¸å–æ¶ˆ(cancellation) æ˜¯ä¸åŒçš„ã€‚å¯¹äºè¶…æ—¶è€Œè¨€ï¼Œå³ä½¿å‡ºç°äº†è¶…æ—¶ï¼Œç»™å®šçš„ Future ä»ç„¶ä¼šå®Œæˆï¼Œå³ä½¿æœªè¿”å›å·²å®Œæˆçš„å€¼ã€‚","link":"/p/fe729f21.html"},{"title":"ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (äºŒ) Action Composition","text":"æœ¬ç« å°†è®²è§£ Action çš„ç»„æˆå’ŒåŸç†,å¹¶ä¸”ä»‹ç»äº†å‡ ç§å®šä¹‰é€šç”¨ Action çš„æ–¹æ³•ã€‚ Action composition Action ç»„æˆç»“æ„ Custom action builders è‡ªå®šä¹‰ action buildersæˆ‘ä»¬æœ‰å¤šç§æ–¹æ³•æ¥å£°æ˜ä¸€ä¸ª Actionï¼Œä½¿ç”¨ request å‚æ•°,ä¸ä½¿ç”¨ request å‚æ•°, ä½¿ç”¨ body parser ç­‰ç­‰ã€‚å®é™…ä¸Šï¼Œå¹¶ä¸æ­¢è¿™äº›ï¼Œæˆ‘ä»¬å°†åœ¨å¼‚æ­¥ç¼–ç¨‹ä¸€èŠ‚è¿›è¡Œè®²è¿°ã€‚ è¿™äº›ç”¨äºæ„å»º actions çš„æ–¹æ³•å®é™…ä¸Šéƒ½æ˜¯ç”±ä¸€ä¸ªåä¸º ActionBuilder çš„ trait å®šä¹‰çš„ã€‚è€Œæˆ‘ä»¬ç”¨æ¥å£°æ˜ Action çš„ Action Object åªæ˜¯è¿™ä¸ª trait çš„ä¸€ä¸ªå®ä¾‹ã€‚é€šè¿‡å®ç°è‡ªå·±çš„ ActionBuilderï¼Œæ‚¨å¯ä»¥å£°æ˜å¯é‡ç”¨çš„ action stackï¼Œç„¶åå¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æ„å»º actionsã€‚ è®©æˆ‘ä»¬ä»æ—¥å¿—ä¿®é¥°ç¬¦(logging decorator) çš„ç®€å•ç¤ºä¾‹å¼€å§‹ï¼Œæˆ‘ä»¬å¸Œæœ›è®°å½•å¯¹ action çš„æ¯æ¬¡è°ƒç”¨æ—¥å¿—ã€‚ ç¬¬ä¸€ç§æ–¹æ³•æ˜¯åœ¨ invokeBlock æ–¹æ³•ä¸­å®ç°è¿™ä¸ªåŠŸèƒ½ï¼ŒActionBuilder æ„å»ºçš„æ¯ä¸€ä¸ª action éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ 123456789import play.api.mvc._class LoggingAction @Inject() (parser: BodyParsers.Default)(implicit ec: ExecutionContext) extends ActionBuilderImpl(parser) { override def invokeBlock[A](request: Request[A], block: (Request[A]) =&gt; Future[Result])={ Logger.info(&quot;Calling action&quot;) block(request) }} ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ controllers ä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥è·å– LoggingAction çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”ä»¥ä½¿ç”¨æ™®é€š Action çš„æ–¹å¼æ¥ä½¿ç”¨å®ƒã€‚ 1234567class MyController @Inject()(loggingAction: LoggingAction, cc:ControllerComponents) extends AbstractController(cc) { def index = loggingAction { Ok(&quot;Hello World&quot;) }} Since ActionBuilder provides all the different methods of building actions, this also works with, for example, declaring a custom body parser: ç”±äº ActionBuilder æä¾›äº†åˆ›å»º actions æ‰€æœ‰ä¸åŒçš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è‡ªå®šä¹‰çš„ Action ä¸­ä½¿ç”¨ body parser ç­‰æ™®é€š Action çš„åŠŸèƒ½ã€‚ 123def submit = loggingAction(parse.text) { request =&gt; Ok(&quot;Got a body &quot; + request.body.length + &quot; bytes long&quot;)} ç»„åˆ actions Composing actions åœ¨å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­,æˆ‘ä»¬å¸Œæœ›æœ‰å¤šä¸ª action builders, æ¯”å¦‚ä¸€äº›åšä¸åŒç±»å‹çš„ authentication, ä¸€äº›æä¾›ä¸åŒç±»å‹çš„é€šç”¨åŠŸèƒ½ç»„ä»¶,ç­‰ç­‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹,æˆ‘ä»¬ä¸æƒ³ä¸ºæ¯ä¸€ä¸ª action builder é‡å†™ loggingActionï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªå¯é‡ç”¨çš„æ–¹å¼æ¥ç®€åŒ–ä»£ç ã€‚å¯é‡ç”¨çš„æ“ä½œä»£ç å¯ä»¥é€šè¿‡åŒ…è£…æ“ä½œï¼ˆwrapping actionsï¼‰æ¥å®ç° 123456789101112import play.api.mvc._case class Logging[A](action: Action[A]) extends Action[A] { def apply(request: Request[A]): Future[Result] = { Logger.info(&quot;Calling action&quot;) action(request) } override def parser = action.parser override def executionContext = action.executionContext} We can also use the Action action builder to build actions without defining our own action class: æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Action action builder æ¥ åˆ›å»º actions è€Œä¸éœ€è¦å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„ action class 123456import play.api.mvc._def logging[A](action: Action[A])= Action.async(action.parser) { request =&gt; Logger.info(&quot;Calling action&quot;) action(request)} å¯ä»¥ä½¿ç”¨ composeAction æ–¹æ³•å°† Action æ··åˆåˆ° action builders ä¸­ 123456class LoggingAction @Inject() (parser: BodyParsers.Default)(implicit ec: ExecutionContext) extends ActionBuilderImpl(parser) { override def invokeBlock[A](request: Request[A], block: (Request[A]) =&gt; Future[Result]) = { block(request) } override def composeAction[A](action: Action[A]) = new Logging(action)} é€šè¿‡è¿™æ · code åä½¿ç”¨ï¼Œæ•ˆæœå’Œä¹‹å‰çš„ä¾‹å­ä¸€æ · 123def index = loggingAction { Ok(&quot;Hello World&quot;)} æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä¸ä½¿ç”¨ action builder çš„æƒ…å†µä¸‹å°† action æ··åˆåˆ° wrapping actions ä¸­ 12345def index = Logging { Action { Ok(&quot;Hello World&quot;) }} More complicated actions æ›´å¤æ‚çš„ Action åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªå±•ç¤ºäº†å®Œå…¨ä¸ä¼šå½±å“è¯·æ±‚çš„ actionsã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹ä¼ å…¥çš„è¯·æ±‚å¯¹è±¡è¿›è¡Œè¯»å–å’Œä¿®æ”¹ã€‚ 123456789101112import play.api.mvc._import play.api.mvc.request.RemoteConnectiondef xForwardedFor[A](action: Action[A]) = Action.async(action.parser) { request =&gt; val newRequest = request.headers.get(&quot;X-Forwarded-For&quot;) match { case None =&gt; request case Some(xff) =&gt; val xffConnection = RemoteConnection(xff, request.connection.secure, None) request.withConnection(xffConnection) } action(newRequest)} Note: Play already has built in support for X-Forwarded-For headers. æˆ‘ä»¬å¯ä»¥ block è¯·æ±‚ 12345678910import play.api.mvc._import play.api.mvc.Results._def onlyHttps[A](action: Action[A]) = Action.async(action.parser) { request =&gt; request.headers.get(&quot;X-Forwarded-Proto&quot;).collect { case &quot;https&quot; =&gt; action(request) } getOrElse { Future.successful(Forbidden(&quot;Only HTTPS requests allowed&quot;)) }} æœ€åæˆ‘ä»¬è¿˜èƒ½ä¿®æ”¹è¿”å›çš„ç»“æœ 12345import play.api.mvc._def addUaHeader[A](action: Action[A]) = Action.async(action.parser) { request =&gt; action(request).map(_.withHeaders(&quot;X-UA-Compatible&quot; -&gt; &quot;Chrome=1&quot;))} Different request types ä¸åŒçš„è¯·æ±‚ç±»å‹ è™½ç„¶ action composition å…è®¸æ‚¨åœ¨ HTTP request å’Œ response çº§åˆ«æ‰§è¡Œé¢å¤–çš„å¤„ç†ï¼Œä½†æ˜¯æ‚¨é€šå¸¸å¸Œæœ›æ„å»ºæ•°æ®è½¬æ¢ç®¡é“( pipelines)ï¼Œä»¥ä¾¿å‘è¯·æ±‚æœ¬èº«æ·»åŠ ä¸Šä¸‹æ–‡(context) æˆ– æ‰§è¡ŒéªŒè¯(perfom validation)ã€‚ ActionFunction å¯ä»¥çœ‹ä½œæ˜¯ä½œç”¨åœ¨ request ä¸Šçš„ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¾“å…¥è¯·æ±‚ç±»å‹å’Œä¼ é€’åˆ°ä¸‹ä¸€å±‚çš„è¾“å‡ºç±»å‹ä¸Šéƒ½å‚æ•°åŒ–ã€‚ æ¯ä¸ªæ“ä½œå‡½æ•°éƒ½å¯ä»¥è¡¨ç¤ºæ¨¡å—å¤„ç†ï¼Œä¾‹å¦‚èº«ä»½éªŒè¯ã€å¯¹è±¡çš„æ•°æ®åº“æŸ¥æ‰¾ã€æƒé™æ£€æŸ¥æˆ–å¸Œæœ›è·¨æ“ä½œç»„åˆå’Œé‡ç”¨çš„å…¶ä»–æ“ä½œã€‚ ä¸€äº›å®ç°äº†å®ç° ActionFunction çš„é¢„å®šä¹‰çš„ trait å¯¹äºä¸åŒç±»å‹çš„å¤„ç†éå¸¸æœ‰ç”¨ã€‚ ActionTransformer can change the request, for example by adding additional information. å¯ä»¥æ”¹å˜ä¸€ä¸ªè¯·æ±‚ï¼Œä¾‹å¦‚ä¸ºæ­¤è¯·æ±‚æ·»åŠ é¢å¤–ä¿¡æ¯ç­‰ã€‚ ActionFilter can selectively intercept requests, for example to produce errors, without changing the request value. å¯ä»¥é€‰æ‹©æ€§çš„æ‹¦æˆªè¯·æ±‚ï¼Œä¾‹å¦‚åœ¨ä¸æ”¹å˜è¯·æ±‚çš„å‰æä¸‹äº§ç”Ÿä¸€ä¸ªé”™è¯¯ã€‚ ActionRefiner is the general case of both of the above. ä¸Šé¢ä¸¤ä¸ª trait çš„é€šç”¨çˆ¶ç±»(trait)ã€‚ ActionBuilder is the special case of functions that take Request as input, and thus can build actions. ä»¥ â€œRequestâ€œ ä½œä¸ºè¾“å…¥çš„å‡½æ•°çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå¹¶ä¸”æ˜¯å¦å¯ä»¥æ„å»º actionsã€‚ 123456789101112131415161718192021222324252627282930313233343536373839trait ActionRefiner[-R[_], +P[_]] extends ActionFunction[R, P] { /** * ç¡®å®šæ€ä¹ˆå¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™æ˜¯ç»§æ‰¿ ActionRefiner åéœ€è¦å®ç°çš„ä¸»æ–¹æ³•ã€‚ * * å®ƒå¯ä»¥å†³å®šç«‹å³æ‹¦æˆªè¯·æ±‚å¹¶è¿”å›ç»“æœ(Left)ï¼Œæˆ–è€…ç»§ç»­å¤„ç†ç±»å‹ä¸ºPçš„æ–°å‚æ•°(Right)ã€‚ * * @return Either a result or a new parameter to pass to the Action block */ protected def refine[A](request: R[A]): Future[Either[Result, P[A]]] final def invokeBlock[A](request: R[A], block: P[A] =&gt; Future[Result]) = refine(request).flatMap(_.fold(Future.successful, block))(executionContext)}trait ActionFilter[R[_]] extends ActionRefiner[R, R] { /** * ç¡®å®šæ˜¯å¦å¤„ç†è¯·æ±‚ã€‚è¿™æ˜¯ ActionFilter å¿…é¡»å®ç°çš„ä¸»è¦æ–¹æ³• * * å®ƒå¯ä»¥å†³å®šç«‹å³æ‹¦æˆªè¯·æ±‚å¹¶è¿”å›ç»“æœ(Some)ï¼Œæˆ–è€…ç»§ç»­å¤„ç†(None)ã€‚ * * @return An optional Result with which to abort the request */ protected def filter[A](request: R[A]): Future[Option[Result]] final protected def refine[A](request: R[A]) = filter(request).map(_.toLeft(request))(executionContext)}trait ActionTransformer[-R[_], +P[_]] extends ActionRefiner[R, P] { /** *æ‰©å±•æˆ–è½¬æ¢ç°æœ‰è¯·æ±‚ã€‚è¿™æ˜¯ActionTransformerå¿…é¡»å®ç°çš„ä¸»è¦æ–¹æ³• * @return The new parameter to pass to the Action block */ protected def transform[A](request: R[A]): Future[P[A]] final def refine[A](request: R[A]) = transform(request).map(Right(_))(executionContext)} æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å®ç° invokeBlock æ–¹æ³•å®šä¹‰è‡ªå·±çš„ ActionFunctionã€‚è¿™æ ·é€šå¸¸å¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºè¯·æ±‚çš„è¾“å…¥å’Œè¾“å‡ºç±»å‹å®ä¾‹(ä½¿ç”¨ WrappedRequest)ï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸¥æ ¼å¿…éœ€çš„ã€‚ Authentication action functions æœ€å¸¸è§çš„ç”¨ä¾‹ä¹‹ä¸€æ˜¯èº«ä»½éªŒè¯ã€‚æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°æˆ‘ä»¬è‡ªå·±çš„èº«ä»½éªŒè¯æ“ä½œè½¬æ¢å™¨ï¼Œå®ƒä»åŸå§‹è¯·æ±‚ç¡®å®šç”¨æˆ·å¹¶å°†å…¶æ·»åŠ åˆ°æ–°çš„ UserRequestã€‚æ³¨æ„ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ª ActionBuilderï¼Œå› ä¸ºå®ƒæ¥å—ä¸€ä¸ªç®€å•çš„è¯·æ±‚ä½œä¸ºè¾“å…¥ 12345678910import play.api.mvc._class UserRequest[A](val username: Option[String], request: Request[A]) extends WrappedRequest[A](request)class UserAction @Inject()(val parser: BodyParsers.Default)(implicit val executionContext: ExecutionContext) extends ActionBuilder[UserRequest, AnyContent] with ActionTransformer[Request, UserRequest] { def transform[A](request: Request[A]) = Future.successful { new UserRequest(request.session.get(&quot;username&quot;), request) }} å†…ç½®çš„ authentication action builder åªæ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„å¸®åŠ©ç¨‹åºï¼Œå®ƒå¯ä»¥æœ€å°åŒ–å®ç°ç®€å•æƒ…å†µä¸‹èº«ä»½éªŒè¯æ‰€éœ€çš„ä»£ç ï¼Œå…¶å®ç°ä¸ä¸Šé¢çš„ç¤ºä¾‹éå¸¸ç›¸ä¼¼ã€‚ ç”±äºç¼–å†™è‡ªå·±çš„èº«ä»½éªŒè¯å¸®åŠ©ç¨‹åºå¾ˆç®€å•ï¼Œæ‰€ä»¥å¦‚æœå†…ç½®çš„å¸®åŠ©ç¨‹åºä¸é€‚åˆæ‚¨çš„éœ€è¦ï¼Œæˆ‘ä»¬å»ºè®®è¿™æ ·åšã€‚","link":"/p/beeb0951.html"},{"title":"RocketMQ(ä¸€):ç¯å¢ƒæ­å»º","text":"RocketMQ æ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼ã€é˜Ÿåˆ—æ¨¡å‹çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼šèƒ½å¤Ÿä¿è¯ä¸¥æ ¼çš„æ¶ˆæ¯é¡ºåº,æä¾›ä¸°å¯Œçš„æ¶ˆæ¯æ‹‰å–æ¨¡å¼,é«˜æ•ˆçš„è®¢é˜…è€…æ°´å¹³æ‰©å±•èƒ½åŠ›,å®æ—¶çš„æ¶ˆæ¯è®¢é˜…æœºåˆ¶,äº¿çº§æ¶ˆæ¯å †ç§¯èƒ½åŠ›, å‰ç½®çŸ¥è¯† sshå·¥å…·è¿æ¥linuxå·¥å…·SecureCRT é¢œè‰²è®¾ç½®,å‚è€ƒ ä¸­æ–‡ä¹±ç ï¼Œå‚è€ƒ Linuxç›¸å…³çŸ¥è¯†centos7 é˜²ç«å¢™firewalldçš„åŸºæœ¬ä½¿ç”¨,å‚è€ƒ å¯åŠ¨ï¼š systemctl start firewalld æŸ¥çœ‹çŠ¶æ€ï¼š systemctl status firewalld åœæ­¢ï¼š systemctl disable firewalld ç¦ç”¨ï¼š systemctl stop firewalld é…ç½®firewalld-cmd æŸ¥çœ‹ç‰ˆæœ¬ï¼š firewall-cmd --version æŸ¥çœ‹å¸®åŠ©ï¼š firewall-cmd --help æ˜¾ç¤ºçŠ¶æ€ï¼š firewall-cmd --state æŸ¥çœ‹æ‰€æœ‰æ‰“å¼€çš„ç«¯å£ï¼š firewall-cmd --zone=public --list-ports æ›´æ–°é˜²ç«å¢™è§„åˆ™ï¼š firewall-cmd --reload æŸ¥çœ‹åŒºåŸŸä¿¡æ¯: firewall-cmd --get-active-zones æŸ¥çœ‹æŒ‡å®šæ¥å£æ‰€å±åŒºåŸŸï¼š firewall-cmd --get-zone-of-interface=eth0 æ‹’ç»æ‰€æœ‰åŒ…ï¼šfirewall-cmd --panic-on å–æ¶ˆæ‹’ç»çŠ¶æ€ï¼š firewall-cmd --panic-off æŸ¥çœ‹æ˜¯å¦æ‹’ç»ï¼š firewall-cmd --query-panic å¼€å¯ä¸€ä¸ªå¯¹å¤–ç«¯å£æ­¥éª¤ å…ˆæŸ¥çœ‹æ˜¯å¦å¼€å¯ï¼ŒæŸ¥çœ‹æ‰€æœ‰æ‰“å¼€çš„ç«¯å£: firewall-cmd --zone=public --list-ports æ·»åŠ :firewall-cmd --zone=public --add-port=80/tcp --permanent(â€“permanentæ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±æ•ˆ) 1234//å‘½ä»¤å«ä¹‰ï¼šâ€“zone #ä½œç”¨åŸŸâ€“add-port=80/tcp #æ·»åŠ ç«¯å£ï¼Œæ ¼å¼ä¸ºï¼šç«¯å£/é€šè®¯åè®®â€“permanent #æ°¸ä¹…ç”Ÿæ•ˆï¼Œæ²¡æœ‰æ­¤å‚æ•°é‡å¯åå¤±æ•ˆ é‡æ–°è½½å…¥: firewall-cmd --reload æŸ¥çœ‹æ˜¯å¦å¼€å¯: firewall-cmd --zone=public --query-port=80/tcp åˆ é™¤: firewall-cmd --zone= public --remove-port=80/tcp --permanent æœåŠ¡å™¨ç¯å¢ƒ(é’ˆå¯¹2m-noslave) åºå· | IP | ç”¨æˆ·å | å¯†ç  | è§’è‰² | æ¨¡å¼â€”|â€”|â€”|â€”|â€”|â€”|â€”|â€”1 | 192.168.100.24| root| | nameServer1,brokerServer1|Master12 | 192.168.100.25| root| | nameServer2,brokerServer2|Master2 Hostsæ·»åŠ ä¿¡æ¯ä¿®æ”¹hostï¼Œåšé›†ç¾¤çš„é€šè®¯(ä¸¤å°æœºå™¨éƒ½ä¿®æ”¹) 12vim /etc/hosts IP NAME 192.168.100.24 rocketmq-nameserver1 192.168.100.24 rocketmq-master1 192.168.100.25 rocketmq-nameserver2 192.168.100.25 rocketmq-master2 RocketMQæœ€ç®€å•éƒ¨ç½² â€“ å•namesrv å•broker 1.jdkå®‰è£… rocketmqå®‰è£… ä¸Šä¼ è§£å‹ä¸Šä¼ ä½¿ç”¨ rz szæ’ä»¶ï¼Œè¿›è¡Œä¸Šä¼ ä¸‹è½½ 12yum install -y lrzsz ä¸Šä¼ å‘½ä»¤ä¸ºrzï¼Œä¸‹è½½å‘½ä»¤ä¸ºsz è§£å‹å®‰è£…123456tar -zxvf alibaba-rocketmq-3.2.6.tar.gz -C /usr/local //è§£å‹åˆ°æŒ‡å®šç›®å½•ä¸‹mv alibaba-rocketmq alibaba-rocketmq-3.2.6 //é‡å‘½åï¼Œå¸¦ç‰ˆæœ¬å·ln -s alibaba-rocketmq-3.2.6 rocketmq //åˆ›å»ºè½¯é“¾æ¥ã€å¦‚æœä¸åŠ  -s å°±æ˜¯åˆ›å»ºç¡¬é“¾æ¥ åˆ›å»ºå­˜å‚¨è·¯å¾„12345678mkdir /usr/local/rocketmq/storemkdir /usr/local/rocketmq/store/commitlogmkdir /usr/local/rocketmq/store/consumequeuemkdir /usr/local/rocketmq/store/index ä¿®æ”¹RocketMQé…ç½®æ–‡ä»¶1234vim /usr/local/rocketmq/conf/2m-noslave/broker-a.propertiesvim /usr/local/rocketmq/conf/2m-noslave/broker-b.properties ä½œä¸ºbrokerå¯åŠ¨æ—¶çš„å‚æ•°é…ç½®æ–‡ä»¶ å‚è€ƒé…ç½®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293#æ‰€å±é›†ç¾¤åå­—brokerClusterName=rocketmq-cluster#brokeråå­—ï¼Œæ³¨æ„æ­¤å¤„ä¸åŒçš„é…ç½®æ–‡ä»¶å¡«å†™çš„ä¸ä¸€æ ·brokerName=broker-a|broker-b#0 è¡¨ç¤º Masterï¼Œ&gt;0 è¡¨ç¤º SlavebrokerId=0#nameServeråœ°å€ï¼Œåˆ†å·åˆ†å‰²namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876#åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨åˆ›å»ºæœåŠ¡å™¨ä¸å­˜åœ¨çš„topicï¼Œé»˜è®¤åˆ›å»ºçš„é˜Ÿåˆ—æ•°defaultTopicQueueNums=4#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºTopicï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­autoCreateTopicEnable=true#æ˜¯å¦å…è®¸ Broker è‡ªåŠ¨åˆ›å»ºè®¢é˜…ç»„ï¼Œå»ºè®®çº¿ä¸‹å¼€å¯ï¼Œçº¿ä¸Šå…³é—­autoCreateSubscriptionGroup=true#Broker å¯¹å¤–æœåŠ¡çš„ç›‘å¬ç«¯å£listenPort=10911#åˆ é™¤æ–‡ä»¶æ—¶é—´ç‚¹ï¼Œé»˜è®¤å‡Œæ™¨ 4ç‚¹deleteWhen=04#æ–‡ä»¶ä¿ç•™æ—¶é—´ï¼Œé»˜è®¤ 48 å°æ—¶fileReservedTime=120#commitLogæ¯ä¸ªæ–‡ä»¶çš„å¤§å°é»˜è®¤1GmapedFileSizeCommitLog=1073741824#ConsumeQueueæ¯ä¸ªæ–‡ä»¶é»˜è®¤å­˜30Wæ¡ï¼Œæ ¹æ®ä¸šåŠ¡æƒ…å†µè°ƒæ•´mapedFileSizeConsumeQueue=300000#destroyMapedFileIntervalForcibly=120000#redeleteHangedFileInterval=120000#æ£€æµ‹ç‰©ç†æ–‡ä»¶ç£ç›˜ç©ºé—´diskMaxUsedSpaceRatio=88#å­˜å‚¨è·¯å¾„storePathRootDir=/usr/local/rocketmq/store#commitLog å­˜å‚¨è·¯å¾„storePathCommitLog=/usr/local/rocketmq/store/commitlog#æ¶ˆè´¹é˜Ÿåˆ—å­˜å‚¨è·¯å¾„å­˜å‚¨è·¯å¾„storePathConsumeQueue=/usr/local/rocketmq/store/consumequeue#æ¶ˆæ¯ç´¢å¼•å­˜å‚¨è·¯å¾„storePathIndex=/usr/local/rocketmq/store/index#checkpoint æ–‡ä»¶å­˜å‚¨è·¯å¾„storeCheckpoint=/usr/local/rocketmq/store/checkpoint#abort æ–‡ä»¶å­˜å‚¨è·¯å¾„abortFile=/usr/local/rocketmq/store/abort#é™åˆ¶çš„æ¶ˆæ¯å¤§å°maxMessageSize=65536#flushCommitLogLeastPages=4flushConsumeQueueLeastPages=2#flushCommitLogThoroughInterval=10000#flushConsumeQueueThoroughInterval=60000#Broker çš„è§’è‰²#- ASYNC_MASTER å¼‚æ­¥å¤åˆ¶Master#- SYNC_MASTER åŒæ­¥åŒå†™Master#- SLAVEbrokerRole=ASYNC_MASTER#åˆ·ç›˜æ–¹å¼#- ASYNC_FLUSH å¼‚æ­¥åˆ·ç›˜#- SYNC_FLUSH åŒæ­¥åˆ·ç›˜flushDiskType=ASYNC_FLUSH#checkTransactionMessageEnable=false#å‘æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡#sendMessageThreadPoolNums=128#æ‹‰æ¶ˆæ¯çº¿ç¨‹æ± æ•°é‡#pullMessageThreadPoolNums=128 ä¿®æ”¹æ—¥å¿—é…ç½®æ–‡ä»¶12 ä¿®æ”¹å¯åŠ¨è„šæœ¬å‚æ•°123 ä¸Šé¢ä¸¤æ­¥çœç•¥ï¼Œç›´æ¥ä¸Šä¼ åˆ°linuxè§£å‹ç­‰å³å¯ å¯åŠ¨æœåŠ¡namesrv 1.åˆ°binç›®å½•ä¸‹åŠ å…¥æ‰§è¡Œæƒé™ chmod +x * 2.ä¿®æ”¹å¯åŠ¨çš„å †å†…å­˜åˆå§‹å¤§å°1`vim runserver.sh` //æ›´æ”¹å†…å­˜è®¾ç½® 3.å¯åŠ¨1./mqnamesrv 4.åå°è¿è¡Œè¿›ç¨‹:12nohup ./mqnamesrv &amp; 5.jpsæŸ¥çœ‹è¿›ç¨‹æŸ¥çœ‹æ˜¯å¦æˆåŠŸ: tail -f nohup.out å¯åŠ¨æœåŠ¡brokerï¼ˆmasterï¼‰1.ä¿®æ”¹å¯åŠ¨çš„å †å†…å­˜åˆå§‹å¤§å°123vim runbroker.sh //æ›´æ”¹å†…å­˜è®¾ç½® 2. å¯åŠ¨12nohup sh mqbroker -n &quot;192.168.1.107:9876&quot; &amp; 3.æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–¹å¼å¯åŠ¨123456nohup sh mqbroker -n &quot;192.168.1.107:9876&quot; -c ../conf/2m-noslave/broker-a.properties &gt; broker.out &amp; nohup sh mqbroker -n &quot;127.0.0.1:9876&quot; -c ../conf/2m-noslave/broker-a.properties &gt; broker.out &amp;nohup sh mqbroker -c /usr/local/rocketmq/conf/2m-noslave/broker-a.properties &gt;/dev/null 2&gt;&amp;1 &amp; 4.ä½¿ç”¨./mqadminæ¥è§‚å¯Ÿnamesrvå’Œbrokerçš„æƒ…å†µ1./mqadmin clusterList -n 192.168.1.107:9876 //ipä¸ºnamesrvåœ°å€ æŸ¥çœ‹æ˜¯å¦æˆåŠŸå¯åŠ¨12345netstat -ntlp# jps# tail -f -n 500 /usr/local/rocketmq/logs/rocketmqlogs/broker.log# tail -f -n 500 /usr/local/rocketmq/logs/rocketmqlogs/namesrv.log åœæ­¢Rocketmq123456cd /usr/local/rocketmq/binsh mqshutdown brokersh mqshutdown namesrv æ•°æ®æ¸…ç†(åœæ­¢åè¿›è¡Œæ•°æ®æ¸…ç†)12345678910--ç­‰å¾…åœæ­¢# rm -rf /usr/local/rocketmq/store# mkdir /usr/local/rocketmq/store# mkdir /usr/local/rocketmq/store/commitlog# mkdir /usr/local/rocketmq/store/consumequeue# mkdir /usr/local/rocketmq/store/index--æŒ‰ç…§ä¸Šé¢æ­¥éª¤é‡å¯NameServerä¸BrokerServer 5.RocketMQéœ€è¦æ‰“å¼€çš„é˜²ç«è¯·ç«¯å£å· 9876,10911,10912","link":"/p/86274e11.html"},{"title":"Scalaå®æˆ˜ -- å¯¹Listä¸­çš„éƒ¨åˆ†å…ƒç´ è¿›è¡Œåˆå¹¶æ“ä½œ","text":"è¿‘æœŸä¸šåŠ¡å‡ºç°äº†ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦å¯¹ä¸€ä¸ªç›¸åŒå®ä½“çš„Listä¸­ï¼Œéƒ¨åˆ†å®ä½“åå’Œidç›¸åŒçš„å…ƒç´ è¿›è¡Œåˆå¹¶ï¼Œå°†å…¶åˆå¹¶ä¸ºä¸€ä¸ªå®ä½“ï¼Œä»¥ä¾¿åœ¨ä¸šåŠ¡ä¸Šåšç»Ÿè®¡å¤„ç†ï¼Œåˆå¹¶åçš„å®ä½“ä¸ºåˆå¹¶å‰çš„å®ä½“çš„æŸäº›æ•°å€¼ç›¸åŠ ã€‚æ­¤éœ€æ±‚å‚¬ç”Ÿäº†æœ¬ç¯‡æ–‡ç« ã€‚æˆ‘ä»¬å°†æŠ½è±¡ä¸€ä¸ªç®€å•çš„å®ä½“æ¥ä»‹ç»ï¼Œå¦‚ä½•åœ¨Scala List ä¸­åˆå¹¶éƒ¨åˆ†Element å…ƒç´ ã€‚ å®šä¹‰ä¸šåŠ¡å®ä½“å¯¹è±¡ MergeInfo å®šä¹‰ä¸€ä¸ªåŒ…å« name å’Œæ”¶å…¥æ•°æ®çš„å®ä½“å¯¹è±¡ï¼Œå½“åˆ¤æ–­ä¸¤ä¸ªå®ä½“çš„ name ç›¸åŒæ—¶ï¼Œæˆ‘ä»¬å†³å®šå¯¹å…¶è¿›è¡Œåˆå¹¶æ“ä½œï¼Œå°†ä¸¤ä¸ªå®ä½“çš„ fee è¿›è¡Œç´¯è®¡ï¼Œå®Œæˆåˆå¹¶ã€‚å…¶ä¸­ diff æ–¹æ³•å®šä¹‰äº†å½“ä¼ å…¥çš„ target å¯¹è±¡ name ä¸æºå¯¹è±¡çš„ name ç›¸åŒæ—¶ï¼Œè¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚è€Œ merge æ“ä½œåˆ™æ˜¯å½“ä¸Šä¸€æ­¥ diff è¿”å› true æ—¶ï¼Œæˆ‘ä»¬ä¼šé‡‡å–çš„åˆå¹¶æ“ä½œçš„å…·ä½“é€»è¾‘ã€‚ 12345678910111213case class MergeInfo(name: String, fee: Double) { //è¦æ¯”è¾ƒçš„ç›®æ ‡å¯¹è±¡,æ ¹æ®ä»€ä¹ˆæ¡ä»¶ç¡®å®šæ˜¯å¦éœ€è¦merge def diff(target: MergeInfo): Boolean = { name == target.name } //å®šä¹‰åˆå¹¶æ“ä½œ def merge(target: MergeInfo): MergeInfo = { MergeInfo(name, fee + target.fee) }} ä½¿ç”¨å°¾é€’å½’éå† List å¹¶è¿›è¡Œåˆå¹¶ å®ä½“é€»è¾‘å®šä¹‰å®Œæˆå,æˆ‘ä»¬é€šè¿‡ä½¿ç”¨å°¾é€’å½’çš„æ¨¡å¼æ¥éå†ç»™å®šçš„ Listï¼Œå¹¶ä½¿ç”¨ matching pattern æ¨¡å¼æ¥è¿›è¡Œåˆå¹¶å‰çš„åˆ¤æ–­å’Œåˆå¹¶æ“ä½œï¼Œä½¿ç”¨è¿­ä»£å™¨å’Œç´¯åŠ å™¨å°†éå†å˜ä¸ºå°¾é€’å½’çš„å½¢å¼ï¼Œä¼˜åŒ–éå†çš„æ€§èƒ½ã€‚ ä½¿ç”¨å°¾é€’å½’æ¨¡å¼éå† List,ä¼˜åŒ–æ€§èƒ½ã€‚ ä½¿ç”¨ matching pattern æ¥åˆ¤æ–­å’Œåˆå¹¶å…ƒç´ ã€‚ ä½¿ç”¨ éšå¼è½¬æ¢ ç‰¹æ€§ï¼Œä½¿ä½¿ç”¨æ­¤æ“ä½œå˜å¾—æ›´ä¸ºç®€å•å’Œä¼˜é›…ã€‚ 1234567891011121314151617181920object Utils { /** * Merging elements in a Scala List */ implicit class ElementMergeOfList(value: List[MergeInfo]) { def merge: List[MergeInfo] = { @tailrec def process(in: List[MergeInfo], accum: List[MergeInfo]): List[MergeInfo] = { in match { case x :: y :: ys if x.diff(y) =&gt; process(x.merge(y) :: ys, accum) case x :: xs =&gt; process(xs, x :: accum) case Nil =&gt; accum } } process(value, Nil).reverse } }} ç¨‹åºè§£é‡Šï¼š in è¾“å…¥çš„æºListï¼Œå¾…å¤„ç†å’Œåˆå¹¶ã€‚ accum ç´¯åŠ å™¨ï¼Œæ¯æ¬¡éå†å¤„ç†ä»¥æ­¤Listä¸­çš„å…ƒç´ ï¼Œå¹¶å°†å¤„ç†åçš„å…ƒç´ æ”¾å…¥ accu ç´¯åŠ å™¨ä¸­ x :: y :: ys è¿™æ˜¯Scalaè¯­æ³•ä¸­å¯¹ Listç»„æˆçš„ä¸€ç§æè¿°ï¼Œ xï¼Œy å‡ä¸ºå•ä¸ªå…ƒç´ ï¼Œys å±äºå°¾éƒ¨ï¼Œä¸ºå‰©ä½™çš„ Listå…ƒç´ ã€‚ æµ‹è¯•ç¨‹åº1234567891011121314151617181920212223/*** å°†ä¸Šè¿°éšå¼è½¬æ¢ç±»å¼•å…¥è¿›æ¥*/object MergeElementSpec { def main(args: Array[String]): Unit = { test1() } def test1(): Unit = { val mergeInfoList = List(MergeInfo(&quot;annual&quot;, 12.5), MergeInfo(&quot;Balance&quot;, 14.3), MergeInfo(&quot;Balance&quot;, 15.7), MergeInfo(&quot;Call&quot;, 21.2), MergeInfo(&quot;Call&quot;, 0.3), MergeInfo(&quot;Date&quot;, 45.4), MergeInfo(&quot;Element&quot;, 24) ) val mergedResult: List[MergeInfo] = mergeInfoList.merge println(s&quot;merge å‰å…ƒç´  size: ${mergeInfoList.size}, merge åå…ƒç´  size: ${mergedResult.size}&quot;) println(s&quot;merge åå…ƒç´ è¯¦æƒ…: $mergedResult&quot;) }} è¿è¡Œæµ‹è¯•ç±»ï¼Œç»“æœå¦‚ä¸‹ï¼š 1234merge å‰å…ƒç´  size: 7, merge åå…ƒç´  size: 5merge åå…ƒç´ è¯¦æƒ…ï¼šList(MergeInfo(annial,12.5),MergeInfo(Balance,30.0),MergeInfo(Call,12.5),MergeInfo(Date,45.4),MergeInfo(Element,24.0))","link":"/p/a8949b93.html"},{"title":"ä»ç¤ºä¾‹é€æ¸ç†è§£Scalaå°¾é€’å½’","text":"1.é€’å½’ä¸å°¾é€’å½’1.1 é€’å½’1.1.1 é€’å½’å®šä¹‰ é€’å½’å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œä¸€ä¸ªå‡½æ•°ç›´æ¥æˆ–é—´æ¥çš„è°ƒç”¨å®ƒè‡ªå·±æœ¬èº«ï¼Œå°±æ˜¯é€’å½’ã€‚å®ƒé€šå¸¸æŠŠä¸€ä¸ªå¤§å‹å¤æ‚çš„é—®é¢˜å±‚å±‚è½¬åŒ–ä¸ºä¸€ä¸ªä¸åŸé—®é¢˜ç›¸ä¼¼çš„è§„æ¨¡è¾ƒå°çš„é—®é¢˜æ¥æ±‚è§£ï¼Œé€’å½’ç­–ç•¥åªéœ€å°‘é‡çš„ä»£ç å°±å¯ä»¥æ‰§è¡Œå¤šæ¬¡é‡å¤çš„è®¡ç®—ã€‚ 1.1.2 é€’å½’çš„æ¡ä»¶ä¸€èˆ¬æ¥è¯´ï¼Œé€’å½’éœ€è¦æœ‰è¾¹ç•Œæ¡ä»¶ã€é€’å½’å‰è¿›æ®µå’Œé€’å½’è¿”å›æ®µã€‚å½“è¾¹ç•Œæ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œé€’å½’å‰è¿›ï¼›å½“è¾¹ç•Œæ¡ä»¶æ»¡è¶³æ—¶ï¼Œé€’å½’è¿”å›ã€‚ ä»¥é€’å½’æ–¹å¼å®ç°é˜¶ä¹˜å‡½æ•°çš„å®ç°ï¼š ä»£ç æ¸…å•1-1 1234def factorial(n:Int): Long ={ if(n &lt;= 0) 1 else n * factorial(n-1)} ä»£ç æ¸…å•ä¸­ï¼Œif(n &lt;= 0) 1æ˜¯é€’å½’è¿”å›æ®µï¼Œelseåé¢éƒ¨åˆ†æ˜¯é€’å½’å‰è¿›æ®µã€‚ 1.1.3 é€’å½’çš„ç¼ºç‚¹ï¼š éœ€è¦ä¿æŒè°ƒç”¨å †æ ˆ,å¦‚ä»£ç æ¸…å•1-1,æ¯ä¸€æ¬¡é€’å½’éƒ½è¦ä¿å­˜n*factorial(n-1)æ ˆå¸§ä¿¡æ¯ã€‚å¦‚æœè°ƒç”¨æ¬¡æ•°å¤ªå¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ˆæº¢å‡º æ•ˆç‡ä¼šæ¯”è¾ƒä½ï¼Œé€’å½’å°±æ˜¯ä¸æ–­çš„è°ƒç”¨è‡ªå·±æœ¬èº«ï¼Œå¦‚æœæ–¹æ³•æœ¬èº«æ¯”è¾ƒå¤æ‚ï¼Œæ¯æ¬¡è°ƒç”¨è‡ªå·±æ•ˆç‡ä¼šè¾ƒä½ã€‚ 1.2 å°¾é€’å½’1.2.1 å®šä¹‰å°¾é€’å½’çš„å®šä¹‰æ¯”è¾ƒç®€å•ï¼Œå³å‡½æ•°åœ¨å‡½æ•°ä½“æœ€åè°ƒç”¨å®ƒæœ¬èº«ï¼Œå°±è¢«ç§°ä¸ºå°¾é€’å½’ã€‚ æˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£å°¾é€’å½’ æ‰€æœ‰é€’å½’å½¢å¼çš„è°ƒç”¨éƒ½å‡ºç°åœ¨å‡½æ•°çš„æœ«å°¾ é€’å½’è°ƒç”¨æ˜¯æ•´ä¸ªå‡½æ•°ä½“ä¸­æœ€åæ‰§è¡Œçš„è¯­å¥ä¸”å®ƒçš„è¿”å›å€¼ä¸å±äºè¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ† 1.2.2 ä¾‹å­ç¨‹åºä¸‹é¢æˆ‘ä»¬ä½¿ç”¨å°¾é€’å½’çš„æ¨¡å¼å®ç°ä¸Šé¢çš„é˜¶ä¹˜ä»£ç æ¸…å•1-2 123456789def factorial(n:Int):Long = { @tailrec def factorial(main:Int,aggr:Int): Long ={ if(main &lt;= 0) aggr else factorial(main-1,main*aggr) } factorial(n,1)} æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒä»£ç æ¸…å•1-1å’Œ1-21-1ä¸­ï¼Œæ¯æ¬¡çš„é€’å½’è°ƒç”¨éƒ½è¦æœ¬èº«æ—¶ä¾èµ–nè¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥ï¼Œå®ƒåªèƒ½æ˜¯ä¸ªä¸åŒçš„é€’å½’ã€‚ 1-2ä¸­ï¼Œå‡½æ•°factorialæ¯æ¬¡è¿”å›çš„éƒ½æ˜¯å®ƒè‡ªå·±æœ¬èº«ï¼Œæ²¡æœ‰ä¾èµ–ä»»ä½•å€¼ã€‚å®ƒåšçš„æ˜¯å°†mainæ¯æ¬¡å‡1ï¼Œå°†aggræ¯æ¬¡ä¹˜mainï¼Œç„¶åå°†è¿™ä¸¤ä¸ªç»“æœä½œä¸ºä¸‹ä¸€æ¬¡é€’å½’è°ƒç”¨çš„å‚æ•°ï¼Œè¿›è¡Œè°ƒç”¨ã€‚ å°¾é€’å½’çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å‚æ•°æ¥ä¼ é€’æ¯ä¸€æ¬¡çš„è°ƒç”¨ç»“æœï¼Œè¾¾åˆ°ä¸å‹æ ˆã€‚å®ƒç»´æŠ¤ç€ä¸€ä¸ªè¿­ä»£å™¨å’Œä¸€ä¸ªç´¯åŠ å™¨ã€‚ 1.3 å¾ªç¯å¾ªç¯èƒ½å¤Ÿè§£å†³å¤§å¤šæ•°çš„ç´¯è®¡é—®é¢˜ï¼Œå¾ªç¯å¯ä»¥å®Œæˆç´¯åŠ å’Œè¿­ä»£ï¼Œå¤„ç†é—®é¢˜æ¯”è¾ƒç®€å•ï¼Œæ€æƒ³ä¹Ÿæ¯”è¾ƒç¬¦åˆï¼Œå®¹æ˜“ç†è§£ nçš„é˜¶ä¹˜å¾ªç¯çš„å†™æ³• ä»£ç æ¸…å•1-3 1234567def fibfor(n:Int): Int ={ var m = 1 for (i &lt;- 1 to n) { m = m * i } m} å¾ªç¯ç‰ˆæœ¬ï¼Œä¼šæœ‰varçš„å¯å˜å˜é‡ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå‡½æ•°å¼ç¼–ç¨‹å°±åº”è¯¥æ›´å‡½æ•°èŒƒï¼Œæˆ‘ä»¬å°½å¯èƒ½çš„è¦ç”¨valså»æ›¿æ¢å¯å˜çš„varsæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€’å½’çš„æ–¹å¼æ¥æ¶ˆé™¤æ‰vars 2.æ”¹å†™ (å¾ªç¯ï¼Œé€’å½’ TO å°¾é€’å½’) äº‹å®ä¸Šï¼Œscalaéƒ½æ˜¯å°†å°¾é€’å½’ç›´æ¥ç¼–è¯‘æˆå¾ªç¯æ¨¡å¼çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¤§èƒ†çš„è¯´ï¼Œæ‰€æœ‰çš„å¾ªç¯æ¨¡å¼éƒ½èƒ½æ”¹å†™ä¸ºå°¾é€’å½’çš„å†™æ³•æ¨¡å¼ å°¾é€’å½’ä¼šç»´æŠ¤ä¸€ä¸ªæˆ–å¤šä¸ªç´¯è®¡å€¼(aggregate)å‚æ•°å’Œä¸€ä¸ªè¿­ä»£å‚æ•°ã€‚æˆ‘ä»¬å…·ä½“åˆ†æ 2.1è¿­ä»£å™¨å’Œç´¯è®¡å™¨ ç´¯è®¡å€¼å‚æ•°aggregateå°†æ¯æ¬¡å¾ªç¯äº§ç”Ÿçš„ç»“æœè¿›è¡Œç´¯è®¡ï¼Œç„¶åä¼ åˆ°ä¸‹ä¸€æ¬¡çš„è°ƒç”¨ä¸­ã€‚ è¿­ä»£å™¨ï¼Œå’Œæ™®é€šé€’å½’æˆ–å¾ªç¯ä¸€æ ·ï¼Œæ¯æ¬¡é€’å½’æˆ–å¾ªç¯åï¼Œæ”¹å˜ä¸€æ¬¡ã€‚(å¦‚for(i=0;i&lt;1-;i++)é‡Œé¢çš„i) 2.2 æ™®é€šé€’å½’è½¬æ¢ä¸ºå°¾é€’å½’ å¹¶ä¸æ˜¯æ‰€æœ‰çš„é€’å½’éƒ½èƒ½æ”¹å†™ä¸ºå°¾é€’å½’ï¼Œé‚£äº›æ¯”è¾ƒå¤æ‚çš„é€’å½’è°ƒç”¨æ—¶æ— æ³•ä¼˜åŒ–ä¸ºå°¾é€’å½’çš„ã€‚ä½†æ˜¯å¤§éƒ¨åˆ†è¿˜æ˜¯èƒ½å¤Ÿè¿›è¡Œä¼˜åŒ–çš„ã€‚ ä»£ç æ¸…å•1-1 å’Œä»£ç æ¸…å• 1-2 æ˜¯æ±‚né˜¶é˜¶ä¹˜çš„æ™®é€šé€’å½’ä¸å°¾é€’å½’çš„å†™æ³•ï¼Œå‰è€…æ²¡æœ‰è¿›è¡Œä¼˜åŒ–ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šå‹æ ˆã€‚åè€…ï¼Œé€šè¿‡å®šä¹‰ä¸€ä¸ªaggregate(ç´¯è®¡)å‚æ•°ï¼Œå¯¹æ¯ä¸€æ¬¡è°ƒç”¨åçš„ç»“æœåšä¸€æ¬¡ç´¯è®¡,è€Œå¦ä¸€ä¸ªå‚æ•°mainç§°ä¸ºè¿­ä»£å™¨,æ¯ä¸€æ¬¡è°ƒç”¨éƒ½ä¼š-1ï¼Œå½“è¾¾åˆ°ç¬¦åˆè¿”å›çš„æ¡ä»¶æ—¶ï¼Œå°†ç´¯è®¡å€¼è¿”å›ã€‚ 2.3 å¾ªç¯ï¼ˆwhile loopï¼‰è½¬ä¸ºå°¾é€’å½’ï¼ˆtail recursionï¼‰ æ­£å¦‚ä¸Šæ–‡å¾ªç¯ä¾‹å­æ‰€è¿°ï¼Œå­˜åœ¨var,å‡½æ•°å¼ç¼–ç¨‹å°±åº”è¯¥æœ‰å‡½æ•°èŒƒï¼Œæˆ‘ä»¬å°½é‡ä½¿ç”¨valæ¥ä»£æ›¿ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æ¥çœ‹ï¼Œæ€ä¹ˆå°†å¾ªç¯è½¬æ¢ä¸ºå°¾é€’å½’ 2.3.1 å¾ªç¯å’Œå°¾é€’å½’ æ­£å¦‚ä¸Šæ–‡æ‰€è¯´çš„è¿­ä»£å™¨å’Œç´¯è®¡å™¨ï¼Œå¾ªç¯å’Œå°¾é€’å½’éƒ½æœ‰è¿™ä¸¤ä¸ªæ¦‚å¿µ è¿­ä»£å™¨å’Œç´¯è®¡å™¨ å°¾é€’å½’æ¯ä¸€æ¬¡çš„è°ƒç”¨è‡ªèº«éƒ½ä¼šæœ‰ä¸€æ¬¡ç´¯åŠ ï¼ˆæˆ–è€…ç´¯ç§¯ï¼Œç´¯å‡ç­‰ï¼‰ï¼Œç„¶åä¼šæœ‰ä¸€ä¸ªè¿­ä»£å™¨è¿›è¡Œè¿­ä»£ï¼Œä¸€ä¸ªç´¯åŠ å™¨è¿›è¡Œç´¯åŠ è¿­ä»£çš„ç»“æœï¼Œç„¶åä½œä¸ºå‚æ•°ï¼Œå†å»è°ƒç”¨è‡ªèº«ã€‚ 2.3.2 å¦‚ä¸Šé¢æ±‚né˜¶ä¹˜çš„å°¾é€’å½’ä¾‹å­ï¼š 1.å¾ªç¯çš„ä¾‹å­ä¸­å­˜åœ¨ä¸€ä¸ªvarï¼Œå®ƒåœ¨æ¯æ¬¡å¾ªç¯ä¸­å……å½“ä¸€ä¸ªç´¯åŠ å™¨çš„è§’è‰²ï¼Œç´¯åŠ æ¯ä¸€æ¬¡çš„è¿­ä»£ç»“æœï¼Œè€Œæ¯æ¬¡è¿­ä»£è¿‡ç¨‹å°±æ˜¯m*içš„ä¸€ä¸ªè¿‡ç¨‹ã€‚ 2.å°¾é€’å½’ä¹Ÿæ˜¯ä¸€æ ·çš„æ€æƒ³ï¼Œä»¥mainä½œä¸ºè¿­ä»£å™¨ï¼Œæ¯æ¬¡é€’å‡1ï¼Œç±»ä¼¼å¾ªç¯é‡Œçš„iï¼Œä»¥aggrä½œä¸ºç´¯åŠ å™¨ï¼Œæ¯æ¬¡ç´¯è®¡è¿­ä»£çš„ç»“æœï¼Œç±»ä¼¼å¾ªç¯çš„mã€‚ 3.ç›¸å¯¹äºæ™®é€šçš„é€’å½’ï¼Œè¿™é‡Œå°¾é€’å½’å¤šçš„ä¸€ä¸ªå‚æ•°å°±æ˜¯ç´¯åŠ å™¨aggrï¼Œç”¨äºç´¯è®¡æ¯ä¸€æ¬¡é€’å½’è¿­ä»£çš„ç»“æœã€‚è¿™æ ·åšçš„ç›®çš„å°±æ˜¯æ¯ä¸€æ¬¡è°ƒç”¨çš„ç»“æœå¯ä»¥ä½œä¸ºä¸‹ä¸€æ¬¡å‡½æ•°è°ƒç”¨çš„å‚æ•°ã€‚ 3.å…·ä½“ç¤ºä¾‹-åŠ æ·±ç†è§£3.1 ä¾‹å­1 - æ±‚æ–æ³¢æ‹‰å¥‘æ•°åˆ— æ™®é€šé€’å½’å†™æ³•ï¼ˆæ€§èƒ½è¾ƒä½ï¼‰ 123456def fibonacci(n:Int): Long ={ n match { case 1 | 2 =&gt; 1 case _ =&gt; fibonacci(n-1) + fibonacci(n-2) }} å¾ªç¯çš„å†™æ³•ï¼ˆå¾ªç¯å†™æ³•ï¼‰ 1234567891011121314def fibonacciFor(n:Int): Int = { var current = 1 var next = 1 if(n &lt;=2) 1 else { for(i &lt;- 2 until n) { var aggr = current + next current = next next = aggr } next }} å¯ä»¥çœ‹åˆ°ï¼Œaggræ˜¯ç´¯åŠ å™¨ï¼Œç„¶åå°†ç´¯åŠ çš„å€¼èµ‹å€¼ç»™ä¸‹ä¸€ä¸ªnextï¼Œè€Œcurrentç­‰äºnextï¼Œæ¯ä¸€æ¬¡å¾ªç¯ï¼Œéƒ½æœ‰ç»™currentå’Œnextèµ‹äºˆæ–°å€¼,å½“ç´¯åŠ å®Œæˆåï¼Œè¿”å›nextçš„å€¼ã€‚ å°¾é€’å½’å†™æ³• å¦‚ä½•å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Ÿä»”ç»†åˆ†æ,ä¸Šé¢çš„æ™®é€šå¾ªç¯ï¼Œæ¯ä¸€è½®ä¸¤ä¸ªå€¼éƒ½åœ¨æ”¹å˜ï¼Œç„¶ååˆä¸€ä¸ªç´¯åŠ å™¨aggrï¼Œå¯¹è¿™ä¸¤ä¸ªå€¼è¿›è¡Œç´¯åŠ ï¼Œå¹¶èµ‹å€¼ç»™æ›´å¤§çš„nextï¼Œç„¶åè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚ å°¾é€’å½’ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯åŒæ ·çš„åšæ³•ï¼Œå®šä¹‰ä¸¤ä¸ªæ¥å—å€¼ï¼Œå½“å‰çš„ï¼Œå’Œä¸‹ä¸€ä¸ªï¼Œç„¶åéœ€è¦ä¸€ä¸ªç´¯åŠ å€¼ã€‚ è¿™é‡Œæ™®é€šæ–¹æ³•çš„é€’å½’è°ƒç”¨æ˜¯ä¸¤ä¸ªåŸå‡½æ•°ç›¸åŠ ï¼Œæ¶‰åŠåˆ°çš„å˜é‡æœ‰ n , n-1 , n-2å› æ­¤,æˆ‘ä»¬åœ¨è€ƒè™‘ä½¿ç”¨å°¾é€’å½’æ—¶ï¼Œå¯èƒ½ä¹Ÿéœ€è¦ä½¿ç”¨åˆ°ä¸‰ä¸ªå‚æ•°ï¼Œåˆç•¥æ¶‰åŠï¼Œå°¾é€’å½’å‡½æ•°éœ€è¦ä½¿ç”¨ä¸‰ä¸ªå‚æ•°ï¼Œäºæ˜¯æ”¹å†™å¦‚ä¸‹ï¼š 12345678910111213def fibonacci(n: Int): Long = { @tailrec def fibonacciTail(main: Int, current: Int, next: Int): Long = { main match { case 1 | 2 =&gt; next case _ =&gt; fibonacciByTail(main - 1, next, current+next) } fibonacciTail(n, 1, 1) } fibonacciTail(n,1,1)} ä½¿ç”¨å°¾é€’å½’å’Œæ¨¡å¼åŒ¹é…ã€‚æ¯ä¸€æ¬¡è°ƒç”¨è‡ªèº«ï¼Œå°†nextèµ‹å€¼ç»™currentï¼Œç„¶åç´¯åŠ currentå’Œnextçš„å€¼èµ‹å€¼ç»™æ–°çš„nextå€¼ï¼Œcallä¸‹ä¸€è½®ã€‚æ€æƒ³ä¸Šå’Œä¸Šé¢å¾ªç¯å¾ˆåƒã€‚ä½†æ˜¯æ›´å‡½æ•°èŒƒï¼Œæ¶ˆé™¤æ‰äº†varã€‚ 3.2 ä¾‹å­2 - loadBalanceç®—æ³• éœ€æ±‚ï¼Œè®¾è®¡ä¸€ä¸ªç¨‹åºï¼Œä¼ å…¥ä¸€ä¸ªæ¯”ä¾‹æ•°ç»„ï¼Œæ¯”å¦‚Arrayï¼ˆ1,3,6,ä¸€ç›´è°ƒç”¨è¯¥å‡½æ•°ï¼Œè¿”å›çš„3ä¸ªèŠ‚ç‚¹çš„æ¯”ä¾‹ä¹Ÿåº”è¯¥å¦‚ä¼ å…¥çš„1:3:6çš„æ¯”ä¾‹ä¸€æ ·ã€‚ æˆ‘æœ€å¼€å§‹ä½¿ç”¨forå¾ªç¯å’Œreturnå®ç°äº†è¿™ä¸ªéœ€æ±‚ï¼Œä»£ç å¦‚ä¸‹ï¼š123456789101112131415161718def loadBalance(arr:Array[Int]): Int ={ //æ ¹æ®ä¼ å…¥çš„æ•°ç»„ä½¿ç”¨scané«˜çº§å‡½æ•°è¿›è¡Œå˜åŒ–ï¼Œå…·ä½“ç®—æ³•ä¾‹å­ï¼š //eg ï¼ˆ1ï¼Œ3ï¼Œ6ï¼‰ -&gt; (1,4,10) //è¿™æ ·çš„ç›®çš„æ˜¯ï¼Œéšæœºå‡ºæ¥çš„å€¼ä¸º0-1æ—¶ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸º1-4æ—¶é€‰æ‹©ç¬¬äºŒèŠ‚ç‚¹ï¼Œä¾æ¬¡ç±»æ¨ val segment:Array[Int] = arr.scan(0)(_ + _).drop(1) //éšæœºæ•°çš„èŒƒå›´ï¼Œæ ¹æ®ä¼ å…¥çš„æ•°ç»„çš„æ•°æ®ä¹‹å’Œæ¥ï¼Œä¾‹å¦‚ä¸Šçš„ä¾¿æ˜¯ 10 ï¼Œäº§ç”Ÿçš„éšæœºæ•°ä»‹äº0 - 9 ä¹‹é—´ val weightSum:Int = arr.sum val random = new Random().nextInt(weightSum) for(i &lt;- 0 until segment.size ){ if(random &lt; segment(i)){ return i } } 0} æˆ‘é€šè¿‡æµ‹è¯•ç¨‹åºè°ƒç”¨1ä¸‡æ¬¡è¯¥æ–¹æ³•ï¼Œè¿”å›çš„éšæœºèŠ‚ç‚¹çš„æ¯”ä¾‹æ˜¯ç¬¦åˆä¼ å…¥çš„æ¯”ä¾‹çš„ã€‚ æ€è€ƒï¼šè™½ç„¶è¿™æ ·å¯ä»¥è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯ä»£ç å†™çš„æ—¢ä¸ä¼˜é›…ï¼Œåœ¨scalaå‡½æ•°å¼ç¼–ç¨‹ä¸­æœ€å¥½æ˜¯ä¸èƒ½ä½¿ç”¨returnæ¥å¼ºè¡Œæ‰“æ–­å‡½æ•°æ‰§è¡Œçš„ï¼Œå¹¶ä¸”åœ¨æœ€åï¼Œæˆ‘è¿˜éœ€è¦å»å†™ä¸€ä¸ª0æ¥ä½œä¸ºé»˜è®¤è¿”å›ã€‚ å°¾é€’å½’ä¼˜åŒ– å¤§éƒ¨åˆ†æˆ–è€…å‡ ä¹æ‰€æœ‰çš„forå¾ªç¯éƒ½èƒ½ä½¿ç”¨å°¾é€’å½’è¿›è¡Œä¼˜åŒ–ï¼Œé‚£ä¸Šé¢è¿™ä¸ªä»£ç å¦‚ä½•è¿›è¡Œä¼˜åŒ–å‘¢ï¼Ÿ æ€è·¯ï¼šä¸Šæ–‡çš„forå¾ªç¯ï¼Œæ¯æ¬¡å¢åŠ çš„æ˜¯segmentçš„ä¸‹æ ‡ï¼Œæ¯å¾ªç¯ä¸€æ¬¡ +1ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡å°¾é€’å½’æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‚æ•°æ¥å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œè€Œå¦ä¸€ä¸ªå‚æ•°åº”è¯¥å°±æ˜¯äº§ç”Ÿçš„éšæœºæ•°ã€‚okï¼Œæˆ‘ä»¬æ¥è¿›è¡Œå®ç° 123456789101112131415161718def loadBalance(arr:Array[Int]): Int ={ //æ ¹æ®ä¼ å…¥çš„æ•°ç»„ä½¿ç”¨scané«˜çº§å‡½æ•°è¿›è¡Œå˜åŒ–ï¼Œå…·ä½“ç®—æ³•ä¾‹å­ï¼š //eg ï¼ˆ1ï¼Œ3ï¼Œ6ï¼‰ -&gt; (1,4,10) //è¿™æ ·çš„ç›®çš„æ˜¯ï¼Œéšæœºå‡ºæ¥çš„å€¼ä¸º0-1æ—¶ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸º1-4æ—¶é€‰æ‹©ç¬¬äºŒèŠ‚ç‚¹ï¼Œä¾æ¬¡ç±»æ¨ val segment:Array[Int] = arr.scan(0)(_ + _).drop(1) //éšæœºæ•°çš„èŒƒå›´ï¼Œæ ¹æ®ä¼ å…¥çš„æ•°ç»„çš„æ•°æ®ä¹‹å’Œæ¥ï¼Œä¾‹å¦‚ä¸Šçš„ä¾¿æ˜¯ 10 ï¼Œäº§ç”Ÿçš„éšæœºæ•°ä»‹äº0 - 9 ä¹‹é—´ val weightSum:Int = arr.sum val random = new Random().nextInt(weightSum) //å†™ä¸€ä¸ªå†…éƒ¨æ–¹æ³• def loadUtil(rand:Int,index:Int) { //assertï¼Œä¿è¯ç¨‹åºå¥å£® assert(index &lt; arr.length &amp;&amp; arr(index) &gt;= 0) if(rand &lt; segment(index)) index else loadUtil(rand,index+1) } loadUtil(random,0)} æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨å°¾é€’å½’çš„åšæ³•ï¼Œä»£ç ä¼šéå¸¸çš„ä¼˜é›…ï¼Œç°åœ¨å†™ä¸€ä¸ªæµ‹è¯•ç±»è¿›è¡Œæµ‹è¯•ï¼ 123456789101112131415161718192021222324def main(args: Array[String]): Unit = { val arr = Array(1,2,7) val countMap = collection.mutable.Map[Int,Int]() for(_ &lt;- 1 until 100000) { val res = loadBalance(arr) countMap.get(res) match { case Some(x) =&gt; countMap += (res -&gt; (x+1)) case None =&gt; countMap +=(res -&gt; 1) } } countMap.foreach(x =&gt; { println(s&quot;${x._1} è°ƒç”¨æ¬¡æ•° ${x._2}&quot;) }) }//æµ‹è¯•10000æ¬¡ï¼Œè¿”å›ç»“æœå¦‚ä¸‹ï¼š2 è°ƒç”¨æ¬¡æ•° 699661 è°ƒç”¨æ¬¡æ•° 200280 è°ƒç”¨æ¬¡æ•° 10005 å¦‚ä¸Šï¼Œæµ‹è¯•æ˜¯é€šè¿‡çš„ï¼æ˜¯ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œæ„Ÿå—åˆ°äº†å°¾é€’å½’çš„é­…åŠ›ï¼Ÿ 4. scalaç¼–è¯‘å™¨å¯¹å°¾é€’å½’çš„ä¼˜åŒ–Scala å¯¹å½¢å¼ä¸Šä¸¥æ ¼çš„å°¾é€’å½’è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¯¹äºä¸¥æ ¼çš„å°¾é€’å½’ï¼Œä¸éœ€è¦æ³¨è§£ @tailrec å¯ä»¥è®©ç¼–è¯‘å™¨å»æ£€æŸ¥è¯¥å‡½æ•°åˆ°åº•æ˜¯ä¸æ˜¯å°¾é€’å½’ï¼Œå¦‚æœä¸æ˜¯ä¼šæŠ¥é”™ å…·ä½“ä»¥ä¸Šé¢é‚£ä¸ªè®¡ç®—æ–æ³¢æ‹‰å¥‘æ•°åˆ—çš„ä¾‹å­è¿›è¡Œæ€§èƒ½åˆ†æ1234567891011121314151617181920def time[T](t: =&gt;T): T = { val b = System.nanoTime() val x = t val e = System.nanoTime(); println(&quot;time: &quot; + (e-b)/1000 + &quot;us&quot;); x }var count: Long = 0 // @tailrec def fib2(n: Long): Long = { count += 1 n match { case 1 | 2 =&gt; 1 case _ =&gt; fib2(n-1) + fib2(n-2) } } é€šè¿‡ä¸Šé¢æ—¶é—´å’Œè°ƒç”¨æ¬¡æ•°çš„æµ‹è¯•ï¼Œå¯ä»¥å¾—å‡ºå°¾é€’å½’çš„æ€§èƒ½æ¶ˆè€—å¾ˆä½ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚ 4.1 ç¼–è¯‘å™¨å¯¹å°¾é€’å½’çš„ä¼˜åŒ–å½“ç¼–è¯‘å™¨æ£€æµ‹åˆ°ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ˜¯å°¾é€’å½’çš„æ—¶å€™ï¼Œå®ƒå°±è¦†ç›–å½“å‰çš„æ´»åŠ¨è®°å½•è€Œä¸æ˜¯åœ¨æ ˆä¸­å»åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚ scalaç¼–è¯‘å™¨ä¼šå¯Ÿè§‰åˆ°å°¾é€’å½’ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œå°†å®ƒç¼–è¯‘æˆå¾ªç¯çš„æ¨¡å¼ã€‚ 4.2 Scalaå°¾é€’å½’çš„é™åˆ¶ å°¾é€’å½’æœ‰ä¸¥æ ¼çš„è¦æ±‚ï¼Œå°±æ˜¯æœ€åä¸€ä¸ªè¯­å¥æ˜¯é€’å½’è°ƒç”¨ï¼Œå› æ­¤å†™æ³•æ¯”è¾ƒä¸¥æ ¼ã€‚ å°¾é€’å½’æœ€åè°ƒç”¨çš„å¿…é¡»æ˜¯å®ƒæœ¬èº«ï¼Œé—´æ¥çš„èµ‹å€¼å®ƒæœ¬èº«çš„å‡½æ•°ä¹Ÿæ— æ³•è¿›è¡Œä¼˜åŒ–ã€‚ 5. æ€»ç»“å¾ªç¯è°ƒç”¨éƒ½æ˜¯ä¸€ä¸ªç´¯è®¡å™¨å’Œä¸€ä¸ªè¿­ä»£å™¨çš„ä½œç”¨ï¼ŒåŒç†ï¼Œå°¾é€’å½’ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå®ƒä¹Ÿæ˜¯é€šè¿‡ç´¯åŠ å’Œè¿­ä»£å°†ç»“æœèµ‹å€¼ç»™æ–°ä¸€è½®çš„è°ƒç”¨ï¼Œé€šè¿‡è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„å°†å¾ªç¯è½¬æ¢ä¸ºå°¾é€’å½’çš„å½¢å¼ã€‚ [æœ¬æ–‡å®Œï¼Œæ¬¢è¿è½¬è½½ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„]","link":"/p/b2d7d4cd.html"},{"title":"æºç è§£è¯»(ä¸€): ThreadLocalå·¥ä½œåŸç†","text":"ThreadLocalä¸ºè§£å†³å¹¶å‘é—®é¢˜æä¾›äº†æ–°çš„æ€è·¯ï¼Œèƒ½å¤Ÿç®€æ´çš„ç¼–å†™å‡ºä¼˜ç¾çš„å¤šçº¿ç¨‹ç¨‹åº.å½“ä½¿ç”¨ThreadLocalç»´æŠ¤å˜é‡æ—¶ï¼ŒThreadLocalä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬,æ‰€ä»¥æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶å®ƒçº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬.ä»çº¿ç¨‹çš„è§’åº¦çœ‹ï¼Œç›®æ ‡å˜é‡å°±è±¡æ˜¯çº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œè¿™ä¹Ÿæ˜¯ç±»åä¸­Localæ‰€è¦è¡¨è¾¾çš„æ„æ€.æ‰€ä»¥ï¼Œåœ¨Javaä¸­ç¼–å†™çº¿ç¨‹å±€éƒ¨å˜é‡çš„ä»£ç ç›¸å¯¹æ¥è¯´è¦ç¬¨æ‹™ä¸€äº›. ThreadLocalä¸­çš„æ–¹æ³•12345678910111213141516171819202122public class DataSourceTypeManager { private static final ThreadLocal&lt;DataSources&gt; dataSourceTypes = new ThreadLocal&lt;DataSources&gt;() { @Override protected DataSources initialValue() { return DataSources.DATASOURCE_DEFAULT; } }; public static DataSources get() { return dataSourceTypes.get(); } public static void set(DataSources dataSourceType) { dataSourceTypes.set(dataSourceType); } public static void reset() { dataSourceTypes.set(DataSources.DATASOURCE_DEFAULT); }} initialValue(): è¿”å›è¯¥çº¿ç¨‹å±€éƒ¨å˜é‡çš„åˆå§‹å€¼,è¯¥æ–¹æ³•æ˜¯protectedä¿®é¥°çš„ï¼Œæ˜¯è®©å­ç±»å»è¿›è¡Œè¦†ç›–çš„ã€‚å®ƒæ˜¯å»¶è¿Ÿè°ƒç”¨çš„ï¼Œåœ¨çº¿ç¨‹ç¬¬1æ¬¡è°ƒç”¨get()æˆ–set(Object)æ—¶æ‰æ‰§è¡Œï¼Œå¹¶ä¸”ä»…æ‰§è¡Œ1æ¬¡ã€‚ThreadLocalä¸­çš„ç¼ºçœå®ç°ç›´æ¥è¿”å›ä¸€ä¸ªnullã€‚ set(Object value): è®¾ç½®å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼ã€‚ get(): è¿”å›å½“å‰çº¿ç¨‹æ‰€å¯¹åº”çš„çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚ remove(): å°†å½“å‰çº¿ç¨‹å±€éƒ¨å˜é‡çš„å€¼åˆ é™¤,ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å†…å­˜çš„å ç”¨ï¼ŒJDK 5.0æ–°å¢æ–¹æ³•ã€‚æ³¨æ„ï¼Œå½“çº¿ç¨‹ç»“æŸåï¼Œå¯¹åº”è¯¥çº¿ç¨‹çš„å±€éƒ¨å˜é‡å°†è‡ªåŠ¨è¢«åƒåœ¾å›æ”¶ï¼Œæ‰€ä»¥æ˜¾å¼è°ƒç”¨è¯¥æ–¹æ³•æ¸…é™¤çº¿ç¨‹çš„å±€éƒ¨å˜é‡å¹¶ä¸æ˜¯å¿…é¡»çš„æ“ä½œï¼Œä½†å¯ä»¥åŠ å¿«å†…å­˜å›æ”¶çš„é€Ÿåº¦ã€‚ reset(): åœ¨JDK5.0ä¸­ï¼ŒThreadLocalå·²ç»æ”¯æŒæ³›å‹ï¼Œè¯¥ç±»çš„ç±»åå·²ç»å˜ä¸ºThreadLocal&lt;T&gt;,æ–°ç‰ˆæœ¬æ–¹æ³• void set(T value)ã€T get()å’ŒT initialValue()ã€‚ å¦‚ä½•åšåˆ°æ¯ä¸€ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªå˜é‡å‰¯æœ¬åœ¨ThreadLocalç±»ä¸­æœ‰ä¸€ä¸ªMapï¼Œç”¨äºå­˜å‚¨æ¯ä¸€ä¸ªçº¿ç¨‹çš„å˜é‡å‰¯æœ¬ï¼ŒMapä¸­å…ƒç´ çš„é”®ä¸ºçº¿ç¨‹å¯¹è±¡ï¼Œè€Œå€¼å¯¹åº”çº¿ç¨‹çš„å˜é‡å‰¯æœ¬ã€‚ æºç 123456789101112131415//getæ–¹æ³•å®ç°public T get() { Thread t = Thread.currentThread(); //&lt;1&gt; ThreadLocalMap map = getMap(t); //&lt;2&gt; if (map != null) { ThreadLocalMap.Entry e = map.getEntry(this);//&lt;3&gt; if (e != null) { @SuppressWarnings(&quot;unchecked&quot;) T result = (T)e.value; return result; } } return setInitialValue(); } &lt;1&gt;å–å¾—å½“å‰çº¿ç¨‹t &lt;2&gt;é€šè¿‡getMap(t)æ–¹æ³•è·å–åˆ°ä¸€ä¸ªmapï¼Œç±»å‹ä¸ºThreadLocalMapã€‚ &lt;3&gt;æ¥ç€é€šè¿‡å½“å‰å¯¹è±¡ä½œä¸ºkeyè·å–åˆ°&lt;key,value&gt;é”®å€¼å¯¹ï¼Œæ³¨æ„è¿™é‡Œè·å–é”®å€¼å¯¹ä¼ è¿›å»çš„æ˜¯thisï¼Œè€Œä¸æ˜¯å½“å‰çº¿ç¨‹tã€‚ å¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å›valueå€¼ã€‚ å¦‚æœmapä¸ºç©ºï¼Œåˆ™è°ƒç”¨setInitialValueæ–¹æ³•è¿”å›valueã€‚ æˆ‘ä»¬ä¸Šé¢çš„æ¯ä¸€å¥æ¥ä»”ç»†åˆ†æ,é¦–å…ˆçœ‹ä¸€ä¸‹getMapæ–¹æ³•ä¸­åšäº†ä»€ä¹ˆ 1234ThreadLocalMap getMap(Thread t) { return t.threadLocals;} åœ¨getMapä¸­ï¼Œæ˜¯è°ƒç”¨å½“å‰çº¿ç¨‹tï¼Œè¿”å›å½“å‰çº¿ç¨‹tä¸­çš„ä¸€ä¸ªæˆå‘˜å˜é‡threadLocalsã€‚ç‚¹è¿›å»è¿™ä¸ªæ–¹æ³•ï¼Œå»Threadç±»ä¸­å–çœ‹ä¸€ä¸‹æˆå‘˜å˜é‡threadLocalsæ˜¯ä»€ä¹ˆ? 1234/* ThreadLocal values pertaining to this thread. This map is maintained* by the ThreadLocal class. */ThreadLocal.ThreadLocalMap threadLocals = null; æ„æ€æ˜¯ï¼Œè¿™ä¸ªThreadLocalå˜é‡æ˜¯é™„å±åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­çš„ï¼Œè¿™ä¸ªmapæ˜¯ç”±ThreadLocalå»ç»´æŠ¤çš„ã€‚ThreadLocalMapè¿™ä¸ªç±»æ˜¯ThreadLocalç±»çš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œç»§ç»­çœ‹ThreadLocalMapçš„å®ç°ï¼š 12345678910111213static class ThreadLocalMap { static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; { /** The value associated with this ThreadLocal. */ Object value; Entry(ThreadLocal&lt;?&gt; k, Object v) { super(k); value = v; }}//...ç•¥ å¯ä»¥çœ‹åˆ°ThreadLocalMapçš„Entryç»§æ‰¿äº†WeakReferenceï¼Œå¹¶ä¸”ä½¿ç”¨ThreadLocalä½œä¸ºKeyã€‚ç»§ç»­çœ‹setInitialValueæ–¹æ³•çš„å…·ä½“å®ç°ï¼š 12345678910private T setInitialValue() { T value = initialValue(); Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value); return value; } æ ¹æ®æºç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå°±æ˜¯å¦‚æœmapä¸ä¸ºç©ºï¼Œå°±è®¾ç½®é”®å€¼å¯¹ï¼Œä¸ºç©ºï¼Œå†åˆ›å»ºMapï¼Œçœ‹ä¸€ä¸‹createMapçš„å®ç°ï¼š 123456void createMap(Thread t, T firstValue) { t.threadLocals = new ThreadLocalMap(this, firstValue);} å¦‚æœä¸ºç©ºï¼Œç›´æ¥newäº†ä¸€ä¸ªThreadLocalMap,keyæ˜¯ThreadLocalå¯¹è±¡ è‡³æ­¤ï¼Œå·²ç»æ˜ç™½äº†ThreadLocalæ˜¯å¦‚ä½•ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºå˜é‡çš„å‰¯æœ¬çš„ï¼š é¦–å…ˆï¼Œåœ¨æ¯ä¸ªçº¿ç¨‹Threadå†…éƒ¨æœ‰ä¸€ä¸ªThreadLocal.ThreadLocalMapç±»å‹çš„æˆå‘˜å˜é‡threadLocalsï¼Œè¿™ä¸ªthreadLocalså°±æ˜¯ç”¨æ¥å­˜å‚¨å®é™…çš„å˜é‡å‰¯æœ¬çš„ï¼Œé”®å€¼(key)ä¸ºå½“å‰ThreadLocalå˜é‡ï¼Œvalueä¸ºå˜é‡å‰¯æœ¬ï¼ˆå³Tç±»å‹çš„å˜é‡ï¼‰ã€‚ åˆå§‹æ—¶ï¼Œåœ¨Threadé‡Œé¢ï¼ŒthreadLocalsä¸ºç©ºï¼Œå½“é€šè¿‡ThreadLocalå˜é‡è°ƒç”¨get()æ–¹æ³•æˆ–è€…set()æ–¹æ³•ï¼Œå°±ä¼šå¯¹Threadç±»ä¸­çš„threadLocalsè¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸”ä»¥å½“å‰ThreadLocalå˜é‡ä¸ºé”®å€¼ï¼Œä»¥ThreadLocalè¦ä¿å­˜çš„å‰¯æœ¬å˜é‡ä¸ºvalueï¼Œå­˜åˆ°threadLocalsã€‚ ç„¶ååœ¨å½“å‰çº¿ç¨‹é‡Œé¢ï¼Œå¦‚æœè¦ä½¿ç”¨å‰¯æœ¬å˜é‡ï¼Œå°±å¯ä»¥é€šè¿‡getæ–¹æ³•åœ¨threadLocalsé‡Œé¢æŸ¥æ‰¾ã€‚ ä»£ç å®æˆ˜ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯æ˜é€šè¿‡ThreadLocalèƒ½è¾¾åˆ°åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºå˜é‡å‰¯æœ¬çš„æ•ˆæœï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class Demo3 { private ThreadLocal&lt;Long&gt; longLocal = new ThreadLocal&lt;Long&gt;(); private ThreadLocal&lt;String&gt; stringLocal = new ThreadLocal&lt;String&gt;(); public void set() { longLocal.set(Thread.currentThread().getId()); stringLocal.set(Thread.currentThread().getName()); } public long getLong() { return longLocal.get(); } public String getString() { return stringLocal.get(); } public static void main(String[] args) throws InterruptedException { final Demo3 test = new Demo3(); test.set(); System.out.println(test.getLong()); System.out.println(test.getString()); Thread thread1 = new Thread(){ public void run() { test.set(); System.out.println(test.getLong()); System.out.println(test.getString()); }; }; thread1.start(); thread1.join(); System.out.println(test.getLong()); System.out.println(test.getString()); }} æ§åˆ¶å°è¾“å‡ºï¼š 1234561 //ä¸»çº¿ç¨‹idmain //ä¸»çº¿ç¨‹åç§°10 //thread1 idThread-0 //thread1åç§°1 //ä¸»çº¿ç¨‹idmain //ä¸»çº¿ç¨‹åç§° ä»è¿™æ®µä»£ç çš„è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œåœ¨mainçº¿ç¨‹ä¸­å’Œthread1çº¿ç¨‹ä¸­ï¼ŒlongLocalä¿å­˜çš„å‰¯æœ¬å€¼å’ŒstringLocalä¿å­˜çš„å‰¯æœ¬å€¼éƒ½ä¸ä¸€æ ·ã€‚æœ€åä¸€æ¬¡åœ¨mainçº¿ç¨‹å†æ¬¡æ‰“å°å‰¯æœ¬å€¼æ˜¯ä¸ºäº†è¯æ˜åœ¨mainçº¿ç¨‹ä¸­å’Œthread1çº¿ç¨‹ä¸­çš„å‰¯æœ¬å€¼ç¡®å®æ˜¯ä¸åŒçš„ã€‚(å› ä¸ºå½“åˆä»–ä»¬è®¾ç½®å€¼å¾—æ—¶å€™å°±ä¸ä¼šä¸€æ ·çš„) æ€»ç»“1ï¼‰å®é™…ä¸Šçš„é€šè¿‡ThreadLocalåˆ›å»ºçš„å‰¯æœ¬æ˜¯å­˜å‚¨åœ¨æ¯ä¸ªçº¿ç¨‹è‡ªå·±çš„threadLocalsä¸­çš„ï¼› 2ï¼‰ä¸ºä½•threadLocalsçš„ç±»å‹ThreadLocalMapçš„é”®å€¼ä¸ºThreadLocalå¯¹è±¡?å› ä¸ºæ¯ä¸ªçº¿ç¨‹ä¸­å¯æœ‰å¤šä¸ªthreadLocalå˜é‡ï¼Œå°±åƒä¸Šé¢ä»£ç å®æˆ˜1ä¸­çš„longLocalå’ŒstringLocalï¼› 3ï¼‰åœ¨è¿›è¡Œgetä¹‹å‰ï¼Œå¿…é¡»å…ˆsetï¼Œå¦åˆ™ä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼›å¦‚æœæƒ³åœ¨getä¹‹å‰ä¸éœ€è¦è°ƒç”¨setå°±èƒ½æ­£å¸¸è®¿é—®çš„è¯ï¼Œå¿…é¡»é‡å†™initialValue()æ–¹æ³•ã€‚å› ä¸ºåœ¨ä¸Šé¢çš„ä»£ç åˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°å¦‚æœæ²¡æœ‰å…ˆsetçš„è¯ï¼Œå³åœ¨mapä¸­æŸ¥æ‰¾ä¸åˆ°å¯¹åº”çš„å­˜å‚¨ï¼Œåˆ™ä¼šé€šè¿‡è°ƒç”¨setInitialValueæ–¹æ³•è¿”å›iï¼Œè€Œåœ¨setInitialValueæ–¹æ³•ä¸­ï¼Œæœ‰ä¸€ä¸ªè¯­å¥æ˜¯T value = initialValue()ï¼Œ è€Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒinitialValueæ–¹æ³•è¿”å›çš„æ˜¯nullã€‚ å¦‚ä»£ç å®æˆ˜1ï¼Œæˆ‘ä»¬æŠŠset()æ–¹æ³•æ³¨é‡Šæ‰ï¼Œè¿è¡Œä»£ç ï¼Œå°±ä¼šæŠ¥ç©ºæŒ‡é’ˆ 1234567//test.set();output:Exception in thread &quot;main&quot; java.lang.NullPointerExceptionat com.may.threadlocal.Demo3.getLong(Demo3.java:14)at com.may.threadlocal.Demo3.main(Demo3.java:26) ä½†æ˜¯å¦‚æœé‡å†™äº†initialValueæ–¹æ³•åï¼š 1234567891011121314private ThreadLocal&lt;Long&gt; longLocal = new ThreadLocal&lt;Long&gt;(){ protected Long initialValue() { return Thread.currentThread().getId(); };};private ThreadLocal&lt;String&gt; stringLocal = new ThreadLocal&lt;String&gt;(){ protected String initialValue() { return Thread.currentThread().getName(); }; }; å†å»è¿è¡Œï¼Œå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥ä¸ç”¨å…ˆsetè€Œç›´æ¥è°ƒç”¨getäº†ã€‚å»ºè®®ï¼Œä¸€èˆ¬åº”ç”¨æ—¶ï¼Œé‡å†™initialValue()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å»¶è¿Ÿè°ƒç”¨çš„ï¼Œå†æ¬¡å¼ºè°ƒã€‚ ThreadLocalçš„åº”ç”¨åœºæ™¯ThreadLocalçš„åº”ç”¨åœºåˆï¼Œæˆ‘è§‰å¾—æœ€é€‚åˆçš„æ˜¯æŒ‰çº¿ç¨‹å¤šå®ä¾‹ï¼ˆæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªå®ä¾‹ï¼‰çš„å¯¹è±¡çš„è®¿é—®ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡å¾ˆå¤šåœ°æ–¹éƒ½è¦ç”¨åˆ°ã€‚æœ€å¸¸è§çš„ThreadLocalä½¿ç”¨åœºæ™¯ä¸º ç”¨æ¥è§£å†³ æ•°æ®åº“è¿æ¥ã€Sessionç®¡ç†ç­‰ã€‚ ä»£ç 1 12345678910private static ThreadLocal&lt;Connection&gt; connectionHolder= new ThreadLocal&lt;Connection&gt;() { public Connection initialValue() { return DriverManager.getConnection(DB_URL); }}; public static Connection getConnection() { return connectionHolder.get();} ä»£ç 2hibernateä¸­å…¸å‹çš„ThreadLocalçš„åº”ç”¨ 12345678910111213141516private static final ThreadLocal threadSession = new ThreadLocal(); public static Session getSession() throws InfrastructureException { Session s = (Session) threadSession.get(); try { if (s == null) { s = getSessionFactory().openSession(); threadSession.set(s); } } catch (HibernateException ex) { throw new InfrastructureException(ex); } return s;} ä»£ç 3å¤šæ•°æ®æºé…ç½®æ—¶ä½¿ç”¨(ä¼ é€é—¨) 123456789101112131415161718192021public class DataSourceTypeManager { private static final ThreadLocal&lt;DataSources&gt; dataSourceTypes = new ThreadLocal&lt;DataSources&gt;() { @Override protected DataSources initialValue() { return DataSources.DATASOURCE_DEFAULT; } }; public static DataSources get() { return dataSourceTypes.get(); } public static void set(DataSources dataSourceType) { dataSourceTypes.set(dataSourceType); } public static void reset() { dataSourceTypes.set(DataSources.DATASOURCE_DEFAULT); }} ç»“æŸè¯­æ€»ä¹‹ï¼ŒThreadLocalä¸æ˜¯ç”¨æ¥è§£å†³å¯¹è±¡å…±äº«è®¿é—®é—®é¢˜çš„ï¼Œè€Œä¸»è¦æ˜¯æä¾›äº†ä¿æŒå¯¹è±¡çš„æ–¹æ³•å’Œé¿å…å‚æ•°ä¼ é€’çš„æ–¹ä¾¿çš„å¯¹è±¡è®¿é—®æ–¹å¼ã€‚å½’çº³äº†ä¸¤ç‚¹ï¼š1ã€‚æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ThreadLocalMapç±»å¯¹è±¡ï¼Œå¯ä»¥å°†çº¿ç¨‹è‡ªå·±çš„å¯¹è±¡ä¿æŒåˆ°å…¶ä¸­ï¼Œå„ç®¡å„çš„ï¼Œçº¿ç¨‹å¯ä»¥æ­£ç¡®çš„è®¿é—®åˆ°è‡ªå·±çš„å¯¹è±¡ã€‚2ã€‚å°†ä¸€ä¸ªå…±ç”¨çš„ThreadLocalé™æ€å®ä¾‹ä½œä¸ºkeyï¼Œå°†ä¸åŒå¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°ä¸åŒçº¿ç¨‹çš„ThreadLocalMapä¸­ï¼Œç„¶ååœ¨çº¿ç¨‹æ‰§è¡Œçš„å„å¤„é€šè¿‡è¿™ä¸ªé™æ€ThreadLocalå®ä¾‹çš„get()æ–¹æ³•å–å¾—è‡ªå·±çº¿ç¨‹ä¿å­˜çš„é‚£ä¸ªå¯¹è±¡ï¼Œé¿å…äº†å°†è¿™ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’çš„éº»çƒ¦ã€‚ å‚è€ƒï¼š http://www.iteye.com/topic/103804 http://www.cnblogs.com/dolphin0520/p/3920407.html END","link":"/p/7a285261.html"},{"title":"ä»ç¤ºä¾‹é€æ¸ç†è§£Scalaéšå¼è½¬æ¢","text":"éšå¼è½¬æ¢å’Œéšå¼å‚æ•°æ˜¯ Scala çš„ä¸¤ä¸ªåŠŸèƒ½å¼ºå¤§çš„å·¥å…·ã€‚éšå¼è½¬æ¢å¯ä»¥ä¸°å¯Œç°æœ‰ç±»çš„åŠŸèƒ½ï¼Œéšå¼å¯¹è±¡æ˜¯å¦‚ä½•è¢«è‡ªåŠ¨å‘¼å‡ºä»¥ç”¨äºæ‰§è¡Œè½¬æ¢æˆ–å…¶ä»–ä»»åŠ¡çš„ã€‚åˆ©ç”¨è¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ä¼˜é›…çš„ç±»åº“ã€‚ æœ¬æ–‡å°†é€šè¿‡å‡ ä¸ªç¤ºä¾‹ä»£ç æ¥æ•´ä½“å­¦ä¹ ä¸€ä¸‹ Scala éšå¼è½¬æ¢çš„å››ä¸ªç‰¹æ€§å’Œè¿ç”¨ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ éšå¼å‡½æ•°è¿ç”¨ã€éšå¼ç±»æ‰©å±•è¿ç”¨ã€éšå¼å‚æ•°ã€ç±»å‹ç±»(Type class)\bè¿ç”¨ã€‚ éšå¼è½¬æ¢ implicit conversion functionï¼šæŒ‡çš„æ˜¯é‚£ç§ä»¥ implicit å…³é”®å­—å£°æ˜çš„å¸¦æœ‰å•ä¸ªå‚æ•°çš„å‡½æ•°ã€‚è¿™æ ·çš„å‡½æ•°å°†è¢«è‡ªåŠ¨åº”ç”¨ï¼Œå°†å€¼ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚ éšå¼å‡½æ•° implicit defå®šä¹‰ä¸€ä¸ª case class ç±» Multiplyï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæ–¹æ³• multiply ï¼Œæ¥æ”¶ä¸€ä¸ªå½“å‰å¯¹è±¡ï¼Œå¹¶å°†å€¼ç›¸ä¹˜åè¿”å›ã€‚å®šä¹‰éšå¼è½¬æ¢å‡½æ•° int2Multiply 12345678910case class Multiply(m: Int, n: Int) { def multiply(other: Multiply): Multiply = { Multiply(other.m * m, other.n * n) }}object MultiplyImplicit { //å®šä¹‰éšå¼è½¬æ¢å‡½æ•°ï¼Œå‚æ•°å•ä¸ªï¼Œå°† int éšå¼è½¬æ¢ä¸º Multiply å¯¹è±¡ implicit def int2Multiply(n: Int): Multiply = Multiply(n, 2)} æµ‹è¯•ç±» MultiplyMain 123456789object MultiplyMain { //å¯¼å…¥éšå¼è½¬æ¢æ–¹æ³•ï¼ˆå±€éƒ¨å¼•ç”¨å¯ä»¥é¿å…ä¸æƒ³è¦çš„éšå¼è½¬æ¢å‘ç”Ÿï¼‰ import com.maple.implic.one.MultiplyImplicit._ def main(args: Array[String]): Unit = { val x: Multiply = 3.multiply(Multiply(2, 1)) println(x.toString) }} è¿è¡Œç¨‹åºç»“æœå¦‚ä¸‹:12345ç»“æœä¸ºï¼šMultiply(6,2)//è®¡ç®—è¿‡ç¨‹ï¼Œ3 éšå¼è½¬æ¢ä¸º Multiply(3, 2)3 =&gt; Multiply(3, 2)//è°ƒç”¨multiplyè®¡ç®—Multiply(3, 2).multiply(Multiply(2, 1)) =Multiply( 3*2 , 2*1 ) å¦‚æœæˆ‘ä»¬æä¾›å¤šä¸ªéšå¼è½¬æ¢å‡½æ•°12345object MultiplyImplicit { implicit def int2Multiply(n: Int): Multiply = Multiply(n, 2) //æä¾›ç¬¬äºŒä¸ªéšå¼è½¬æ¢å‡½æ•° implicit def int2Multiply2(n: Int): Multiply = Multiply(n, 3)} åœ¨ Main ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è¿›è¡ŒæŒ‡å®šå…·ä½“ä½¿ç”¨å“ªä¸ªéšå¼è½¬æ¢å‡½æ•°ã€‚æ¯”å¦‚æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ int2Multiplyçš„éšå¼è½¬æ¢1234567891011object MultiplyMain { //æ–¹æ³•1: æ’é™¤ int2Multiply2 æ–¹æ³•ï¼Œå¼•å…¥å…¶ä½™æ‰€æœ‰çš„æ–¹æ³• import com.maple.implic.one.MultiplyImplicit.{int2Multiply2 â‡’ _, _} // æ–¹æ³•2: ç²¾ç¡®å¼•å…¥ import com.maple.implic.one.MultiplyImplicit.int2Multiply def main(args: Array[String]): Unit = { val x: Multiply = 3.multiply(Multiply(2, 1)) println(x.toString) }} éšå¼ç±»ï¼Œä¸°å¯Œç°æœ‰ç±»åº“åŠŸèƒ½ ä½ æ˜¯å¦å¸Œæœ›æŸä¸ªç±»æ‹¥æœ‰æ–°çš„æ–¹æ³•ï¼Œè€Œæ­¤æ–¹æ³•è¯¥ç±»å¹¶æ²¡æœ‰æä¾›ï¼Œé‚£ä¹ˆéšå¼è½¬æ¢å¯ä»¥ä¸°å¯Œè¿™ä¸ªç±»ï¼Œç»™å®ƒæä¾›æ›´å¤šçš„æ–¹æ³• ä¾‹å¦‚æ•°æ®åº“è¿æ¥ç±» Connection, æˆ‘ä»¬å¸Œæœ›ç»™å®ƒæ–°å¢ä¸€ä¸ª executeUpdate æ–¹æ³•æ¥å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œä¾‹å­å¦‚ä¸‹: 123456789101112131415package com.maple.implic.twoimport java.sql.Connectionimport scala.language.implicitConversions//éšå¼ç±»ï¼ŒRichè¡¨ç¤ºå¯¹Connectionçš„å¢å¼ºç±»class RichConnection(conn: Connection) { //å®šä¹‰çš„æ–°æ–¹æ³• executeUpdateï¼Œå¯¹æ•°æ®æ“ä½œ def executeUpdate(sql: String): Int = { conn.prepareStatement(sql).executeUpdate() }}//æä¾›éšå¼è½¬æ¢ func æ¥å°†åŸæœ‰ç±»å‹è½¬æ¢ä¸ºRich ç±»å‹object RichConnection { implicit def executeUpdate(connection: Connection) = new RichConnection(connection)} æµ‹è¯•ç¨‹åº 12345678910111213141516171819object ConnectionMain { //å¼•å…¥éšå¼è½¬æ¢ func import com.maple.implic.two.RichConnection._ def main(args: Array[String]): Unit = { //å®šä¹‰ dataSource val ds: DataSource = { val ds = new MysqlDataSource ds.setURL(&quot;jdbc:mysql://127.0.0.1:3306/maple?useUnicode=true&amp;characterEncoding=utf8&quot;) ds.setUser(&quot;root&quot;) ds.setPassword(&quot;123456&quot;) ds } //è·å– conn val connection = ds.getConnection //æ‰§è¡ŒæŸ¥è¯¢ connection.executeUpdate(&quot;UPDATE t_user SET name = 'maple' WHERE id = 1&quot;) }} ä¸Šé¢é€šè¿‡å®šä¹‰ä¸€ä¸ª RichConnection æˆ‘ä»¬å¯ä»¥å¢å¼ºç°æœ‰ç±» Connection çš„åŠŸèƒ½ã€‚è¿™æ ·ä¸€æ¥ï¼Œé€šè¿‡ connection å¯¹æ•°æ®åº“è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œå¯ä»¥ç®€åŒ–å¤§é‡ä»£ç ã€‚ éšå¼å‚æ•° å‡½æ•°æˆ–æ–¹æ³•å¯ä»¥å¸¦æœ‰ä¸€ä¸ªæ ‡è®°ä¸º implicit çš„å‚æ•°åˆ—è¡¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å°†ä¼šæŸ¥æ‰¾é»˜è®¤å€¼ï¼Œæä¾›ç»™æœ¬æ¬¡å‡½æ•°è°ƒç”¨ã€‚ åˆ©ç”¨éšå¼å‚æ•°è¿›è¡Œéšå¼è½¬æ¢ éšå¼çš„å‡½æ•°å‚æ•°ä¹Ÿå¯ä»¥è¢«ç”¨ä½œéšå¼è½¬æ¢ã€‚å¦‚æœæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ³›å‹å‡½æ•° 1def larger[T](x: T, y: T) = if (x &gt; y) x else y å…³äºéšå¼å‚æ•°çš„å¦ä¸€ä»¶äº‹æ˜¯ï¼Œå®ƒä»¬å¯èƒ½æœ€å¸¸ç”¨äºæä¾›æœ‰å…³åœ¨æ—©æœŸå‚æ•°åˆ—è¡¨ä¸­æ˜¾å¼æåˆ°çš„ç±»å‹çš„ä¿¡æ¯ï¼Œç±»ä¼¼äºHaskellçš„ç±»å‹ç±»ã€‚ä½œä¸ºç¤ºä¾‹ï¼Œè¯·è€ƒè™‘æ¸…å•21.2ä¸­æ‰€ç¤ºçš„maxListUpBoundå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¼ é€’åˆ—è¡¨çš„æœ€å¤§å…ƒç´  1234567891011def maxListUpBound[T &lt;: Ordered[T]](elements: List[T]): T = { elements match { case List() =&gt; throw new IllegalArgumentException(&quot;empty list!&quot;) case List(x) =&gt; x case x :: rest =&gt; val maxRest = maxListUpBound(rest) if (x &gt; maxRest) x else maxRest }} maxListUpBound è¡¨ç¤ºä¼ å…¥ä¸€ä¸ª Listï¼Œç„¶åè¿”å› list ä¸­æœ€å¤§çš„ä¸€ä¸ªå…ƒç´ ã€‚åŠŸèƒ½ç®€å•ï¼Œä½†æ˜¯ç”¨æ³•ååˆ†é™åˆ¶ï¼Œè¯¥Listä¸­çš„æˆå‘˜å¿…é¡»æ˜¯ Ordered[T] çš„å­ç±»ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚æ¯”å¦‚æˆ‘ä»¬è¿è¡Œå¦‚ä¸‹ä¾‹å­ 1234567object ImplicitParameterMain { import com.maple.implic.three.ImplicitParameter._ def main(args: Array[String]): Unit = { val result = maxListUpBound(List[Integer](1, 2, 3)) println(result) }} å½“æˆ‘ä»¬è¿è¡Œ main å‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥å¦‚ä¸‹é”™ã€‚æ„æ€æ˜¯ Int ä¸æ˜¯ Ordered[T] å­ç±»ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ã€‚ 123456Error:(49, 18) inferred type arguments [Int] do not conform to method maxListUpBound's type parameter bounds [T &lt;: Ordered[T]] val result = maxListUpBound(List[Int](1, 2, 3))Error:(49, 42) type mismatch; found : List[Int] required: List[T] val result = maxListUpBound(List[Int](1, 2, 3)) ä½¿ç”¨éšå¼å‚æ•°ä¼˜åŒ– å¦‚æœè®© maxListUpBound æ›´é€šç”¨ï¼Œæˆ‘ä»¬éœ€è¦åˆ†ç¦»è¿™ä¸ªå‡½æ•°ï¼Œå¢åŠ ä¸€ä¸ªå‚æ•°ï¼Œæ¥å°† T è½¬æ¢ä¸º Ordered[T]ï¼Œä½¿ç”¨éšå¼å‚æ•° implicit orders: T â‡’ Ordered[T]æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ 1234567891011def maxListUpBound2[T](elements: List[T])(implicit orders: T â‡’ Ordered[T]): T = { elements match { case List() =&gt; throw new IllegalArgumentException(&quot;empty list!&quot;) case List(x) =&gt; x case x :: rest =&gt; val maxRest = maxListUpBound2(rest) if (x &gt; maxRest) x else maxRest } } æµ‹è¯•ç¨‹åºï¼š 123456import com.maple.implic.three.ImplicitParameter._def main(args: Array[String]): Unit = { val result = maxListUpBound2(List[Int](1, 2, 3)) println(result)} ç»“æœä¸º3ï¼Œå¹¶æ²¡æœ‰æŠ¥é”™ã€‚è¿™å…¶ä¸­ç¼–è¯‘å™¨æ˜¯å°† Int è½¬æ¢ä¸ºäº† Ordered[Int] ç±»å‹ç±»(type class) è®©æŸä¸ªç±»æ‹¥æœ‰æŸä¸ªç®—æ³•ï¼Œæˆ‘ä»¬æ— éœ€ä¿®æ”¹è¿™ä¸ªç±»ï¼Œæä¾›ä¸€ä¸ªéšå¼è½¬æ¢å³å¯ã€‚è¿™ç§åšæ³•ç›¸å¯¹äºé¢å‘å¯¹è±¡çš„ç»§æ‰¿æ‰©å±•æ¥çš„æ›´çµæ´»ã€‚ çœ‹ä¸‹é¢ä¸¤ä¸ªä¾‹å­ï¼ŒOrdering æ˜¯ Scala æä¾›çš„ç±»å‹ç±» 123456789101112131415object Implicits { implicit class OrderedExt[T: Ordering](v: T) { def between(min: T, max: T) = { val ordering = implicitly[Ordering[T]] ordering.lteq(min, v) &amp;&amp; ordering.lteq(v, max) } } implicit class OrderedExt2[T](v: T)(implicit ordering: Ordering[T]) { def between2(min: T, max: T) = { ordering.lteq(min, v) &amp;&amp; ordering.lteq(v, max) } }} ä½¿ç”¨ï¼Œä¸Šé¢ä¸¤ç§å†™æ³•éƒ½å¯ä»¥è¾¾åˆ°ç›¸åŒçš„åŠŸèƒ½ã€‚ 1234567import com.maple.implic.Implicits._def main(args: Array[String]): Unit = { val isBetween = 10.between(2, 20) val isBetween2 = 30.between2(2, 20) println(isBetween) println(isBetween2)} Ordering è¿™æ ·çš„ç‰¹è´¨(trait) è¢«ç§°ä¸ºç±»å‹ç±»(type classï¼Œæºè‡ª Haskell) ã€‚ç±»å‹ç±»å®šä¹‰äº†æŸç§è¡Œä¸ºï¼Œä»»ä½•ç±»å‹éƒ½å¯ä»¥é€šè¿‡æä¾›ç›¸åº”çš„è¡Œä¸ºæ¥åŠ å…¥è¿™ä¸ªç±»ã€‚è¿™ä¸ªç±»æ˜¯å› ä¸ºå…±ç”¨çš„ç›®çš„è€Œç»„åˆåœ¨ä¸€èµ·çš„ç±»å‹ã€‚ è‡ªå®šä¹‰ç±»å‹ç±» Scala æ ‡å‡†ç±»åº“æä¾›äº†ä¸å°‘ç±»å‹ç±»ã€‚æ¯”å¦‚ Equivã€Numericã€Fractionalã€Hashingã€IsTraverableOneã€IsTraverableLike ç­‰ã€‚æˆ‘ä»¬é€šè¿‡è‡ªå®šä¹‰ä¸€ä¸ªç±»å‹ CustomOperation æ¥æ›´æ·±å…¥çš„å­¦ä¹ ã€‚ å®šä¹‰ç‰¹è´¨ CustomOperation 123456trait CustomOperation[T] { // åŠ æ“ä½œ def plus(x: T, y: T): T // ä¹˜æ“ä½œ def multiply(x: T, y: T): T} åœ¨ä¼´ç”Ÿå¯¹è±¡ä¸­ç»™ String ç±»å‹æ‰©å±•åŸºäº CustomOperation çš„åŠŸèƒ½ã€‚ 1234567891011121314151617181920212223242526272829object CustomOperation { implicit object StringCustomOperation extends CustomOperation[String] { override def plus(x: String, y: String): String = x + y override def multiply(x: String, y: String): String = x + &quot;*&quot; + y } //å®šä¹‰éšå¼ç±»,å¯¹ `String` è¿›è¡Œå¢å¼º implicit class CustomImplicitClass[T: CustomOperation](v: T) { def multiply(x: T, y: T): T = { //ä»å†¥ç•Œå¬å”¤çš„CustomOperation[T]éšå¼ç±»å‹ã€‚ val custom = implicitly[CustomOperation[T]] custom.multiply(v, x) + &quot;+&quot; + custom.multiply(v, y).toString } //å¦å¤–ä¸€ç§å†™æ³• /* def multiply(x: T, y: T)(implicit custom: CustomOperation[T]): String = { custom.multiply(v, x) + custom.multiply(v, y).toString }*/ def plus(x: T, y: T): String = { val custom = implicitly[CustomOperation[T]] custom.plus(v, x) + custom.plus(v, y).toString // custom.plus(x, y) } }} æµ‹è¯•ç±» CustomOperationMain: 12345678import com.maple.implic.typeclass.CustomOperation._object CustomOperationMain { // def main(args: Array[String]): Unit = { val str: String = &quot;maple&quot;.plus(&quot;&lt;&quot;, &quot;&gt;&quot;) println(str) }} ç»“æœå¦‚ä¸‹: 1234maple&lt;maple&gt;//éšå¼è½¬æ¢çš„è¿ç®—è¿‡ç¨‹ä¸º custom.plus(v, x) + custom.plus(v, y).toString override def plus(x: String, y: String): String = x + y å¦‚æœæƒ³è¦å¯¹ Double æ”¯æŒä¸Šè¿°æ“ä½œï¼ŒåŒæ ·å®šä¹‰å¦‚ä¸‹ç±»å‹ç±»æ‰©å±•å³å¯ï¼š 12345implicit object DoubleCustomOperation extends CustomOperation[Double] { override def plus(x: Double, y: Double): Double = x + y override def multiply(x: Double, y: Double): Double = x * y } æµ‹è¯•ç”¨ä¾‹ï¼š 12345import com.maple.implic.typeclass.CustomOperation._def main(args: Array[String]): Unit = { val doubleValue = 5.5.multiply(2.0, 3.0) println(doubleValue)} ç»“æœä¸º 11.0+16.5è®¡ç®—è¿‡ç¨‹ï¼š 1234custom.multiply(v, x) + &quot;+&quot; + custom.multiply(v, y).toStringoverride def multiply(x: Double, y: Double): Double = x * y//ç›¸ä¹˜åå­—ç¬¦ä¸²ç›¸åŠ 5.5*2.0 + 5.5*3.0 ===&gt; 11.0+16.5 Type Class æ€»ç»“TypeClass å°† è¡Œä¸ºå®šä¹‰ ä¸ å…·æœ‰è¡Œä¸ºçš„å¯¹è±¡ åˆ†ç¦»ã€‚æœ‰ç‚¹ç±»ä¼¼äº AOPï¼Œä½†æ˜¯æ¯” AOP ç®€æ´å¾ˆå¤šã€‚åŒæ—¶, åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œé€šå¸¸å°† æ•°æ® ä¸ è¡Œä¸º ç›¸åˆ†ç¦»ï¼Œç”šè‡³æ˜¯æ•°æ®ä¸è¡Œä¸ºæŒ‰éœ€ç»‘å®šï¼Œå·²è¾¾åˆ°æ›´ä¸ºé«˜çº§çš„ç»„åˆç‰¹æ€§ã€‚ éšå¼è½¬æ¢è§¦å‘æ—¶æœºScala ä¼šè€ƒè™‘å¦‚ä¸‹çš„éšå¼è½¬æ¢å‡½æ•°ï¼š 1.ä½äºæºæˆ–ç›®æ ‡ç±»å‹çš„ä¼´ç”Ÿå¯¹è±¡ä¸­çš„éšå¼å‡½æ•°æˆ–éšå¼ç±»ã€‚ 2.ä½äºå½“å‰ä½œç”¨åŸŸä¸­å¯ä»¥ä»¥å•ä¸ªæ ‡è¯†ç¬¦æŒ‡ä»£çš„éšå¼å‡½æ•°æˆ–éšå¼ç±»ã€‚éšå¼è½¬æ¢å¯ä»¥æ˜¾ç¤ºåŠ ä¸Šï¼Œæ¥è¿›è¡Œä»£ç è°ƒè¯•ã€‚ æ€»ç»“æœ¬æ–‡ä¸»è¦ä»‹ç» Scala éšå¼è½¬æ¢çš„å‡ ç§ç”¨æ³•ï¼Œé€šè¿‡è¯¦ç»†çš„ä¾‹å­åŠ æ·±è¯»è€…å¯¹éšå¼è½¬æ¢çš„ç†è§£ã€‚å…³äºéšå¼è½¬æ¢çš„è§¦å‘æ—¶æœºä»¥åŠç¼–è¯‘å™¨ä¼˜åŒ–é¡ºåºç­‰ï¼Œå°†ä¸åœ¨æœ¬ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»ï¼Œå¯ä»¥å…³æ³¨ç¬”è€…åç»­æ–‡ç« ã€‚ æ¨èæœ€åæ¨èä¸€ä¸‹æœ¬äººå¾®ä¿¡å…¬ä¼—å·ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ã€‚","link":"/p/2ed76eda.html"},{"title":"Springå®æˆ˜  å½»åº•ç†è§£FactoryBean","text":"åœ¨å¼ºè°ƒé¢å‘æ¥å£ç¼–ç¨‹çš„åŒæ—¶ï¼Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„:è™½ç„¶å¯¹è±¡å¯ä»¥é€šè¿‡å£°æ˜æ¥å£æ¥é¿å…å¯¹ç‰¹å®šæ¥å£å®ç°ç±»çš„è¿‡åº¦è€¦åˆï¼Œä½†æ€»å½’éœ€è¦ä¸€ç§æ–¹å¼å°†å£°æ˜ä¾èµ–æ¥å£çš„å¯¹è±¡ä¸æ¥å£å®ç°ç±»å…³è”èµ·æ¥ã€‚å¦åˆ™ï¼Œåªä¾èµ–ä¸€ä¸ªä¸åšä»»ä½•äº‹æƒ…çš„æ¥å£æ˜¯æ²¡æœ‰ä»»ä½•ç”¨å¤„çš„ã€‚ å‰è¨€å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåƒä»£ç æ¸…å•4-30æ‰€å£°æ˜çš„Fooç±»ï¼Œ å®ƒå£°æ˜äº†ä¸€ä¸ªBarInterfaceä¾èµ–ã€‚ 1234567public class Foo { private BarInterface barInstance; public Foo(){ // æˆ‘ä»¬åº”è¯¥é¿å…è¿™æ ·åš // instance = new BarInterfaceImpl(); } // ... }} å¦‚æœè¯¥ç±»æ˜¯ç”±æˆ‘ä»¬è®¾è®¡å¹¶å¼€å‘çš„ï¼Œé‚£ä¹ˆè¿˜å¥½è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¾èµ–æ³¨å…¥ï¼Œè®©å®¹å™¨å¸®åŠ©æˆ‘ä»¬è§£é™¤æ¥ å£ä¸å®ç°ç±»ä¹‹é—´çš„è€¦åˆæ€§ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼Œéœ€è¦å®ä¾‹åŒ–å¹¶ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç›¸ å…³ç±»ï¼Œè¿™æ—¶ï¼Œæ¥å£ä¸å®ç°ç±»çš„è€¦åˆæ€§éœ€è¦å…¶ä»–æ–¹å¼æ¥é¿å…ã€‚ 7é€šå¸¸çš„åšæ³•æ˜¯é€šè¿‡ä½¿ç”¨å·¥å‚æ–¹æ³•(Factory Method)æ¨¡å¼ï¼Œæä¾›ä¸€ä¸ªå·¥å‚ç±»æ¥å®ä¾‹åŒ–å…·ä½“çš„æ¥å£ å®ç°ç±»ï¼Œè¿™æ ·ï¼Œä¸»ä½“å¯¹è±¡åªéœ€è¦ä¾èµ–å·¥å‚ç±»ï¼Œå…·ä½“ä½¿ç”¨çš„å®ç°ç±»æœ‰å˜æ›´çš„è¯ï¼Œåªæ˜¯å˜æ›´å·¥å‚ç±»ï¼Œè€Œä¸» ä½“å¯¹è±¡ä¸éœ€è¦åšä»»ä½•å˜åŠ¨ã€‚ä»£ç æ¸…å•4-31æ¼”ç¤ºäº†è¿™ç§åšæ³•ã€‚ ä½¿ç”¨äº†å·¥å‚æ–¹æ³•æ¨¡å¼çš„Fooç±»å¯èƒ½å®šä¹‰1234567public class Foo { private BarInterface barInterface; public Foo(){ barInterface = BarInterfaceFactory.getInstance(); // æˆ–è€… barInterface = new BarInterfaceFactory().getInstance(); }} é’ˆå¯¹ä½¿ç”¨å·¥å‚æ–¹æ³•æ¨¡å¼å®ä¾‹åŒ–å¯¹è±¡çš„æ–¹å¼ï¼ŒSpringçš„IoCå®¹å™¨åŒæ ·æä¾›äº†å¯¹åº”çš„é›†æˆæ”¯æŒã€‚æˆ‘ä»¬æ‰€ è¦åšçš„ï¼Œåªæ˜¯å°†å·¥å‚ç±»æ‰€è¿”å›çš„å…·ä½“çš„æ¥å£å®ç°ç±»æ³¨å…¥ç»™ä¸»ä½“å¯¹è±¡(è¿™é‡Œæ˜¯Foo)ã€‚","link":"/p/60362379.html"},{"title":"springmvc æ‹¦æˆªå™¨æ¨¡æ¿","text":"å…³é”®ç‚¹ï¼šâ€™springmvcæ‹¦æˆªå™¨ â€˜ éœ€æ±‚æˆ‘ä»¬ç”¨jquery ajax è¯·æ±‚ åå° ç”¨spring æ‹¦æˆªsession è¿‡æœŸ 1. è¿‡æœŸåˆ™è·³è½¬æŒ‡å®šé¡µé¢ æ€ä¹ˆå¼„å‘€2.sessionçš„æ—¶å€™ ajax æœ‰æ—¶å€™ä¹Ÿä¼šèµ°error æ–¹æ³• è¿™ä¸ªæ€ä¹ˆå†™å¥½å‘¢ æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ä¸€äº›å¿…è¦çš„ä¿¡æ¯ã€‚ajax è¯·æ±‚å’Œæ™®é€šçš„ http è¯·æ±‚æ˜¯ä¸ä¸€æ ·çš„ï¼ŒAjaxè¯·æ±‚æ˜¯XMLHTTPRequestå¯¹è±¡å‘èµ·çš„ï¼Œè€Œhttpè¯·æ±‚æ˜¯æµè§ˆå™¨å‘èµ·çš„ã€‚ äºŒè€…ä¸åŒåœ°æ–¹ä½“ç°åœ¨HTTPè¯·æ±‚çš„å¤´ä¿¡æ¯ä¸­ã€‚ AJAXè¯·æ±‚å¤´ä¸­å¸¦æœ‰X-Requested-Withä¿¡æ¯ï¼Œå…¶å€¼ä¸ºXMLHttpRequestã€‚è€Œæ™®é€šè¯·æ±‚æ˜¯æ²¡æœ‰çš„ã€‚ åœ¨æ‹¦æˆªå™¨ä¸­è¿›è¡Œé…ç½®ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { Oper oper = (Oper)request.getSession().getAttribute(Const.SESSION_LOGIN_ADMIN_USER); String requestCTX = urlPathHelper.getContextPath(request); System.out.println(requestCTX); String requestUri = request.getRequestURI(); //è¯·æ±‚å®Œæ•´è·¯å¾„ï¼Œå¯ç”¨äºç™»é™†åè·³è½¬ String contextPath = request.getContextPath(); //é¡¹ç›®ä¸‹å®Œæ•´è·¯å¾„ String url = requestUri.substring(contextPath.length()); //è¯·æ±‚é¡µé¢ logger.debug(&quot;======æ‹¦æˆªå™¨é…ç½®æˆåŠŸ======&quot;); logger.debug(&quot;======æ‹¦æˆªæ¥è‡ªï¼š&quot;+requestUri+&quot;çš„è¯·æ±‚=======&quot;); logger.debug(&quot;======æ‹¦æˆªçš„é¡µé¢è·¯å¾„æ˜¯ï¼š==ï¼š&quot;+url+&quot;=======&quot;); //throw new Exception(&quot;ç™»å½•è¶…æ—¶!&quot;); if(oper == null){//å¦‚æœè·å–ä¸åˆ°ç™»å½•çš„session //å¦‚æœæ˜¯ajaxè¯·æ±‚ if (request.getHeader(&quot;x-requested-with&quot;) != null &amp;&amp; request.getHeader(&quot;x-requested-with&quot;).equalsIgnoreCase(&quot;XMLHttpRequest&quot;)){ response.setHeader(&quot;sessionstatus&quot;, &quot;timeout&quot;); // å“åº”å¤´è®¾ç½®sessionçŠ¶æ€ return false; //sessionè¶…æ—¶ï¼Œajaxè®¿é—®è¿”å›false } } return super.preHandle(request, response, handler); } åˆ¤æ–­ï¼Œå¦‚æœsessionè¿‡æœŸçš„è¯ï¼Œè¿›è¡Œä¸Šè¿°è®¾ç½® ç„¶åå†å‰ç«¯é¡µé¢ä¸»jsæ–‡ä»¶ä¸­è¿›è¡Œç»Ÿä¸€è®¾ç½®ï¼Œ æœ‰äº†é…ç½®æ–‡ä»¶ï¼Œä¹Ÿæœ‰äº†æ‹¦æˆªå™¨ï¼Œåœ¨æ‹¦æˆªå™¨ä¸­å·²ç»è®¾ç½®äº†è¿”å›çš„ä¿¡æ¯ï¼Œè€Œè¿™äº›ä¿¡æ¯ä¼šè¢« JavaScript è·å–åˆ°ã€‚ $.ajaxSetupæ–¹æ³•æ˜¯æ¥è®¾ç½®AJAXè¯·æ±‚é»˜è®¤é€‰é¡¹çš„ï¼Œ æˆ‘ä»¬å¯ä»¥è®¤ä¸ºæ˜¯å…¨å±€çš„é€‰é¡¹è®¾ç½®ï¼Œå› æ­¤å¯ä»¥å°†è¿™æ®µä»£ç æåˆ°å¤–éƒ¨jsæ–‡ä»¶ä¸­ï¼Œåœ¨éœ€è¦çš„é¡µé¢ test test 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253$.ajaxSetup({ type: 'POST', contentType:&quot;application/x-www-form-urlencoded;charset=utf-8&quot;, complete: function(xhr,status) { var sessionStatus = xhr.getResponseHeader('sessionstatus'); if(sessionStatus == 'timeout') { //var top = getTopWinow(); //var yes = confirm('ç”±äºæ‚¨é•¿æ—¶é—´æ²¡æœ‰æ“ä½œ, sessionå·²è¿‡æœŸ, è¯·é‡æ–°ç™»å½•.'); //if (yes) { alert(&quot;ç™»å½•è¶…æ—¶,è¯·é‡æ–°ç™»å½•ï¼&quot;); window.location.href = '/admin/login/out.do'; //} } } }); /** * åœ¨é¡µé¢ä¸­ä»»ä½•åµŒå¥—å±‚æ¬¡çš„çª—å£ä¸­è·å–é¡¶å±‚çª—å£ * @return å½“å‰é¡µé¢çš„é¡¶å±‚çª—å£å¯¹è±¡ */ function getTopWinow(){ var p = window; while(p != p.parent){ p = p.parent; } return p; } æœ¬ç« å®Œ","link":"/p/b935b55.html"},{"title":"ä½¿ç”¨ Docker å®¹å™¨æ–¹å¼æ­å»º Zookeeper é›†ç¾¤","text":"1. Zookeeperæ˜¯ä»€ä¹ˆZookeeper åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶æ˜¯ Apache Hadoop çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼åº”ç”¨ä¸­ç»å¸¸é‡åˆ°çš„ä¸€äº›æ•°æ®ç®¡ç†é—®é¢˜ï¼Œå¦‚ï¼šç»Ÿä¸€å‘½åæœåŠ¡ã€çŠ¶æ€åŒæ­¥æœåŠ¡ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼åº”ç”¨é…ç½®é¡¹çš„ç®¡ç†ç­‰ã€‚ Zookeeper ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼çš„æœåŠ¡æ¡†æ¶ï¼Œä¸»è¦ç”¨æ¥è§£å†³åˆ†å¸ƒå¼é›†ç¾¤ä¸­åº”ç”¨ç³»ç»Ÿçš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå®ƒèƒ½æä¾›åŸºäºç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•èŠ‚ç‚¹æ ‘æ–¹å¼çš„æ•°æ®å­˜å‚¨ï¼Œ Zookeeper ä½œç”¨ä¸»è¦æ˜¯ç”¨æ¥ç»´æŠ¤å’Œç›‘æ§å­˜å‚¨çš„æ•°æ®çš„çŠ¶æ€å˜åŒ–ï¼Œé€šè¿‡ç›‘æ§è¿™äº›æ•°æ®çŠ¶æ€çš„å˜åŒ–ï¼Œä»è€Œè¾¾åˆ°åŸºäºæ•°æ®çš„é›†ç¾¤ç®¡ç† ç®€å•çš„è¯´ï¼ŒZookeeper =æ–‡ä»¶ç³»ç»Ÿ+é€šçŸ¥æœºåˆ¶ã€‚ 2. Zookeeperé›†ç¾¤ä»‹ç»è¦æ­å»ºä¸€ä¸ªé«˜å¯ç”¨çš„ ZooKeeper é›†ç¾¤ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®å®šå¥½é›†ç¾¤çš„è§„æ¨¡ã€‚ä¸ºäº†ä½¿å¾— ZooKeeper é›†ç¾¤èƒ½å¤Ÿé¡ºåˆ©åœ°é€‰ä¸¾å‡º Leaderï¼Œå¿…é¡»å°† ZooKeeper é›†ç¾¤çš„æœåŠ¡å™¨æ•°éƒ¨ç½²æˆå¥‡æ•°ã€‚å…¶å®ä»»æ„å° ZooKeeper æœåŠ¡å™¨éƒ½èƒ½éƒ¨ç½²ä¸”èƒ½æ­£å¸¸è¿è¡Œã€‚ ä¸€ä¸ª ZooKeeper é›†ç¾¤å¦‚æœè¦å¯¹å¤–æä¾›å¯ç”¨çš„æœåŠ¡ï¼Œé‚£ä¹ˆé›†ç¾¤ä¸­å¿…é¡»è¦æœ‰è¿‡åŠçš„æœºå™¨æ­£å¸¸å·¥ä½œå¹¶ä¸”å½¼æ­¤ä¹‹é—´èƒ½å¤Ÿæ­£å¸¸é€šä¿¡ã€‚ ZooKeeper é›†ç¾¤æœ‰ä¸€ä¸ªç‰¹æ€§ï¼šè¿‡åŠå­˜æ´»å³å¯ç”¨ Zookeeper çš„å¯åŠ¨è¿‡ç¨‹ä¸­ leader é€‰ä¸¾æ˜¯éå¸¸é‡è¦è€Œä¸”æœ€å¤æ‚çš„ä¸€ä¸ªç¯èŠ‚ã€‚Zookeeper çš„é€‰ä¸¾è¿‡ç¨‹é€Ÿåº¦å¾ˆæ…¢ï¼Œä¸€æ—¦å‡ºç°ç½‘ç»œéš”ç¦»ï¼ŒZookeeper å°±è¦å‘èµ·é€‰ä¸¾æµç¨‹ã€‚Zookeeper çš„é€‰ä¸¾æµç¨‹é€šå¸¸è€—æ—¶ 30 åˆ° 120 ç§’ï¼ŒæœŸé—´ Zookeeper ç”±äºæ²¡æœ‰ masterï¼Œéƒ½æ˜¯ä¸å¯ç”¨çš„ 3. é›†ç¾¤æ­å»º æˆ‘ä»¬å°†ä»‹ç»ä¸¤ç§æ­å»ºæ–¹å¼ï¼Œåˆ†åˆ«åœ¨ä¸€å°æœºå™¨ä¸Šå¯åŠ¨ä¸‰ä¸ªèŠ‚ç‚¹ä½¿ç”¨ä¸åŒç«¯å£å·å®Œæˆä¼ªåˆ†å¸ƒå¼å’Œåœ¨ä¸‰å°èŠ‚ç‚¹ä¸Šå®Œå…¨æ­å»º Zookeeper é›†ç¾¤ã€‚ ä¼ªåˆ†å¸ƒå¼åœ¨ docker å®¹å™¨ä¸­æ­å»º zookeeper é›†ç¾¤ï¼Œå¯ä»¥ç”¨docker-compose.yml æ–‡ä»¶ (æœ¬æ•™ç¨‹ä½¿ç”¨3ä¸ªå®¹å™¨åšé›†ç¾¤) æ‰§è¡Œ docker-compose up -d å¯åŠ¨å®¹å™¨ï¼Œå¯åŠ¨æˆåŠŸå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æŸ¥çœ‹ Zookeeper èŠ‚ç‚¹çŠ¶æ€: docker exec -it zoo2 sh è¿›å…¥å®¹å™¨ ï¼Œæ‰§è¡Œ zkServer.sh status å®Œå…¨åˆ†å¸ƒå¼åˆ©ç”¨ docker-compose æ­å»º Zookeeper é›†ç¾¤,æœ¬æ•™ç¨‹ä½¿ç”¨3ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯åŠ¨ä¸€ä¸ª docker å®¹å™¨åšé›†ç¾¤ï¼Œé…ç½®å’Œå•æœºèŠ‚ç‚¹æ²¡å•¥åŒºåˆ«ï¼Œæ³¨æ„é…ç½® 1network_mode: &quot;host&quot; 4. æ°´å¹³æ‰©å®¹ ç®€å•åœ°è®²ï¼Œæ°´å¹³æ‰©å®¹å°±æ˜¯å‘é›†ç¾¤ä¸­æ·»åŠ æ›´å¤šçš„æœºå™¨ï¼Œä»¥æé«˜ç³»ç»Ÿçš„æœåŠ¡è´¨é‡ã€‚å¾ˆé—æ†¾çš„æ˜¯ï¼ŒZooKeeper åœ¨æ°´å¹³æ‰©å®¹æ‰©å®¹æ–¹é¢åšå¾—å¹¶ä¸ååˆ†å®Œç¾ï¼Œéœ€è¦è¿›è¡Œæ•´ä¸ªé›†ç¾¤çš„é‡å¯ã€‚ é€šå¸¸æœ‰ä¸¤ç§é‡å¯æ–¹å¼ï¼Œä¸€ç§æ˜¯é›†ç¾¤æ•´ä½“é‡å¯ï¼Œå¦å¤–ä¸€ç§æ˜¯é€å°è¿›è¡ŒæœåŠ¡å™¨çš„é‡å¯ã€‚ (1) æ•´ä½“é‡å¯æ‰€è°“é›†ç¾¤æ•´ä½“é‡å¯ï¼Œå°±æ˜¯å…ˆå°†æ•´ä¸ªé›†ç¾¤åœæ­¢ï¼Œç„¶åæ›´æ–° ZooKeeper çš„é…ç½®ï¼Œç„¶åå†æ¬¡å¯åŠ¨ã€‚å¦‚æœåœ¨ä½ çš„ç³»ç»Ÿä¸­ï¼ŒZooKeeper å¹¶ä¸æ˜¯ä¸ªéå¸¸æ ¸å¿ƒçš„ç»„ä»¶ï¼Œå¹¶ä¸”èƒ½å¤Ÿå…è®¸çŸ­æš‚çš„æœåŠ¡åœæ­¢ï¼ˆé€šå¸¸æ˜¯å‡ ç§’é’Ÿçš„æ—¶é—´é—´éš”ï¼‰ï¼Œé‚£ä¹ˆä¸å¦¨é€‰æ‹©è¿™ç§æ–¹å¼ã€‚åœ¨æ•´ä½“é‡å¯çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰è¯¥é›†ç¾¤çš„å®¢æˆ·ç«¯éƒ½æ— æ³•è¿æ¥ä¸Šé›†ç¾¤ã€‚ç­‰åˆ°é›†ç¾¤å†æ¬¡å¯åŠ¨ï¼Œè¿™äº›å®¢æˆ·ç«¯å°±èƒ½å¤Ÿè‡ªåŠ¨è¿æ¥ä¸Šâ€”â€”æ³¨æ„ï¼Œæ•´ä½“å¯åŠ¨å‰å»ºç«‹èµ·çš„å®¢æˆ·ç«¯ä¼šè¯ï¼Œå¹¶ä¸ä¼šå› ä¸ºæ­¤æ¬¡æ•´ä½“é‡å¯è€Œå¤±æ•ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ•´ä½“é‡å¯æœŸé—´èŠ±è´¹çš„æ—¶é—´å°†ä¸è®¡å…¥ä¼šè¯è¶…æ—¶æ—¶é—´çš„è®¡ç®—ä¸­ã€‚ (2) é€å°é‡å¯è¿™ç§æ–¹å¼æ›´é€‚åˆç»å¤§å¤šæ•°çš„å®é™…åœºæ™¯ã€‚åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œæ¯æ¬¡ä»…ä»…é‡å¯é›†ç¾¤ä¸­çš„ä¸€å°æœºå™¨ï¼Œç„¶åé€å°å¯¹æ•´ä¸ªé›†ç¾¤ä¸­çš„æœºå™¨è¿›è¡Œé‡å¯æ“ä½œã€‚è¿™ç§æ–¹å¼å¯ä»¥åœ¨é‡å¯æœŸé—´ä¾ç„¶ä¿è¯é›†ç¾¤å¯¹å¤–çš„æ­£å¸¸æœåŠ¡ã€‚ 5. å®¢æˆ·ç«¯ä½¿ç”¨é…ç½® å®¢æˆ·ç«¯ä½¿ç”¨ Zookeeper é›†ç¾¤ï¼Œåªéœ€è¦ä¿®æ”¹ä¹‹å‰çš„Zookeeper é›†ç¾¤çš„åœ°å€å³å¯ 1zookeeper.host=127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183","link":"/p/da1f3173.html"},{"title":"Spring å­¦ä¹  [1]","text":"å›¾ç‰‡æµ‹è¯•","link":"/p/ac45747d.html"},{"title":"ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (ä¸€) Controller &amp; Router &amp; BodyParser","text":"Controllers12345678910111213141516@Singletonclass HomeController @Inject()(cc: ControllerComponents) extends AbstractController(cc) { def index() = Action { implicit request: Request[AnyContent] =&gt; Ok(views.html.index()) } def explore() = Action { implicit request: Request[AnyContent] =&gt; Ok(views.html.explore()) } def tutorial() = Action { implicit request: Request[AnyContent] =&gt; Ok(views.html.tutorial()) } } åœ¨ conf ç›®å½•ä¸‹é…ç½® routes æ–‡ä»¶ï¼Œå¯¹è¯·æ±‚url è¿›è¡Œæ˜ å°„åˆ° controllersï¼Œå’Œ springmvc çš„ @RequestMapping å¾ˆç±»ä¼¼ã€‚ 123456789# Routes# This file defines all application routes (Higher priority routes first)# https://www.playframework.com/documentation/latest/ScalaRouting# ~~~~# An example controller showing a sample home pageGET / controllers.HomeController.indexGET /explore controllers.HomeController.exploreGET /tutorial controllers.HomeController.tutorial é€šè¿‡ä¸Šè¿°é…ç½®ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ url è®¿é—®åˆ°å…·ä½“çš„ è¯·æ±‚æ–¹æ³•äº†ã€‚ Actionæ¯ä¸€ä¸ªè¯·æ±‚æ˜¯è¢«ä¸€ä¸ª Action è¿›è¡Œå¤„ç†äº†ï¼Œå¤„ç†ä¹‹åè¿”å› Results Resultså¸¸è§çš„ results 1Ok(&quot;Got request [&quot; + request + &quot;]&quot;) é‡å®šå‘åˆ°å¦ä¸€ä¸ª url å¯¹åº”çš„ Action 1Redirect(&quot;/echo&quot;) mark æ–¹æ³•è¿˜æ²¡æœ‰å®Œæˆ 1def todo() = TODO è‡ªå®šä¹‰ Result 1234Result( header = ResponseHeader(200, Map.empty), body = HttpEntity.Strict(ByteString(&quot;Hello world!&quot;), Some(&quot;text/plain&quot;))) Http Routing æ‰€æœ‰è·¯ç”±ä¿¡æ¯å°†å®šä¹‰åœ¨ conf/routes æ–‡ä»¶ä¸‹,å‰æ–‡æœ‰æåŠåˆ°ã€‚router æ˜¯è´Ÿè´£å°†æ¯ä¸ªä¼ å…¥ HTTP è¯·æ±‚è½¬æ¢ä¸º Action çš„ç»„ä»¶ã€‚ æ¯ä¸€ä¸ª Http è¯·æ±‚è¢« Play MVC Framework è®¤ä¸ºæ˜¯ä¸€ä¸ªäº‹ä»¶ã€‚æ¯ä¸ªè¯·æ±‚åŒ…å«ä¸¤æ¡ä¸»è¦ä¿¡æ¯ï¼š è¯·æ±‚è·¯å¾„ï¼Œrestful é£æ ¼ http è¯·æ±‚æ–¹æ³•ï¼Œç±»ä¼¼ Getã€Postã€Deleteã€Put ç­‰ è¯­æ³•conf/routes æ˜¯ router ä½¿ç”¨çš„é…ç½®æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åˆ—å‡ºäº†åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ routesã€‚æ¯ä¸ªè·¯ç”±ç”±ä¸€ä¸ª HTTP æ–¹æ³•å’Œ URI æ¨¡å¼ç»„æˆï¼Œå®ƒä»¬éƒ½ä¸ Action çš„è°ƒç”¨ç›¸å…³è”ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è·¯ç”±å®šä¹‰æ˜¯ä»€ä¹ˆæ ·çš„: 12GET /clients/:id controllers.Clients.show(id: Long)GET /clients/:id controllers.Clients.show(id: Long) é€šè¿‡ -&gt; æ¥ä½¿ç”¨ä¸åŒçš„è·¯ç”±è§„åˆ™ 1-&gt; /api api.MyRouter å½“ä¸å­—ç¬¦ä¸²æ’å€¼è·¯ç”±DSL(ä¹Ÿç§°ä¸ºSIRDè·¯ç”±)ç»“åˆä½¿ç”¨æ—¶ï¼Œæˆ–è€…åœ¨å¤„ç†ä½¿ç”¨å¤šä¸ªè·¯ç”±æ–‡ä»¶è·¯ç”±çš„å­é¡¹ç›®æ—¶ï¼Œè¿™ä¸€ç‚¹å°¤å…¶æœ‰ç”¨ã€‚ é€šè¿‡ nocsrf æ¥ç¦ç”¨ CSRF filter 12+ nocsrfPOST /api/new controllers.Api.newThing URLè§„åˆ™: 12345678910#é™æ€ pathGET /clients/all controllers.Clients.list()# åŠ¨æ€ pathGET /clients/:id controllers.Clients.show(id: Long)# æ­£åˆ™åŒ¹é…æ¨¡å¼GET /files/*name controllers.Application.download(name) é€†å‘ã€åè½¬ routing 1Redirect(routes.HelloController.echo()) æ“ä½œå¤„ç†ç»“æœè¿”å›ç»“æœå†…å®¹ç±»å‹è‡ªåŠ¨ä»æ‚¨æŒ‡å®šä½œä¸ºå“åº”ä½“çš„Scalaå€¼æ¨æ–­å‡ºæ¥ã€‚ é€šè¿‡ play.api.http.ContentTypeOf æ¥å®ç° 12345678910//Will automatically set the Content-Type header to text/plain, while:val textResult = Ok(&quot;Hello World!&quot;)//will set the Content-Type header to application/xml.val xmlResult = Ok(&lt;message&gt;Hello World!&lt;/message&gt;)//è‡ªå·±å®šä¹‰è¿”å›ç±»å‹val htmlResult = Ok(&lt;h1&gt;Hello World!&lt;/h1&gt;).as(&quot;text/html&quot;)val htmlResult2 = Ok(&lt;h1&gt;Hello World!&lt;/h1&gt;).as(HTML) Manipulating Http headers (æ“çºµ Http å¤´)12//æ·»åŠ è¿”å›å¤´ä¿¡æ¯val result = Ok(&quot;Hello World!&quot;).withHeaders(CACHE_CONTROL -&gt; &quot;max-age=3600&quot;,ETAG -&gt; &quot;xx&quot;) Session and Flash å­˜å‚¨åœ¨ session ä¸­çš„æ•°æ®åœ¨æ•´ä¸ªä¼šè¯æœŸé—´éƒ½æ˜¯å¯ç”¨çš„ï¼Œå­˜å‚¨åœ¨ flash ä½œç”¨åŸŸçš„æ•°æ®åªå¯¹ä¸‹ä¸€ä¸ªè¯·æ±‚å¯ç”¨ã€‚ éœ€è¦æ³¨æ„ï¼Œsession å’Œ flash çš„æ•°æ®ä¸æ˜¯ç”±æœåŠ¡å™¨å­˜å‚¨çš„ï¼Œè€Œæ˜¯ä½¿ç”¨ cookie æœºåˆ¶æ·»åŠ åˆ°æ¯ä¸ªåç»­ http è¯·æ±‚ä¸­çš„ã€‚è¿™æ„å‘³ç€æ•°æ®å¤§å°å°†éå¸¸æœ‰é™(up to 4kb),å¹¶ä¸”åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²å€¼ã€‚ cookie çš„é»˜è®¤åç§°æ˜¯ PLAY_SESSIONã€‚è¿™å¯ä»¥åœ¨ application.conf é€šè¿‡é…ç½® key play.http.session æ¥æ›´æ”¹ã€‚ Session å­˜å‚¨123456//è¿™ä¼šå°† session å®Œå…¨æ›¿æ¢æ‰Ok(&quot;Welcome!&quot;).withSession(&quot;connected&quot; -&gt; &quot;user@gmail.com&quot;)//åœ¨ç°æœ‰session åŸºç¡€ä¸Šæ·»åŠ  element å†…å®¹å³å¯Ok(&quot;Hello World!&quot;).withSession(request.session + (&quot;saidHello&quot; -&gt; &quot;yes&quot;))//é€šè¿‡key remove éƒ¨åˆ†å†…å®¹Ok(&quot;Theme reset!&quot;).withSession(request.session - &quot;theme&quot;) è¯»å– Session å†…å®¹ 1234567def index = Action { request =&gt; request.session.get(&quot;connected&quot;).map { user =&gt; Ok(&quot;Hello &quot; + user) }.getOrElse { Unauthorized(&quot;Oops, you are not connected&quot;) }} ä¸¢å¼ƒæ•´ä¸ª Session å†…å®¹ 1Ok(&quot;Bye&quot;).withNewSession Flash Scope (Flashä½œç”¨åŸŸ) flash scope å’Œ session ä½œç”¨å¾ˆåƒï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªåŒºåˆ« data are kept for only one request the Flash cookie is not signed, making it possible for the user to modify it. session çš„ cookie ä¼šè¿›è¡ŒåŠ å¯†ï¼Œè€Œ flash çš„ cookie ä¸ä¼šè¿›è¡ŒåŠ å¯†ã€‚ Flashä½œç”¨åŸŸ åº”è¯¥åªç”¨äºåœ¨ç®€å•çš„ éajax åº”ç”¨ç¨‹åºä¸Šä¼ è¾“ æˆåŠŸ/é”™è¯¯æ¶ˆæ¯ã€‚ç”±äºæ•°æ®åªæ˜¯ä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚ä¿å­˜çš„ï¼Œè€Œä¸”åœ¨å¤æ‚çš„ Web åº”ç”¨ç¨‹åºä¸­ä¸èƒ½ä¿è¯è¯·æ±‚é¡ºåºï¼Œæ‰€ä»¥ Flashä½œç”¨åŸŸ å—ç«æ€æ¡ä»¶çš„é™åˆ¶ã€‚(the Flash scope is subject to race conditions.) code using flash scope123456789def index = Action { implicit request =&gt; Ok { request.flash.get(&quot;success&quot;).getOrElse(&quot;Welcome!&quot;) }}def save = Action { Redirect(&quot;/home&quot;).flashing(&quot;success&quot; -&gt; &quot;The item has been created&quot;)} To retrieve the Flash scope value in your view, add an implicit Flash parameter è¦åœ¨è§†å›¾ä¸­æ£€ç´¢Flashä½œç”¨åŸŸå€¼ï¼Œè¯·æ·»åŠ ä¸€ä¸ªéšå¼Flashå‚æ•°: 1234@()(implicit flash: Flash)...@flash.get(&quot;success&quot;).getOrElse(&quot;Welcome!&quot;)... è¯·æ±‚ä½“è§£æ Body Parsers ä»€ä¹ˆæ˜¯ body parsers HTTPè¯·æ±‚ æ˜¯header åé¢è·Ÿç€ bodyã€‚header é€šå¸¸å¾ˆå°â€”â€”å®ƒå¯ä»¥å®‰å…¨åœ°ç¼“å†²åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤åœ¨ Play ä¸­å®ƒæ˜¯ä½¿ç”¨RequestHeader ç±»å»ºæ¨¡çš„ã€‚ ç„¶è€Œï¼Œbody å¯èƒ½éå¸¸é•¿ï¼Œå› æ­¤ä¸åœ¨å†…å­˜ä¸­ç¼“å†²ï¼Œè€Œæ˜¯å»ºæ¨¡ä¸ºæµã€‚ç„¶è€Œï¼Œè®¸å¤šè¯·æ±‚ä½“æœ‰æ•ˆè´Ÿè½½ (payloads) éƒ½å¾ˆå°ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å†…å­˜ä¸­å»ºæ¨¡ï¼Œå› æ­¤ä¸ºäº†å°† bodyæµ æ˜ å°„åˆ°å†…å­˜ä¸­çš„å¯¹è±¡ï¼ŒPlay æä¾›äº†ä¸€ä¸ªBodyParser æŠ½è±¡ã€‚ ç”±äº Play æ˜¯ä¸€ä¸ªå¼‚æ­¥æ¡†æ¶ï¼Œä¼ ç»Ÿçš„ InputStream ä¸èƒ½ç”¨äºè¯»å–è¯·æ±‚ä½“â€”â€”è¾“å…¥æµé˜»å¡äº†ï¼Œå½“æ‚¨è°ƒç”¨ read æ—¶ï¼Œè°ƒç”¨å®ƒçš„çº¿ç¨‹å¿…é¡»ç­‰å¾…æ•°æ®å¯ç”¨ã€‚ ç›¸åï¼ŒPlay ä½¿ç”¨ä¸€ä¸ªåä¸º Akka Streams çš„å¼‚æ­¥æµåº“ã€‚Akka Streams æ˜¯ Reactive Streams çš„ä¸€ä¸ªå®ç°ã€‚ å…è®¸è®¸å¤šå¼‚æ­¥æµapi æ— ç¼åœ°ååŒå·¥ä½œ,æ‰€ä»¥å°½ç®¡ä¼ ç»Ÿ InputStream çš„åŸºç¡€æŠ€æœ¯ä¸é€‚åˆä½¿ç”¨, ä½†æ˜¯Akka Streams å’Œ Reactive Streams çš„æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿçš„å¼‚æ­¥åº“å°†ä¸ºä½ æä¾›ä½ éœ€è¦çš„ä¸€åˆ‡ã€‚ ä½¿ç”¨ Body Parsers å¦‚æœæ²¡æœ‰æ˜¾å¼é€‰æ‹© body parserï¼ŒPlay å°†ä½¿ç”¨çš„ç¼ºçœçš„ body parser å°†æŸ¥çœ‹ä¼ å…¥çš„ Content-Typeï¼Œå¹¶ç›¸åº”åœ°è§£æbodyã€‚ ä¾‹å¦‚ï¼Œç±»å‹ application/json çš„å†…å®¹ç±»å‹å°†è¢«è§£æä¸º JsValueï¼Œè€Œç±»å‹ application/x-www-form- urlencoding çš„å†…å®¹ç±»å‹å°†è¢«è§£æä¸º Map[String, Seq[String]] é»˜è®¤çš„ Body Parser ç”Ÿæˆ AnyContent ç±»å‹çš„ Bodyã€‚AnyContent æ”¯æŒçš„å„ç§ç±»å‹, å¯ä»¥é€šè¿‡ asæ–¹æ³• è®¿é—®ï¼Œä¾‹å¦‚ asJsonï¼Œå®ƒè¿”å›ä¸€ä¸ª Option[bodyç±»å‹] 1234567891011def save = Action { request: Request[AnyContent] =&gt; val body: AnyContent = request.body val jsonBody: Option[JsValue] = body.asJson // Expecting json body jsonBody.map { json =&gt; Ok(&quot;Got: &quot; + (json \\ &quot;name&quot;).as[String]) }.getOrElse { BadRequest(&quot;Expecting application/json request body&quot;) }} ä¸‹é¢æ˜¯é»˜è®¤ body parser æ”¯æŒçš„ç±»å‹æ˜ å°„ (The following is a mapping of types supported by the default body parser) text/plain: String, accessible via asText. application/json: JsValue, accessible via asJson. application/xml, text/xml or application/XXX+xml: scala.xml.NodeSeq, accessible via asXml. application/x-www-form-urlencoded: Map[String, Seq[String]], accessible via asFormUrlEncoded. multipart/form-data: MultipartFormData, accessible via asMultipartFormData. Any other content type: RawBuffer, accessible via asRaw. é»˜è®¤çš„ body parser åœ¨è§£æä¹‹å‰ä¼š try to determine è¯·æ±‚æ˜¯å¦å…·æœ‰ bodyã€‚ æ ¹æ® HTTP è§„èŒƒ(spec)ï¼Œå†…å®¹é•¿åº¦(Content-Length) æˆ– ä¼ è¾“ç¼–ç æ ‡å¤´(Transfer-Encoding) çš„å‡ºç°éƒ½è¡¨ç¤ºä¸»ä½“çš„å­˜åœ¨ï¼Œå› æ­¤è§£æå™¨åªåœ¨å‡ºç°å…¶ä¸­ä¸€ä¸ªæ ‡å¤´æ—¶è¿›è¡Œè§£æï¼Œæˆ–è€…åœ¨æ˜¾å¼è®¾ç½®éç©ºä¸»ä½“æ—¶åœ¨ FakeRequest ä¸Šè¿›è¡Œè§£æã€‚ å¦‚æœå¸Œæœ›åœ¨æ‰€æœ‰æƒ…å†µä¸‹è§£æä¸»ä½“ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢æè¿°çš„anyContentä¸»ä½“è§£æå™¨ã€‚ æ˜¾ç¤ºçš„é€‰æ‹©ä¸€ä¸ª Body Parserå¦‚æœå¸Œæœ›æ˜¾å¼åœ°é€‰æ‹©ä¸»ä½“è§£æå™¨ï¼Œå¯ä»¥å°† body parser ä¼ é€’ç»™ Action çš„ applyæˆ– async æ–¹æ³•ã€‚ Play æä¾›äº†è®¸å¤šå¼€ç®±å³ç”¨çš„ body parser (Play provides a number of body parsers out of the box)ï¼Œ è¿™æ˜¯é€šè¿‡ PlayBodyParsers trait æä¾›çš„ï¼Œå®ƒå¯ä»¥æ³¨å…¥åˆ°æ‚¨çš„æ§åˆ¶å™¨ä¸­ã€‚ ä¾‹å­ï¼Œå¦‚æœè¦å®šä¹‰ä¸€ä¸ª request body æœŸæœ›æ˜¯ Json Body çš„ Action 1234//å¦‚æœä¸æ˜¯ Jsonç±»å‹ä¼šè¿”å› 415 Unsupported Media Type , ç±»ä¼¼ Springmvc åœ¨å‚æ•°å‰é¢åŠ  @RequestBodydef save = Action(parse.json) { request: Request[JsValue] =&gt; Ok(&quot;Got: &quot; + (request.body \\ &quot;name&quot;).as[String])} æ³¨æ„ï¼Œä¸Šè¿° body çš„ç±»å‹ä¸º JsValue, å®ƒä¸æ˜¯ Option ç±»å‹çš„äº†ã€‚åŸå› æ˜¯ json body parser ä¼šéªŒè¯è¯·æ±‚æ˜¯å¦å…·æœ‰ application/json çš„ Content-Typeï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¼šè¿”å› 415 çš„é”™è¯¯ï¼Œå³ 415 Unsupported Media Type,è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å†æ¬¡æ£€æŸ¥äº†ã€‚ è¿™æ ·ä¾èµ–ï¼Œè¿™ä¸ªæ–¹æ³•å°†è¦å¯¹è¯·æ±‚çš„type æœ‰ä¸¥æ ¼çš„é™åˆ¶äº†ï¼Œå®¢æˆ·ç«¯è¦æ¸…æ¥šè¿™ä¸€ç‚¹ã€‚å¦‚æœå¸Œæœ›æœ‰æ›´å®½æ¾çš„åšæ³•ï¼Œå³ä¸æ˜¯ ``application/jsonç±»å‹çš„Content-Type` ä¹Ÿèƒ½å¤Ÿè¿›è¡Œè§£æï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š 1234//ä¸ä¼šè¿”å› 415ï¼Œä¼šå°è¯•è¿›è¡Œè§£ædef save = Action(parse.tolerantJson) { request: Request[JsValue] =&gt; Ok(&quot;Got: &quot; + (request.body \\ &quot;name&quot;).as[String])} å¦ä¸€ä¸ªä¾‹å­ï¼Œä¿å­˜æ–‡ä»¶ 123def save = Action(parse.file(to = new File(&quot;/tmp/upload&quot;))) { request: Request[File] =&gt; Ok(&quot;Saved the request content to &quot; + request.body)} ç»„åˆ Body Parsers (Combining body parsers)åœ¨ä¸Šä¸€ä¸ªä¿å­˜æ–‡ä»¶çš„ç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰è¯·æ±‚ bodies éƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ (/tmp/upload)ï¼Œè¿™æ˜¯å­˜åœ¨é—®é¢˜çš„ã€‚ æˆ‘ä»¬å¯ä»¥ç¼–å†™å¦ä¸€ä¸ªè‡ªå®šä¹‰ä¸»ä½“è§£æå™¨ï¼Œå®ƒä»è¯·æ±‚ä¼šè¯ä¸­æå–ç”¨æˆ·åï¼Œä¸ºæ¯ä¸ªç”¨æˆ·æä¾›ä¸€ä¸ªæƒŸä¸€çš„æ–‡ä»¶ 1234567891011val storeInUserFile: BodyParser[File] = parse.using { request =&gt; request.session.get(&quot;username&quot;).map { user =&gt; parse.file(to = new File(&quot;/tmp/&quot; + user + &quot;.upload&quot;)) }.getOrElse { sys.error(&quot;You don't have the right to upload here&quot;) }}//è‡ªå®šä¹‰ body parserdef save: Action[File] = Action(storeInUserFile) { request =&gt; Ok(&quot;Saved the request content to &quot; + request.body)} ä¸Šé¢æˆ‘ä»¬å¹¶æ²¡æœ‰çœŸæ­£ç¼–å†™è‡ªå·±çš„ BodyParserï¼Œè€Œåªæ˜¯ç»„åˆç°æœ‰çš„ BodyParserã€‚è¿™é€šå¸¸å°±è¶³å¤Ÿäº†ï¼Œåº”è¯¥æ¶µç›–å¤§å¤šæ•°ç”¨ä¾‹ã€‚é«˜çº§ä¸»é¢˜éƒ¨åˆ†å°†ä»‹ç»ä»å¤´ç¼–å†™ BodyParser Max content lengthåŸºäºæ–‡æœ¬çš„ body parsers (ä¾‹å¦‚ textã€jsonã€xml æˆ– formurlencoding) éœ€è¦æœ‰ä¸€ä¸ªæœ€å¤§å†…å®¹é•¿åº¦ã€‚å› ä¸ºå®ƒä»¬å¿…é¡»å°†æ‰€æœ‰å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬å°†è§£æçš„æœ€å¤§å†…å®¹é•¿åº¦æ˜¯ 100KBã€‚å¯ä»¥é€šè¿‡æŒ‡å®š play.http.parser æ¥è¦†ç›–å®ƒã€‚å¯ä»¥é€šè¿‡åœ¨ application.conf æŒ‡å®š maxMemoryBufferå±æ€§æ¥æ”¹å˜è¿™ä¸ªå¤§å°ã€‚ 12# application.confplay.http.parser.maxMemoryBuffer=128K å¯¹äºå°†å†…å®¹ç¼“å†² (buffer) åˆ°ç£ç›˜ä¸Šçš„ body parserï¼Œä¾‹å¦‚ raw parser æˆ– multipart/form-data ç­‰ï¼Œå®ƒä»¬çš„æœ€å¤§å†…å®¹é•¿åº¦ä½¿ç”¨ play.http.parser çš„ maxDiskBuffer æ¥è¿›è¡ŒæŒ‡å®šã€‚ maxDiskBufferå±æ€§ï¼Œé»˜è®¤å€¼ä¸º10MBã€‚multipart/form-data è§£æå™¨è¿˜å¼ºåˆ¶ä¸ºæ•°æ®å­—æ®µçš„èšåˆè®¾ç½®æ–‡æœ¬æœ€å¤§é•¿åº¦å±æ€§ã€‚ æ‚¨è¿˜å¯ä»¥é€šè¿‡åœ¨ Action ä¸­æ˜¾ç¤ºæŒ‡å®šæ¥è¦†ç›–é»˜è®¤çš„æœ€å¤§é•¿åº¦ã€‚ 1234// Accept only 10KB of data.def save = Action(parse.text(maxLength = 1024 * 10)) { request: Request[String] =&gt; Ok(&quot;Got: &quot; + text)} You can also wrap any body parser with maxLength 1234// Accept only 10KB of data.def save = Action(parse.maxLength(1024 * 10, storeInUserFile)) { request =&gt; Ok(&quot;Saved the request content to &quot; + request.body)} Writing a custom body parser æˆ‘ä»¬å¯ä»¥å®ç° BodyParser ç‰¹è´¨æ¥è‡ªå®šä¹‰ body parserï¼Œè¿™ä¸ª trait æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„å‡½æ•° 1trait BodyParser[+A] extends (RequestHeader =&gt; Accumulator[ByteString, Either[Result, A]]) æ¥æ”¶ä¸€ä¸ª RequestHeaderï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ£€æŸ¥å…³äºè¯·æ±‚çš„ä¿¡æ¯ï¼Œå®ƒé€šå¸¸ç”¨äºè·å– Content-Type,è¿™æ · body å°±ä¼šè¢«æ­£ç¡®çš„è§£æã€‚ å‡½æ•°çš„è¿”å›ç±»å‹æ˜¯ Accumulatorï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¯åŠ å™¨ã€‚Accumulator æ˜¯ å›´ç»• Akka Streams Sink çš„ä¸€å±‚è–„å±‚ã€‚Accumulator å¼‚æ­¥åœ°å°† streams of elements åŠ åˆ°ç»“æœä¸­ï¼Œå®ƒå¯ä»¥é€šè¿‡ä¼ å…¥ Akka Streams Source æ¥è¿è¡Œã€‚è¿™å°†è¿”å›ä¸€ä¸ª Futureï¼Œå¹¶ä¸”åœ¨ç´¯åŠ å™¨å®Œæˆæ—¶ï¼Œfuture å¾—åˆ°å®Œæˆã€‚ Accumulator æœ¬è´¨ä¸Šå’Œ Sink[E,Future[A]] ä¸€æ ·ï¼Œäº‹å®ä¸Šï¼ŒAccumulator æ˜¯ Sink çš„ä¸€ä¸ªåŒ…è£…å™¨ã€‚ä½†æ˜¯æœ€å¤§çš„åŒºåˆ«æ˜¯ Accumulator æä¾›äº†æ–¹ä¾¿çš„æ–¹æ³•ï¼Œæ¯”å¦‚ mapã€mapFutureã€recover ç­‰ç­‰ã€‚ Accumulator ç”¨äºå°†ç»“æœä½œä¸ºä¸€ä¸ª promise æ¥å¤„ç†ï¼Œå…¶ä¸­ Sink è¦æ±‚å°†æ‰€æœ‰çš„æ“ä½œåŒ…è£…åœ¨ mapMaterializedValue çš„è°ƒç”¨ä¸­ã€‚ Accumulator çš„ apply è¿”å› ByteString ç±»å‹çš„å…ƒç´ ï¼Œè¿™äº›å…ƒç´ æœ¬è´¨ä¸Šæ˜¯å­—èŠ‚æ•°ç»„ï¼Œä½†ä¸ byte[] ä¸åŒçš„æ˜¯ï¼ŒByteString æ˜¯ä¸å¯å˜çš„ï¼Œå®ƒçš„è®¸å¤šæ“ä½œ(å¦‚ slicing æˆ–è€… appending) éƒ½æ˜¯åœ¨å›ºå®šçš„æ—¶é—´å†…å®Œæˆçš„ã€‚ Accumulator çš„è¿”å›ç±»å‹æ˜¯ Either[Result, A]ï¼Œå®ƒè¦ä¹ˆè¿”å›ä¸€ä¸ª Resultï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªç±»å‹ Aã€‚é€šå¸¸åœ¨å‘ç”Ÿé”™è¯¯çš„æƒ…å†µä¸‹è¿”å› Resultã€‚ä¾‹å¦‚ï¼Œå¦‚æœ body è§£æå¤±è´¥ï¼Œæ¯”å¦‚ Content-Type ä¸ Body Parser æ¥å—çš„ç±»å‹ä¸åŒ¹é…ï¼Œæˆ–è€…å†…å­˜ç¼“å†²åŒºæº¢å‡ºäº†ã€‚å½“ body parser è¿”å›ä¸€ä¸ª result æ—¶ï¼Œè¿™å°†ç¼©çŸ­ action çš„å¤„ç†æ—¶é—´ï¼Œaction çš„ç»“æœå°†é‡Œè„Šè¿”å›ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šè°ƒç”¨è¯¥æ“ä½œã€‚ å°† Body å¼•å‘åˆ«å¤„ Directing the body elsewhere ç¼–å†™ body parser çš„ä¸€ä¸ªå¸¸è§ç”¨ä¾‹æ˜¯ï¼Œå½“æ‚¨å®é™…ä¸Šä¸æƒ³è§£æä¸»ä½“æ—¶ï¼Œè€Œæ˜¯æƒ³å°†å®ƒä»¥æµçš„å½¢å¼å¼•å…¥åˆ°å…¶ä»–åœ°æ–¹(stream it elsewhere)ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰ body parser 12345678910111213141516171819202122import javax.inject._import play.api.mvc._import play.api.libs.streams._import play.api.libs.ws._import scala.concurrent.ExecutionContextimport akka.util.ByteStringclass MyController @Inject() (ws: WSClient, val controllerComponents: ControllerComponents)(implicit ec: ExecutionContext) extends BaseController { def forward(request: WSRequest): BodyParser[WSResponse] = BodyParser { req =&gt; Accumulator.source[ByteString].mapFuture { source =&gt; request .withBody(source) .execute() .map(Right.apply) } } def myAction = Action(forward(ws.url(&quot;https://example.com&quot;))) { req =&gt; Ok(&quot;Uploaded&quot;) }} ä½¿ç”¨ Akka Streams è¿›è¡Œè‡ªå®šä¹‰çš„è§£æ Custom parsing using Akka Streams åœ¨å¾ˆå°‘çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ Akka Streams ç¼–å†™è‡ªå®šä¹‰è§£æå™¨ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå…ˆç”¨ ByteString ç¼“å†² body å°±è¶³å¤Ÿäº†ï¼Œè¿™é€šå¸¸æä¾›ä¸€ç§ç®€å•å¾—å¤šçš„è§£ææ–¹æ³•ï¼Œå› ä¸ºæ‚¨å¯ä»¥å¯¹ä¸»ä½“ä½¿ç”¨å¼ºåˆ¶æ–¹æ³•å’Œéšæœºè®¿é—®ã€‚ ä½†æ˜¯ï¼Œå½“è¿™ä¸å¯è¡Œæ—¶ï¼Œä¾‹å¦‚éœ€è¦è§£æçš„ä¸»ä½“å¤ªé•¿è€Œæ— æ³•è£…å…¥å†…å­˜æ—¶ï¼Œåˆ™å¯èƒ½éœ€è¦ç¼–å†™è‡ªå®šä¹‰ä¸»ä½“è§£æå™¨ã€‚ å…³äºå¦‚ä½•ä½¿ç”¨ Akka Streams çš„å®Œæ•´æè¿°è¶…å‡ºäº†æœ¬æ–‡æ¡£çš„èŒƒå›´â€”â€”æœ€å¥½ä»é˜…è¯» Akka Streams æ–‡æ¡£å¼€å§‹ã€‚ä½†æ˜¯ï¼Œä¸‹é¢æ˜¾ç¤ºäº†ä¸€ä¸ª CSV è§£æå™¨ï¼Œå®ƒåŸºäºAkka Streams çƒ¹é¥ªä¹¦ä¸­ ByteStrings æ–‡æ¡£æµçš„è§£æè¡Œã€‚ 12345678910111213141516171819import play.api.mvc.BodyParserimport play.api.libs.streams._import akka.util.ByteStringimport akka.stream.scaladsl._val csv: BodyParser[Seq[Seq[String]]] = BodyParser { req =&gt; // A flow that splits the stream into CSV lines val sink: Sink[ByteString, Future[Seq[Seq[String]]]] = Flow[ByteString] //æˆ‘ä»¬æŒ‰ç…§ new line character è¿›è¡Œåˆ†å‰²ï¼Œæ¯è¡Œæœ€å¤šå…è®¸ 1000ä¸ªå­—ç¬¦ã€‚ .via(Framing.delimiter(ByteString(&quot;\\n&quot;), 1000, allowTruncation = true)) //æŠŠæ¯ä¸€è¡Œå˜æˆä¸€ä¸ªStringï¼Œç”¨é€—å·åˆ†éš” .map(_.utf8String.trim.split(&quot;,&quot;).toSeq) // ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ fold å°†å…¶å˜ä¸ºä¸€ä¸ªåˆ—è¡¨ List .toMat(Sink.fold(Seq.empty[Seq[String]])(_ :+ _))(Keep.right) // å°† body è½¬ä¸ºä¸º Either right è¿”å› Accumulator(sink).map(Right.apply)}","link":"/p/468029a2.html"},{"title":"ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (äº”) Dependency Injection","text":"ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œæœ‰åŠ©äºå°†ç»„ä»¶çš„è¡Œä¸ºä¸ä¾èµ–æ€§è§£æåˆ†å¼€ã€‚Playæ”¯æŒåŸºäºJSR 330ï¼ˆåœ¨æœ¬é¡µä¸­æè¿°ï¼‰çš„è¿è¡Œæ—¶ä¾èµ–æ³¨å…¥å’Œåœ¨Scalaä¸­ç¼–è¯‘æ—¶ä¾èµ–æ³¨å…¥ã€‚ä¹‹æ‰€ä»¥è°ƒç”¨è¿è¡Œæ—¶ä¾èµ–é¡¹æ³¨å…¥ï¼Œæ˜¯å› ä¸ºä¾èµ–å…³ç³»å›¾æ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºï¼Œè¿æ¥å’ŒéªŒè¯çš„ã€‚ å¦‚æœæ‰¾ä¸åˆ°ç‰¹å®šç»„ä»¶çš„ä¾èµ–é¡¹ï¼Œåˆ™åœ¨è¿è¡Œåº”ç”¨ç¨‹åºä¹‹å‰ä¸ä¼šå‡ºç°é”™è¯¯ã€‚ Playæ”¯æŒGuiceå¼€ç®±å³ç”¨ï¼Œä½†å¯ä»¥æ’å…¥å…¶ä»–JSR 330å®ç°. Guice wiki æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ„æºï¼Œå¯ä»¥æ›´å¤šåœ°äº†è§£Guiceå’ŒDIè®¾è®¡æ¨¡å¼çš„åŠŸèƒ½ã€‚ æ³¨æ„ï¼šGuiceæ˜¯ä¸€ä¸ªJavaåº“ï¼Œæœ¬æ–‡æ¡£ä¸­çš„ç¤ºä¾‹ä½¿ç”¨Guiceçš„å†…ç½®Java APIã€‚ å¦‚æœæ‚¨æ›´å–œæ¬¢Scala DSLï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨scala-guiceæˆ–sse-guiceåº“ã€‚ Motivationä¾èµ–æ³¨å…¥å®ç°äº†å‡ ä¸ªç›®æ ‡ï¼š å®ƒå…è®¸æ‚¨è½»æ¾ç»‘å®šåŒä¸€ç»„ä»¶çš„ä¸åŒå®ç°ã€‚ è¿™å¯¹äºæµ‹è¯•å°¤å…¶æœ‰ç”¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿä¾èµ–é¡¹æ‰‹åŠ¨å®ä¾‹åŒ–ç»„ä»¶æˆ–æ³¨å…¥å¤‡ç”¨å®ç°ã€‚ å®ƒå…è®¸æ‚¨é¿å…å…¨å±€é™æ€ã€‚ è™½ç„¶é™æ€å·¥å‚å¯ä»¥å®ç°ç¬¬ä¸€ä¸ªç›®æ ‡ï¼Œä½†æ‚¨å¿…é¡»å°å¿ƒç¡®ä¿æ­£ç¡®è®¾ç½®çŠ¶æ€ã€‚ ç‰¹åˆ«æ˜¯Playï¼ˆç°å·²å¼ƒç”¨ï¼‰çš„é™æ€APIéœ€è¦è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œè¿™ä½¿å¾—æµ‹è¯•çš„çµæ´»æ€§é™ä½ã€‚ å¹¶ä¸”ä¸€æ¬¡æœ‰å¤šä¸ªå®ä¾‹å¯ä»¥å¹¶è¡Œè¿è¡Œæµ‹è¯•ã€‚ Guice wiki æœ‰ä¸€äº›å¾ˆå¥½çš„ä¾‹å­å¯ä»¥æ›´è¯¦ç»†åœ°è§£é‡Šè¿™ä¸€ç‚¹ã€‚ How it worksPlay æä¾›äº†è®¸å¤šå†…ç½®ç»„ä»¶ï¼Œå¹¶åœ¨è¯¸å¦‚ BuiltinModule ä¹‹ç±»çš„æ¨¡å—ä¸­å£°æ˜å®ƒä»¬ã€‚ è¿™äº›ç»‘å®šæè¿°äº†åˆ›å»º Application å®ä¾‹æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼Œé»˜è®¤æƒ…å†µä¸‹åŒ…æ‹¬ç”± routes compiler ç”Ÿæˆçš„ routeï¼Œè¯¥ route å°†æ§åˆ¶å™¨æ³¨å…¥åˆ°æ„é€ å‡½æ•°ä¸­ã€‚ ç„¶åå¯ä»¥å°†è¿™äº›ç»‘å®šè½¬æ¢ä¸ºåœ¨ Guice å’Œå…¶ä»–è¿è¡Œæ—¶DIæ¡†æ¶ä¸­å·¥ä½œã€‚ Playå›¢é˜Ÿç»´æŠ¤Guiceæ¨¡å—ï¼Œè¯¥æ¨¡å—æä¾› GuiceApplicationLoaderã€‚ è¿™ä¸º Guice è¿›è¡Œç»‘å®šè½¬æ¢ï¼Œä½¿ç”¨è¿™äº›ç»‘å®šåˆ›å»ºGuiceæ³¨å…¥å™¨ï¼Œå¹¶ä»æ³¨å…¥å™¨è¯·æ±‚Applicationå®ä¾‹ã€‚ There are also third-party loaders that do this for other frameworks, including Scaldi and Spring. æˆ–è€…ï¼ŒPlayæä¾›äº†ä¸€ä¸ª BuiltInComponents ç‰¹æ€§ï¼Œå…è®¸æ‚¨åˆ›å»ºä¸€ä¸ªçº¯Scalaå®ç°ï¼Œåœ¨ç¼–è¯‘æ—¶å°†æ‚¨çš„åº”ç”¨ç¨‹åºè¿æ¥åœ¨ä¸€èµ·ã€‚ æˆ‘ä»¬å°†åœ¨ä¸‹é¢è¯¦ç»†ä»‹ç»å¦‚ä½•è‡ªå®šä¹‰é»˜è®¤ç»‘å®šå’Œåº”ç”¨ç¨‹åºåŠ è½½å™¨ã€‚ Declaring runtime DI dependencies å£°æ˜è¿è¡Œæ—¶DIä¾èµ–é¡¹ å¦‚æœæ‚¨æœ‰ä¸€ä¸ªç»„ä»¶ï¼ˆä¾‹å¦‚æ§åˆ¶å™¨ï¼‰ï¼Œå¹¶ä¸”å®ƒéœ€è¦ä¸€äº›å…¶ä»–ç»„ä»¶ä½œä¸ºä¾èµ–é¡¹ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ @Inject æ³¨è§£æ¥å£°æ˜å®ƒã€‚ @Inject æ³¨è§£å¯ç”¨äºå­—æ®µæˆ–æ„é€ å‡½æ•°ã€‚ æˆ‘ä»¬å»ºè®®æ‚¨åœ¨æ„é€ å‡½æ•°ä¸Šä½¿ç”¨å®ƒï¼Œä¾‹å¦‚ï¼š 123456import javax.inject._import play.api.libs.ws._class MyComponent @Inject() (ws: WSClient) { // ...} è¯·æ³¨æ„ï¼Œ@Inject æ³¨é‡Šå¿…é¡»ä½äºç±»åä¹‹åä½†åœ¨æ„é€ å‡½æ•°å‚æ•°ä¹‹å‰ï¼Œå¹¶ä¸”å¿…é¡»å…·æœ‰æ‹¬å·ã€‚ æ­¤å¤–ï¼ŒGuice ç¡®å®æä¾›äº†å…¶ä»–å‡ ç§ç±»å‹çš„æ³¨å…¥æ–¹å¼ï¼Œä½†æ„é€ å‡½æ•°æ³¨å…¥é€šå¸¸æ˜¯ Scala ä¸­æœ€æ¸…æ™°ï¼Œç®€æ´å’Œå¯æµ‹è¯•çš„ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®ä½¿ç”¨å®ƒã€‚ Guice èƒ½å¤Ÿåœ¨å…¶æ„é€ å‡½æ•°ä¸Šä½¿ç”¨ @Inject è‡ªåŠ¨å®ä¾‹åŒ–ä»»ä½•ç±»ï¼Œè€Œæ— éœ€æ˜¾å¼ç»‘å®šå®ƒã€‚æ­¤åŠŸèƒ½è¢«ç§°ä¸º just in time bindingsï¼ŒGuice æ–‡æ¡£ä¸­å¯¹æ­¤è¿›è¡Œäº†æ›´è¯¦ç»†çš„æè¿°ã€‚ å¦‚æœæ‚¨éœ€è¦æ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œï¼Œå¯ä»¥å£°æ˜è‡ªå®šä¹‰ç»‘å®šï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚ Dependency injecting controllers ä¾èµ–æ³¨å…¥æ§åˆ¶å™¨ There are two ways to make Play use dependency injected controllers. æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿ Play ä½¿ç”¨ä¾èµ–æ³¨å…¥æ§åˆ¶å™¨ã€‚ Injected routes generatoré»˜è®¤æƒ…å†µä¸‹ï¼ˆä»2.5.0å¼€å§‹ï¼‰ï¼ŒPlay å°†ç”Ÿæˆä¸€ä¸ª router ï¼Œè¯¥ router å°†å£°æ˜å®ƒæ‰€è·¯ç”±çš„æ‰€æœ‰æ§åˆ¶å™¨ä½œä¸ºä¾èµ–é¡¹ï¼Œå…è®¸æ‚¨çš„æ§åˆ¶å™¨è‡ªå·±ä¾èµ–æ³¨å…¥ã€‚ è¦ä¸“é—¨å¯ç”¨æ³¨å…¥çš„è·¯ç”±ç”Ÿæˆå™¨ï¼Œè¯·å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° build.sbt ä¸­çš„æ„å»ºè®¾ç½®ï¼š 1routesGenerator := InjectedRoutesGenerator å½“ä½¿ç”¨ injected routes generator æ—¶ï¼Œä¸ºæ“ä½œæ·»åŠ  @ ç¬¦å·å‰ç¼€å…·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œè¿™æ„å‘³ç€ä¸æ˜¯ç›´æ¥æ³¨å…¥æ§åˆ¶å™¨ï¼Œè€Œæ˜¯æ³¨å…¥æ§åˆ¶å™¨çš„æä¾›è€…ã€‚ ä¾‹å¦‚ï¼Œè¿™å…è®¸ prototype controllersï¼Œä»¥åŠç”¨äºæ‰“ç ´å¾ªç¯ä¾èµ–æ€§çš„é€‰é¡¹ã€‚ Static routes generatoræ‚¨å¯ä»¥å°†Playé…ç½®ä¸ºä½¿ç”¨ legacyï¼ˆpre 2.5.0ï¼‰é™æ€è·¯ç”±ç”Ÿæˆå™¨ï¼Œè¯¥ç”Ÿæˆå™¨å‡å®šæ‰€æœ‰æ“ä½œéƒ½æ˜¯é™æ€æ–¹æ³•ã€‚ è¦é…ç½®é¡¹ç›®ï¼Œè¯·å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° build.sbtï¼š 1routesGenerator := StaticRoutesGenerator æˆ‘ä»¬å»ºè®®å§‹ç»ˆä½¿ç”¨æ³¨å…¥çš„è·¯ç”±ç”Ÿæˆå™¨ã€‚ é™æ€è·¯ç”±ç”Ÿæˆå™¨ä¸»è¦ä½œä¸ºè¾…åŠ©è¿ç§»çš„å·¥å…·å­˜åœ¨ï¼Œå› æ­¤ç°æœ‰é¡¹ç›®ä¸å¿…ä¸€æ¬¡ä½¿æ‰€æœ‰æ§åˆ¶å™¨ä¸æ˜¯é™æ€çš„ã€‚ å¦‚æœä½¿ç”¨é™æ€è·¯ç”±ç”Ÿæˆå™¨ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨æ“ä½œå‰åŠ ä¸Š@æ¥æŒ‡ç¤ºæ“ä½œå…·æœ‰æ³¨å…¥çš„æ§åˆ¶å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 1GET /some/path @controllers.Application.index Component lifecycleä¾èµ–æ³¨å…¥ç³»ç»Ÿç®¡ç†æ³¨å…¥ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ ¹æ®éœ€è¦åˆ›å»ºå®ƒä»¬å¹¶å°†å®ƒä»¬æ³¨å…¥å…¶ä»–ç»„ä»¶ã€‚ä»¥ä¸‹æ˜¯ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„å·¥ä½œåŸç†ï¼š æ¯æ¬¡éœ€è¦ç»„ä»¶æ—¶éƒ½ä¼šåˆ›å»ºæ–°å®ä¾‹ã€‚å¦‚æœç»„ä»¶å¤šæ¬¡ä½¿ç”¨ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹å°†åˆ›å»ºç»„ä»¶çš„å¤šä¸ªå®ä¾‹ã€‚å¦‚æœæ‚¨åªéœ€è¦ç»„ä»¶çš„å•ä¸ªå®ä¾‹ï¼Œåˆ™éœ€è¦å°†å…¶æ ‡è®°ä¸ºå•ä¸ªå®ä¾‹ã€‚ å®ä¾‹åœ¨éœ€è¦æ—¶ä¼šä»¥æ‡’åŠ è½½çš„å½¢å¼åˆ›å»ºã€‚å¦‚æœç»„ä»¶ä»æœªè¢«å…¶ä»–ç»„ä»¶ä½¿ç”¨ï¼Œåˆ™æ ¹æœ¬ä¸ä¼šåˆ›å»ºå®ƒã€‚è¿™é€šå¸¸æ˜¯ä½ æƒ³è¦çš„ã€‚å¯¹äºå¤§å¤šæ•°ç»„ä»¶è€Œè¨€ï¼Œåœ¨éœ€è¦ä¹‹å‰åˆ›å»ºå®ƒä»¬æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›ç›´æ¥å¯åŠ¨ç»„ä»¶ï¼Œæˆ–è€…å³ä½¿å®ƒä»¬æœªè¢«å…¶ä»–ç»„ä»¶ä½¿ç”¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶å‘è¿œç¨‹ç³»ç»Ÿå‘é€æ¶ˆæ¯æˆ–é¢„çƒ­ç¼“å­˜ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ€¥åˆ‡ç»‘å®š (eager binding) å¼ºåˆ¶åˆ›å»ºç»„ä»¶ã€‚ é™¤äº†æ­£å¸¸çš„åƒåœ¾æ”¶é›†ä¹‹å¤–ï¼Œå®ä¾‹ä¸ä¼šè‡ªåŠ¨æ¸…ç†ã€‚å½“ç»„ä»¶ä¸å†è¢«å¼•ç”¨æ—¶ï¼Œå®ƒä»¬å°†è¢«åƒåœ¾æ”¶é›†ï¼Œä½†æ¡†æ¶å°†ä¸ä¼šæ‰§è¡Œä»»ä½•ç‰¹æ®Šæ“ä½œæ¥å…³é—­ç»„ä»¶ï¼Œä¾‹å¦‚è°ƒç”¨ close æ–¹æ³•ã€‚ä½†æ˜¯ï¼ŒPlay æä¾›äº†ä¸€ç§ç‰¹æ®Šç±»å‹çš„ç»„ä»¶ï¼Œç§°ä¸ºApplicationLifecycleï¼Œå®ƒå…è®¸æ‚¨æ³¨å†Œç»„ä»¶ä»¥åœ¨åº”ç”¨ç¨‹åºåœæ­¢æ—¶å…³é—­ã€‚ Singletonsæœ‰æ—¶ï¼Œæ‚¨å¯èƒ½æ‹¥æœ‰ä¸€ä¸ªåŒ…å«æŸäº›çŠ¶æ€çš„ç»„ä»¶ï¼Œä¾‹å¦‚ç¼“å­˜ï¼Œæˆ–è€…ä¸å¤–éƒ¨èµ„æºçš„è¿æ¥ï¼Œæˆ–è€…åˆ›å»ºç»„ä»¶å¯èƒ½å¾ˆæ˜‚è´µã€‚ åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œè¯¥ç»„ä»¶åº”è¯¥æ˜¯å•ä¾‹çš„ã€‚ è¿™å¯ä»¥ä½¿ç”¨ @Singleton æ³¨è§£æ¥å®ç°ï¼š 123456789import javax.inject._@Singletonclass CurrentSharePrice { @volatile private var price = 0 def set(p: Int) = price = p def get = price} Stopping/cleaning upPlay å…³é—­æ—¶å¯èƒ½éœ€è¦æ¸…ç†æŸäº›ç»„ä»¶ï¼Œä¾‹å¦‚ï¼Œåœæ­¢çº¿ç¨‹æ± ã€‚ Playæä¾›äº†ä¸€ä¸ª ApplicationLifecycle ç»„ä»¶ï¼Œå¯ç”¨äºåœ¨ Play å…³é—­æ—¶æ³¨å†ŒæŒ‚é’©ä»¥åœæ­¢ç»„ä»¶ 12345678910111213import scala.concurrent.Futureimport javax.inject._import play.api.inject.ApplicationLifecycle@Singletonclass MessageQueueConnection @Inject() (lifecycle: ApplicationLifecycle) { val connection = connectToMessageQueue() lifecycle.addStopHook { () =&gt; Future.successful(connection.stop()) } //...} ApplicationLifecycle å°†åœ¨åˆ›å»ºæ—¶ä»¥ç›¸åçš„é¡ºåºåœæ­¢æ‰€æœ‰ç»„ä»¶ã€‚ è¿™æ„å‘³ç€æ‚¨ä¾èµ–çš„ä»»ä½•ç»„ä»¶ä»ç„¶å¯ä»¥å®‰å…¨åœ°ç”¨åœ¨ç»„ä»¶çš„åœæ­¢é’©å­ä¸Šã€‚ å› ä¸ºæ‚¨ä¾èµ–å®ƒä»¬ï¼Œæ‰€ä»¥å®ƒä»¬å¿…é¡»åœ¨ç»„ä»¶ä¹‹å‰åˆ›å»ºï¼Œå› æ­¤åœ¨ç»„ä»¶åœæ­¢ä¹‹å‰ä¸ä¼šåœæ­¢ã€‚ æ³¨æ„ï¼šç¡®ä¿æ³¨å†Œ stop hook çš„æ‰€æœ‰ç»„ä»¶éƒ½æ˜¯å•ä¾‹éå¸¸é‡è¦ã€‚ æ³¨å†Œ stop é’©å­çš„ä»»ä½•éå•ä¾‹ç»„ä»¶éƒ½å¯èƒ½æ˜¯å†…å­˜æ³„æ¼çš„æ¥æºï¼Œå› ä¸ºæ¯æ¬¡åˆ›å»ºç»„ä»¶æ—¶éƒ½ä¼šæ³¨å†Œä¸€ä¸ªæ–°çš„é’©å­ã€‚ Providing custom bindings æä¾›è‡ªå®šä¹‰ç»‘å®š ä¸ºç»„ä»¶å®šä¹‰ trait è¢«è®¤ä¸ºæ˜¯ä¸€ç§å¥½ä¹ æƒ¯ï¼Œå¹¶ä¸”å…¶ä»–ç±»ä¾èµ–äºè¯¥ traitï¼Œè€Œä¸æ˜¯ç»„ä»¶çš„å®ç°ã€‚ é€šè¿‡è¿™æ ·åšï¼Œæ‚¨å¯ä»¥æ³¨å…¥ä¸åŒçš„å®ç°ï¼Œä¾‹å¦‚ï¼Œåœ¨æµ‹è¯•åº”ç”¨ç¨‹åºæ—¶æ³¨å…¥æ¨¡æ‹Ÿå®ç°ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒDIç³»ç»Ÿéœ€è¦çŸ¥é“å“ªä¸ªå®ç°åº”è¯¥ç»‘å®šåˆ°è¯¥ traitã€‚ æˆ‘ä»¬å»ºè®®æ‚¨å£°æ˜è¿™ä¸€ç‚¹çš„æ–¹å¼å–å†³äºæ‚¨æ˜¯å°† Play åº”ç”¨ç¨‹åºç¼–å†™ä¸º Play çš„æœ€ç»ˆç”¨æˆ·ï¼Œè¿˜æ˜¯ç¼–å†™å…¶ä»– Play åº”ç”¨ç¨‹åºå°†ä½¿ç”¨çš„åº“ã€‚ Play applicationsæˆ‘ä»¬å»ºè®® Play åº”ç”¨ç¨‹åºä½¿ç”¨åº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨çš„ DI æ¡†æ¶æä¾›çš„ä»»ä½•æœºåˆ¶ã€‚ å°½ç®¡Playç¡®å®æä¾›äº†ç»‘å®šAPIï¼Œä½†æ­¤APIæœ‰äº›é™åˆ¶ï¼Œå¹¶ä¸”ä¸å…è®¸æ‚¨å……åˆ†åˆ©ç”¨æ‚¨æ­£åœ¨ä½¿ç”¨çš„æ¡†æ¶çš„å¼ºå¤§åŠŸèƒ½ã€‚ ç”±äºPlayä¸ºGuiceæä¾›äº†å¼€ç®±å³ç”¨çš„æ”¯æŒï¼Œä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ä¸º Guice æä¾›ç»‘å®šã€‚ Binding annotationså°†å®ç°ç»‘å®šåˆ°æ¥å£çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ Guice @ImplementedBy æ³¨é‡Šã€‚ ä¾‹å¦‚ï¼š 12345678910import com.google.inject.ImplementedBy@ImplementedBy(classOf[EnglishHello])trait Hello { def sayHello(name: String): String}class EnglishHello extends Hello { def sayHello(name: String) = &quot;Hello &quot; + name} Programmatic bindingsåœ¨ä¸€äº›æ›´å¤æ‚çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›æä¾›æ›´å¤æ‚çš„ç»‘å®šï¼Œä¾‹å¦‚å½“æ‚¨æœ‰ä¸€ä¸ª trait çš„å¤šä¸ªå®ç°æ—¶ï¼Œè¿™äº› trait ç”± @Named æ³¨é‡Šé™å®šã€‚ åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å®ç°è‡ªå®šä¹‰ Guice æ¨¡å— 123456789101112131415import com.google.inject.AbstractModuleimport com.google.inject.name.Namesclass Module extends AbstractModule { def configure() = { bind(classOf[Hello]) .annotatedWith(Names.named(&quot;en&quot;)) .to(classOf[EnglishHello]) bind(classOf[Hello]) .annotatedWith(Names.named(&quot;de&quot;)) .to(classOf[GermanHello]) }} å¦‚æœæ‚¨å°†æ­¤æ¨¡å—ç§°ä¸º Module å¹¶å°†å…¶æ”¾åœ¨æ ¹åŒ…ä¸­ï¼Œå®ƒå°†è‡ªåŠ¨æ³¨å†Œåˆ° Playã€‚ æˆ–è€…ï¼Œå¦‚æœè¦ä¸ºå…¶æŒ‡å®šä¸åŒçš„åç§°æˆ–å°†å…¶æ”¾åœ¨ä¸åŒçš„åŒ…ä¸­ï¼Œå¯ä»¥é€šè¿‡å°†å…¶å…¨é™å®šåé™„åŠ åˆ° application.conf ä¸­çš„ play.modules.enabled åˆ—è¡¨æ¥å°†å…¶æ³¨å†Œåˆ° Play 1play.modules.enabled += &quot;modules.HelloModule&quot; æ‚¨è¿˜å¯ä»¥é€šè¿‡å°†ä»¥ä¸‹æ¨¡å—æ·»åŠ åˆ°å·²ç¦ç”¨çš„æ¨¡å—æ¥ç¦ç”¨æ ¹è½¯ä»¶åŒ…ä¸­åä¸º Module çš„æ¨¡å—çš„è‡ªåŠ¨æ³¨å†Œ 1play.modules.disabled += &quot;Module&quot; Configurable bindings å¯é…ç½®çš„ç»‘å®š æœ‰æ—¶æ‚¨å¯èƒ½å¸Œæœ›åœ¨é…ç½® Guice ç»‘å®šæ—¶è¯»å– Play Configuration æˆ–ä½¿ç”¨ ClassLoaderã€‚ æ‚¨å¯ä»¥é€šè¿‡å°†è¿™äº›å¯¹è±¡æ·»åŠ åˆ°æ¨¡å—çš„æ„é€ å‡½æ•°æ¥è®¿é—®è¿™äº›å¯¹è±¡ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä»é…ç½®æ–‡ä»¶ä¸­è¯»å–æ¯ç§è¯­è¨€çš„ Hello ç»‘å®šã€‚ è¿™å…è®¸é€šè¿‡åœ¨ application.conf æ–‡ä»¶ä¸­æ·»åŠ æ–°è®¾ç½®æ¥æ·»åŠ æ–°çš„ Hello ç»‘å®šã€‚ 123456789101112131415161718192021222324252627import com.google.inject.AbstractModuleimport com.google.inject.name.Namesimport play.api.{ Configuration, Environment }class Module(environment: Environment,configuration: Configuration) extends AbstractModule { def configure() = { // Expect configuration like: // hello.en = &quot;myapp.EnglishHello&quot; // hello.de = &quot;myapp.GermanHello&quot; val helloConfiguration: Configuration = configuration.getOptional[Configuration](&quot;hello&quot;).getOrElse(Configuration.empty) val languages: Set[String] = helloConfiguration.subKeys // Iterate through all the languages and bind the // class associated with that language. Use Play's // ClassLoader to load the classes. for (l &lt;- languages) { val bindingClassName: String = helloConfiguration.get[String](l) val bindingClass: Class[_ &lt;: Hello] = environment.classLoader.loadClass(bindingClassName) .asSubclass(classOf[Hello]) bind(classOf[Hello]) .annotatedWith(Names.named(l)) .to(bindingClass) } }} æ³¨æ„ï¼šåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœåœ¨åˆ›å»ºç»„ä»¶æ—¶éœ€è¦è®¿é—® Configurationï¼Œåˆ™åº”å°† Configuration å¯¹è±¡æ³¨å…¥ç»„ä»¶æœ¬èº«æˆ–ç»„ä»¶çš„ Provider ä¸­ã€‚ ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨åˆ›å»ºç»„ä»¶æ—¶è¯»å–â€œé…ç½®â€ã€‚ åœ¨ä¸ºç»„ä»¶åˆ›å»ºç»‘å®šæ—¶ï¼Œé€šå¸¸ä¸éœ€è¦è¯»å–Configurationã€‚ Eager bindings æå‰ç»‘å®š åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ¯æ¬¡ä½¿ç”¨æ—¶éƒ½ä¼šåˆ›å»ºæ–°çš„ EnglishHello å’Œ GermanHello å¯¹è±¡ã€‚ å¦‚æœæ‚¨åªæƒ³åˆ›å»ºä¸€æ¬¡è¿™äº›å¯¹è±¡ï¼Œå¯èƒ½å› ä¸ºåˆ›å»ºå®ƒä»¬å¾ˆæ˜‚è´µï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥ä½¿ç”¨ @Singleton æ³¨é‡Šã€‚ å¦‚æœä½ æƒ³åˆ›å»ºå®ƒä»¬ä¸€æ¬¡å¹¶åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æ€¥åˆ‡åœ°åˆ›å»ºå®ƒä»¬ï¼Œè€Œä¸æ˜¯åœ¨éœ€è¦å®ƒä»¬æ‡’åŠ è½½ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥ä½¿ç”¨ Guiceâ€™s eager singleton binding 1234567891011121314151617import com.google.inject.AbstractModuleimport com.google.inject.name.Names// A Module is needed to register bindingsclass Module extends AbstractModule { override def configure() = { // Bind the `Hello` interface to the `EnglishHello` implementation as eager singleton. bind(classOf[Hello]) .annotatedWith(Names.named(&quot;en&quot;)) .to(classOf[EnglishHello]).asEagerSingleton() bind(classOf[Hello]) .annotatedWith(Names.named(&quot;de&quot;)) .to(classOf[GermanHello]).asEagerSingleton() }} å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Eager å•ä¾‹æ¥å¯åŠ¨æœåŠ¡ã€‚ å®ƒä»¬é€šå¸¸ä¸å…³é—­é’©å­ç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥ä¾¿æœåŠ¡å¯ä»¥åœ¨åº”ç”¨ç¨‹åºåœæ­¢æ—¶æ¸…ç†å…¶èµ„æºã€‚ 12345678910111213import scala.concurrent.Futureimport javax.inject._import play.api.inject.ApplicationLifecycle// This creates an `ApplicationStart` object once at start-up and registers hook for shut-down.@Singletonclass ApplicationStart @Inject() (lifecycle: ApplicationLifecycle) { // Shut-down hook lifecycle.addStopHook { () =&gt; Future.successful(()) } //...} 1234567import com.google.inject.AbstractModuleclass StartModule extends AbstractModule { override def configure() = { bind(classOf[ApplicationStart]).asEagerSingleton() }} Play librarieså¦‚æœæ‚¨æ­£åœ¨ä¸ºPlayå®ç°ä¸€ä¸ªåº“ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½å¸Œæœ›å®ƒä¸DIæ¡†æ¶æ— å…³ï¼Œè¿™æ ·æ— è®ºåœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å“ªä¸ªDIæ¡†æ¶ï¼Œæ‚¨çš„åº“éƒ½å¯ä»¥å¼€ç®±å³ç”¨ã€‚ å‡ºäºè¿™ä¸ªåŸå› ï¼ŒPlayæä¾›äº†ä¸€ä¸ªè½»é‡çº§ç»‘å®šAPIï¼Œç”¨äºä»¥DIæ¡†æ¶æ— å…³çš„æ–¹å¼æä¾›ç»‘å®šã€‚ è¦æä¾›ç»‘å®šï¼Œè¯·å®ç°Moduleä»¥è¿”å›è¦æä¾›çš„ç»‘å®šåºåˆ—ã€‚ Module traitè¿˜æä¾›ç”¨äºæ„å»ºç»‘å®šçš„DSLï¼š 123456789import play.api.inject._class HelloModule extends Module { def bindings(environment: Environment, configuration: Configuration) = Seq( bind[Hello].qualifiedWith(&quot;en&quot;).to[EnglishHello], bind[Hello].qualifiedWith(&quot;de&quot;).to[GermanHello] )} é€šè¿‡å°†è¯¥æ¨¡å—é™„åŠ åˆ°reference.confä¸­çš„play.modules.enabledåˆ—è¡¨ï¼Œå¯ä»¥è‡ªåŠ¨æ³¨å†Œè¯¥æ¨¡å—ï¼š 1play.modules.enabled += &quot;com.example.HelloModule&quot; Module bindingsæ–¹æ³•é‡‡ç”¨Playç¯å¢ƒå’Œé…ç½®ã€‚ å¦‚æœè¦åŠ¨æ€é…ç½®ç»‘å®šï¼Œå¯ä»¥è®¿é—®è¿™äº›ã€‚æ¨¡å—ç»‘å®šæ”¯æŒæ€¥åˆ‡ç»‘å®šã€‚ è¦å£°æ˜ä¸€ä¸ªæ€¥åˆ‡ç»‘å®šï¼Œè¯·åœ¨ç»‘å®šç»“æŸæ—¶æ·»åŠ .eagerlyã€‚ ä¸ºäº†æœ€å¤§åŒ–è·¨æ¡†æ¶å…¼å®¹æ€§ï¼Œè¯·è®°ä½ä»¥ä¸‹äº‹é¡¹ï¼š å¹¶éæ‰€æœ‰DIæ¡†æ¶éƒ½åªæ”¯æŒæ—¶é—´ç»‘å®šã€‚ ç¡®ä¿æ˜ç¡®ç»‘å®šåº“æä¾›çš„æ‰€æœ‰ç»„ä»¶ã€‚ å°è¯•ä¿æŒç»‘å®šé”®ç®€å• - ä¸åŒçš„è¿è¡Œæ—¶DIæ¡†æ¶å¯¹é”®æ˜¯ä»€ä¹ˆä»¥åŠå®ƒåº”è¯¥å¦‚ä½•å”¯ä¸€æˆ–ä¸å”¯ä¸€æœ‰ä¸åŒçš„çœ‹ Excluding moduleså¦‚æœæœ‰ä¸€ä¸ªæ‚¨ä¸æƒ³åŠ è½½çš„æ¨¡å—ï¼Œå¯ä»¥é€šè¿‡å°†å…¶é™„åŠ åˆ°application.confä¸­çš„play.modules.disabledå±æ€§æ¥å°†å…¶æ’é™¤ï¼š 1play.modules.disabled += &quot;play.api.db.evolutions.EvolutionsModule&quot; Managing circular dependencieså½“æ‚¨çš„æŸä¸ªç»„ä»¶ä¾èµ–äºä¾èµ–äºåŸå§‹ç»„ä»¶çš„å¦ä¸€ä¸ªç»„ä»¶ï¼ˆç›´æ¥æˆ–é—´æ¥ï¼‰æ—¶ï¼Œå°±ä¼šå‘ç”Ÿå¾ªç¯ä¾èµ–å…³ç³»ã€‚ ä¾‹å¦‚ï¼š 12345import javax.inject.Injectclass Foo @Inject() (bar: Bar)class Bar @Inject() (baz: Baz)class Baz @Inject() (foo: Foo) åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFooä¾èµ–äºBarï¼Œå®ƒå–å†³äºBazï¼Œå®ƒä¾èµ–äºFooã€‚ å› æ­¤ï¼Œæ‚¨å°†æ— æ³•å®ä¾‹åŒ–ä»»ä½•è¿™äº›ç±»ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æä¾›ç¨‹åºè§£å†³æ­¤é—®é¢˜ï¼š 12345import javax.inject.{ Inject, Provider }class Foo @Inject() (bar: Bar)class Bar @Inject() (baz: Baz)class Baz @Inject() (foo: Provider[Foo]) é€šå¸¸ï¼Œå¯ä»¥é€šè¿‡ä»¥æ›´åŸå­çš„æ–¹å¼åˆ†è§£ç»„ä»¶æˆ–æŸ¥æ‰¾è¦ä¾èµ–çš„æ›´å…·ä½“çš„ç»„ä»¶æ¥è§£å†³å¾ªç¯ä¾èµ–æ€§ã€‚ å¸¸è§é—®é¢˜æ˜¯å¯¹Applicationçš„ä¾èµ–ã€‚ å½“ä½ çš„ç»„ä»¶ä¾èµ–äºåº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒè¯´å®ƒéœ€è¦ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºæ¥å®Œæˆå®ƒçš„å·¥ä½œ; é€šå¸¸æƒ…å†µå¹¶éå¦‚æ­¤ã€‚ æ‚¨çš„ä¾èµ–é¡¹åº”è¯¥ä½äºå…·æœ‰æ‚¨éœ€è¦çš„ç‰¹å®šåŠŸèƒ½çš„æ›´å…·ä½“çš„ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼Œç¯å¢ƒï¼‰ä¸Šã€‚ ä½œä¸ºæœ€åçš„æ‰‹æ®µï¼Œæ‚¨å¯ä»¥é€šè¿‡æ³¨å…¥Provider [Application]æ¥è§£å†³é—®é¢˜ã€‚ Advanced: Extending the GuiceApplicationLoaderPlayçš„è¿è¡Œæ—¶ä¾èµ–æ³¨å…¥ç”±GuiceApplicationLoaderç±»å¼•å¯¼ã€‚ è¯¥ç±»åŠ è½½æ‰€æœ‰æ¨¡å—ï¼Œå°†æ¨¡å—æä¾›ç»™Guiceï¼Œç„¶åä½¿ç”¨Guiceåˆ›å»ºåº”ç”¨ç¨‹åºã€‚ å¦‚æœè¦æ§åˆ¶Guiceå¦‚ä½•åˆå§‹åŒ–åº”ç”¨ç¨‹åºï¼Œåˆ™å¯ä»¥æ‰©å±•GuiceApplicationLoaderç±»ã€‚ æ‚¨å¯ä»¥è¦†ç›–å‡ ç§æ–¹æ³•ï¼Œä½†é€šå¸¸éœ€è¦è¦†ç›–æ„å»ºå™¨æ–¹æ³•ã€‚ æ­¤æ–¹æ³•è¯»å–ApplicationLoader.Contextå¹¶åˆ›å»ºGuiceApplicationBuilderã€‚ æ‚¨å¯ä»¥åœ¨ä¸‹é¢çœ‹åˆ°æ„å»ºå™¨çš„æ ‡å‡†å®ç°ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§è‡ªå·±å–œæ¬¢çš„æ–¹å¼è¿›è¡Œæ›´æ”¹ã€‚ æ‚¨å¯ä»¥åœ¨æœ‰å…³ä½¿ç”¨Guiceè¿›è¡Œæµ‹è¯•çš„éƒ¨åˆ†ä¸­æ‰¾åˆ°å¦‚ä½•ä½¿ç”¨GuiceApplicationBuilderã€‚ 1234567891011121314import play.api.ApplicationLoaderimport play.api.Configurationimport play.api.inject._import play.api.inject.guice._class CustomApplicationLoader extends GuiceApplicationLoader() { override def builder(context: ApplicationLoader.Context): GuiceApplicationBuilder = { val extra = Configuration(&quot;a&quot; -&gt; 1) initialBuilder .in(context.environment) .loadConfig(extra ++ context.initialConfiguration) .overrides(overrides(context): _*) }} å½“æ‚¨è¦†ç›–ApplicationLoaderæ—¶ï¼Œæ‚¨éœ€è¦å‘Šè¯‰Playã€‚ å°†ä»¥ä¸‹è®¾ç½®æ·»åŠ åˆ°application.confï¼š play.application.loader =â€œmodules.CustomApplicationLoaderâ€æ‚¨ä¸ä»…é™äºä½¿ç”¨Guiceè¿›è¡Œä¾èµ–æ³¨å…¥ã€‚ é€šè¿‡é‡å†™ApplicationLoaderï¼Œæ‚¨å¯ä»¥æ§åˆ¶åº”ç”¨ç¨‹åºçš„åˆå§‹åŒ–æ–¹å¼ã€‚ åœ¨ä¸‹ä¸€èŠ‚ä¸­äº†è§£æ›´å¤šä¿¡æ¯ã€‚","link":"/p/87290a79.html"}],"tags":[{"name":"angular","slug":"angular","link":"/tags/angular/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","link":"/tags/%E5%89%8D%E7%AB%AF/"},{"name":"JavaScript","slug":"JavaScript","link":"/tags/JavaScript/"},{"name":"java","slug":"java","link":"/tags/java/"},{"name":"Dubbo","slug":"Dubbo","link":"/tags/Dubbo/"},{"name":"etcd","slug":"etcd","link":"/tags/etcd/"},{"name":"Java","slug":"Java","link":"/tags/Java/"},{"name":"Spring","slug":"Spring","link":"/tags/Spring/"},{"name":"git","slug":"git","link":"/tags/git/"},{"name":"hexo","slug":"hexo","link":"/tags/hexo/"},{"name":"Nginx","slug":"Nginx","link":"/tags/Nginx/"},{"name":"Linux","slug":"Linux","link":"/tags/Linux/"},{"name":"Scala","slug":"Scala","link":"/tags/Scala/"},{"name":"Play","slug":"Play","link":"/tags/Play/"},{"name":"rocketmq","slug":"rocketmq","link":"/tags/rocketmq/"},{"name":"spring","slug":"spring","link":"/tags/spring/"},{"name":"Docker","slug":"Docker","link":"/tags/Docker/"},{"name":"Zookeeper","slug":"Zookeeper","link":"/tags/Zookeeper/"}],"categories":[{"name":"å‰ç«¯","slug":"å‰ç«¯","link":"/categories/%E5%89%8D%E7%AB%AF/"},{"name":"java","slug":"java","link":"/categories/java/"},{"name":"Dubbo","slug":"Dubbo","link":"/categories/Dubbo/"},{"name":"angular","slug":"å‰ç«¯/angular","link":"/categories/%E5%89%8D%E7%AB%AF/angular/"},{"name":"Java","slug":"Java","link":"/categories/Java/"},{"name":"JavaScript","slug":"å‰ç«¯/JavaScript","link":"/categories/%E5%89%8D%E7%AB%AF/JavaScript/"},{"name":"hexo","slug":"hexo","link":"/categories/hexo/"},{"name":"Nginx","slug":"Nginx","link":"/categories/Nginx/"},{"name":"Play","slug":"Play","link":"/categories/Play/"},{"name":"rocketmq","slug":"java/rocketmq","link":"/categories/java/rocketmq/"},{"name":"Scala","slug":"Scala","link":"/categories/Scala/"},{"name":"Linux","slug":"Nginx/Linux","link":"/categories/Nginx/Linux/"},{"name":"Spring","slug":"Java/Spring","link":"/categories/Java/Spring/"},{"name":"springä¸“é¢˜","slug":"java/springä¸“é¢˜","link":"/categories/java/spring%E4%B8%93%E9%A2%98/"},{"name":"Docker","slug":"Docker","link":"/categories/Docker/"}]}