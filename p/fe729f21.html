<!doctype html><html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta><title>ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (ä¸‰) Asynchronous results - éæ™®é€šç¨‹åºå‘˜</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="éæ™®é€šç¨‹åºå‘˜"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="éæ™®é€šç¨‹åºå‘˜"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="æœ¬ç« æˆ‘ä»¬å°†è®²è§£ä½¿ç”¨ Play è¿›è¡Œå¼‚æ­¥éé˜»å¡ç¼–ç¨‹æƒ…å†µä¸‹ï¼Œå¦‚ä½•å¤„ç†å¼‚æ­¥è¿”å›ç»“æœçš„é—®é¢˜ã€‚"><meta property="og:type" content="blog"><meta property="og:title" content="ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (ä¸‰) Asynchronous results"><meta property="og:url" content="http://leihuazhe.github.io/p/fe729f21.html"><meta property="og:site_name" content="éæ™®é€šç¨‹åºå‘˜"><meta property="og:description" content="æœ¬ç« æˆ‘ä»¬å°†è®²è§£ä½¿ç”¨ Play è¿›è¡Œå¼‚æ­¥éé˜»å¡ç¼–ç¨‹æƒ…å†µä¸‹ï¼Œå¦‚ä½•å¤„ç†å¼‚æ­¥è¿”å›ç»“æœçš„é—®é¢˜ã€‚"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://leihuazhe.github.io/img/og_image.png"><meta property="article:published_time" content="2018-12-16T16:00:00.000Z"><meta property="article:modified_time" content="2021-05-06T04:35:14.653Z"><meta property="article:author" content="Zane Ray"><meta property="article:tag" content="Scala"><meta property="article:tag" content="Play"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://leihuazhe.github.io/p/fe729f21.html"},"headline":"éæ™®é€šç¨‹åºå‘˜","image":["http://leihuazhe.github.io/img/og_image.png"],"datePublished":"2018-12-16T16:00:00.000Z","dateModified":"2021-05-06T04:35:14.653Z","author":{"@type":"Person","name":"Zane Ray"},"description":"æœ¬ç« æˆ‘ä»¬å°†è®²è§£ä½¿ç”¨ Play è¿›è¡Œå¼‚æ­¥éé˜»å¡ç¼–ç¨‹æƒ…å†µä¸‹ï¼Œå¦‚ä½•å¤„ç†å¼‚æ­¥è¿”å›ç»“æœçš„é—®é¢˜ã€‚"}</script><link rel="canonical" href="http://leihuazhe.github.io/p/fe729f21.html"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/github.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/maple.png" alt="éæ™®é€šç¨‹åºå‘˜" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">ä¸»é¡µ</a><a class="navbar-item" href="/archives">å½’æ¡£</a><a class="navbar-item" href="/categories">åˆ†ç±»</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/about">å…³äºæˆ‘</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/leihuazhe"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="ç›®å½•" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal"><i class="fa fa-bolt" aria-hidden="true"></i> ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (ä¸‰) Asynchronous results</h1><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><i class="far fa-calendar-alt">Â </i><time datetime="${date_xml(page.date)}" title="${date_xml(page.date)}">2018-12-17</time></span><span class="level-item is-hidden-mobile"><i class="far fa-calendar-check">Â </i><time datetime="${date_xml(page.updated)}" title="${date_xml(page.updated)}">2021-05-06</time></span><span class="level-item"><a class="link-muted" href="/categories/Play/">Play</a></span><span class="level-item">14 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦2145ä¸ªå­—)</span></div></div><div class="content"><blockquote><p>æœ¬ç« æˆ‘ä»¬å°†è®²è§£ä½¿ç”¨ Play è¿›è¡Œå¼‚æ­¥éé˜»å¡ç¼–ç¨‹æƒ…å†µä¸‹ï¼Œå¦‚ä½•å¤„ç†å¼‚æ­¥è¿”å›ç»“æœçš„é—®é¢˜ã€‚</p></blockquote><h2 id="Handling-asynchronous-results"><a href="#Handling-asynchronous-results" class="headerlink" title="Handling asynchronous results"></a>Handling asynchronous results</h2><blockquote><p>ä»ç°åœ¨å¼€å§‹æˆ‘ä»¬å°†è¿›å…¥å¼‚æ­¥ <code>http</code> ç¼–ç¨‹æ¨¡å—ï¼Œæœ¬ç« å°†ä¼šä»‹ç»å¦‚ä½•å¤„ç†å¼‚æ­¥è¿”å›ç»“æœã€‚</p></blockquote><h3 id="Make-controllers-asynchronous"><a href="#Make-controllers-asynchronous" class="headerlink" title="Make controllers asynchronous"></a>Make controllers asynchronous</h3><blockquote><p>ä½¿ controllers å˜ä¸ºå¼‚æ­¥çš„</p></blockquote><p>åœ¨ <code>Play Framework</code> å†…éƒ¨ï¼Œå…¶æœºåˆ¶æ˜¯è‡ªåº•å‘ä¸Šå…¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼çš„ï¼ŒPlay ä¼šä»¥å¼‚æ­¥ã€éé˜»å¡çš„æ–¹å¼å¤„ç†æ¯ä¸ªè¯·æ±‚ã€‚</p><p>é»˜è®¤é…ç½®(<code>configuration</code>) é’ˆå¯¹å¼‚æ­¥æ§åˆ¶å™¨(<code>asynchronous controllers</code>) è¿›è¡Œäº†ä¼˜åŒ–ã€‚æ¢å¥è¯è¯´ï¼Œåº”ç”¨ç¨‹åºä»£ç åº”è¯¥å°½é‡é¿å…åœ¨æ§åˆ¶å™¨ä¸­è¿›è¡Œé˜»å¡,è¿™æ ·ä¼šå¯¼è‡´æ§åˆ¶å™¨ä¸€ç›´ç­‰å¾…é‚£ä¸ªé˜»å¡çš„æ“ä½œã€‚æ­¤ç±»é˜»å¡æ“ä½œçš„å¸¸è§ç¤ºä¾‹æœ‰JDBCè°ƒç”¨ã€æµAPIã€HTTPè¯·æ±‚å’Œé•¿è®¡ç®—ç­‰ã€‚</p><p>è™½ç„¶å¯ä»¥å¢åŠ é»˜è®¤ <code>executionContext</code> ä¸­çº¿ç¨‹çš„æ•°é‡ï¼Œä»¥å…è®¸é˜»å¡æ§åˆ¶å™¨å¤„ç†æ›´å¤šçš„å¹¶å‘è¯·æ±‚ï¼Œä½†æ˜¯éµå¾ªå»ºè®®çš„ä¿æŒæ§åˆ¶å™¨å¼‚æ­¥çš„æ–¹æ³•å¯ä»¥æ›´å®¹æ˜“åœ°è¿›è¡Œæ‰©å±•ï¼Œå¹¶åœ¨è´Ÿè½½ä¸‹ä¿æŒç³»ç»Ÿå“åº”ã€‚</p><h3 id="Creating-non-blocking-actions"><a href="#Creating-non-blocking-actions" class="headerlink" title="Creating non-blocking actions"></a>Creating non-blocking actions</h3><blockquote><p>åˆ›å»ºéé˜»å¡çš„ <code>actions</code></p></blockquote><p>ç”±äº <code>Play</code> çš„å·¥ä½œæ–¹å¼ï¼Œ<code>action</code> ä»£ç å¿…é¡»å°½å¯èƒ½å¿«ï¼Œå³éé˜»å¡ã€‚é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿˜æ²¡æœ‰ç”Ÿæˆç»“æœæƒ…å½¢ä¸‹ï¼Œå¦‚ä½•è¿”å›ç»“æœå‘¢?ç­”æ¡ˆæ˜¯ä½¿ç”¨ <code>Future</code>ã€‚</p><p>A <code>Future[Result]</code> will eventually be redeemed with a value of type <code>Result</code>.</p><p>By giving a <code>Future[Result]</code> instead of a normal <code>Result</code>, we are able to quickly generate the result without blocking.</p><p>Play will then serve the result as soon as the promise is redeemed.</p><p>The web client will be blocked while waiting for the response, but nothing will be blocked on the server, and server resources can be used to serve other clients.</p><p>Using a <code>Future</code> is only half of the picture though!</p><blockquote><p>ç„¶è€Œï¼Œä½¿ç”¨<code>Future</code>åªæ˜¯è¿™å¹…ç”»çš„ä¸€åŠ. (ä½¿ç”¨ Future åªæ˜¯ Play å¼‚æ­¥ç¼–ç¨‹çš„ä¸€åŠ)</p></blockquote><p>If you are calling out to a blocking API such as JDBC,then you still will need to have your ExecutionStage(<code>æ‰§è¡Œé˜¶æ®µ</code>) run with a different executor, to move it off Playâ€™s rendering thread pool.</p><p>You can do this by creating a subclass of <code>play.api.libs.concurrent.CustomExecutionContext</code>with a reference to the <a target="_blank" rel="noopener" href="https://doc.akka.io/docs/akka/2.5/dispatchers.html?language=scala">custom dispatcher</a>.</p><blockquote><p>è¿™é‡Œæ„æ€æ˜¯å¦‚æœé’ˆå¯¹é•¿æ—¶é—´é˜»å¡çš„ä»»åŠ¡ï¼Œæ¯”å¦‚JDBCï¼Œåƒä¸Šè¿°æ–¹å¼æ“ä½œï¼Œæˆ‘ä»¬åªä¸è¿‡æ˜¯æŠŠå½“å‰ä»»åŠ¡çš„æ‰§è¡Œæ”¾åˆ°äº†å¦å¤–ä¸€æ¡çº¿ç¨‹ä¸­ç»§ç»­é˜»å¡äº†è€Œå·²ï¼Œå› æ­¤ä»ç„¶æ˜¯å‡å¼‚æ­¥ã€‚è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è‡ªå®šä¹‰çš„<code>CustomExecutionContext</code></p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> play.api.libs.concurrent.<span class="type">CustomExecutionContext</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯·ç¡®ä¿ä½¿ç”¨&quot;Scala Dependency Injection&quot;æ–‡æ¡£é¡µé¢ä¸­åˆ—å‡ºçš„ custom binding æŠ€æœ¯ä¹‹ä¸€</span></span><br><span class="line"><span class="comment">//å°† new context ç»‘å®šåˆ°å½“å‰ trait </span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">MyExecutionContext</span> <span class="keyword">extends</span> <span class="title">ExecutionContext</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">MyExecutionContextImpl</span> <span class="title">@Inject</span>(<span class="params"></span>)(<span class="params">system: <span class="type">ActorSystem</span></span>)</span></span><br><span class="line"><span class="class">  <span class="keyword">extends</span> <span class="title">CustomExecutionContext</span>(<span class="params">system, &quot;my.executor&quot;</span>) <span class="keyword">with</span> <span class="title">MyExecutionContext</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">HomeController</span> <span class="title">@Inject</span>(<span class="params"></span>)(<span class="params">myExecutionContext: <span class="type">MyExecutionContext</span>, val controllerComponents: <span class="type">ControllerComponents</span></span>) <span class="keyword">extends</span> <span class="title">BaseController</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">index</span> </span>= <span class="type">Action</span>.async &#123;</span><br><span class="line">    <span class="type">Future</span> &#123;</span><br><span class="line">      <span class="comment">// Call some blocking API</span></span><br><span class="line">      <span class="type">Ok</span>(<span class="string">&quot;result of blocking call&quot;</span>)</span><br><span class="line">    &#125;(myExecutionContext)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="How-to-create-a-Future-Result"><a href="#How-to-create-a-Future-Result" class="headerlink" title="How to create a Future[Result]"></a>How to create a Future[Result]</h3><blockquote><p>è¦åˆ›å»ºä¸€ä¸ª <code>Future[Result]</code>ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¦ä¸€ä¸ª<code>future</code>, è¿™ä¸ª <code>future</code> ä¼šç»™æˆ‘ä»¬è¿”å›æˆ‘ä»¬éœ€è¦è®¡ç®—çš„å®é™…çš„ç»“æœã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> futurePIValue: <span class="type">Future</span>[<span class="type">Double</span>] = computePIAsynchronously()</span><br><span class="line"><span class="keyword">val</span> futureResult: <span class="type">Future</span>[<span class="type">Result</span>] = futurePIValue.map &#123; pi =&gt;</span><br><span class="line">  <span class="type">Ok</span>(<span class="string">&quot;PI value computed: &quot;</span> + pi)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>All of Playâ€™s asynchronous API calls give you a <code>Future</code>. This is the case whether you are calling an external web service using the <code>play.api.libs.WS</code> API, or using Akka to schedule asynchronous tasks or to communicate with actors using <code>play.api.libs.Akka</code>.</p><blockquote><p><code>PlayFramework</code> æ‰€æœ‰å¼‚æ­¥çš„ <code>API</code> è¿”å›çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ª <code>Future</code>ï¼Œæ— è®ºä½ æ˜¯é€šè¿‡ <code>play.api.libs.WS</code> API è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨çš„ <code>web</code> æœåŠ¡ï¼Œæˆ–è€…ä½¿ç”¨Akkaè°ƒåº¦å¼‚æ­¥ä»»åŠ¡ï¼Œæˆ–è€…ä½¿ç”¨ <code>play. API .lib .Akka</code>ä¸ <code>actor</code> é€šä¿¡ç­‰ç­‰ï¼Œè¿”å›éƒ½æ˜¯ <code>Future</code>ã€‚</p></blockquote><p>ä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡å¼‚æ­¥æ¨¡å¼æ‰§è¡Œä¸€æ®µé˜»å¡çš„ä»£ç ï¼Œå¹¶è¿”å›ä¸€ä¸ª Future ç®€å•çš„ä¾‹å­</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> futureInt: <span class="type">Future</span>[<span class="type">Int</span>] = scala.concurrent.<span class="type">Future</span> &#123;</span><br><span class="line">  intensiveComputation()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h4><p>Itâ€™s important to understand which thread code runs on with futures. In the two code blocks above, there is an import on Plays default execution context. This is an implicit parameter that gets passed to all methods on the future API that accept callbacks. The execution context will often be equivalent to a thread pool, though not necessarily.</p><blockquote><p>ç†è§£å“ªäº›çº¿ç¨‹ä»£ç åœ¨ Future ä¸Šè¿è¡Œæ˜¯å¾ˆé‡è¦çš„ã€‚åœ¨ä¸Šé¢çš„ä¸¤ä¸ªä»£ç å—ä¸­ï¼Œåœ¨ Play é»˜è®¤ executionContext ä¸Šæœ‰ä¸€ä¸ªå¯¼å…¥ã€‚è¿™æ˜¯ä¸€ä¸ªéšå¼å‚æ•°ï¼Œä¼ é€’ç»™ future APIä¸Šæ‰€æœ‰æ¥å—å›è°ƒçš„æ–¹æ³•ã€‚executionContext é€šå¸¸ç­‰ä»·äºçº¿ç¨‹æ± ï¼Œä½†ä¹Ÿä¸ä¸€å®šã€‚</p></blockquote><p>You canâ€™t magically turn synchronous IO into asynchronous by wrapping it in a <code>Future</code>. If you canâ€™t change the applicationâ€™s architecture to avoid blocking operations, at some point that operation will have to be executed, and that thread is going to block. So in addition to enclosing the operation in a <code>Future</code>, itâ€™s necessary to configure it to run in a separate execution context that has been configured with enough threads to deal with the expected concurrency. See <a target="_blank" rel="noopener" href="https://www.playframework.com/documentation/2.6.x/ThreadPools">Understanding Play thread pools</a> for more information, and download the <a target="_blank" rel="noopener" href="https://playframework.com/download#examples">play example templates</a> that show database integration.</p><blockquote><p>ä½ ä¸èƒ½é€šè¿‡å°†ä»£ç å—åŒ…è£…åœ¨ä¸€ä¸ª Futureä¸‹æ¥ç¥å¥‡åœ°æŠŠ<strong>åŒæ­¥IO</strong>å˜æˆå¼‚æ­¥çš„ã€‚å¦‚æœæ‚¨ä¸èƒ½æ›´æ”¹åº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„ä»¥é¿å…é˜»å¡æ“ä½œï¼Œé‚£ä¹ˆåœ¨æŸä¸ªæ—¶åˆ»ï¼Œè¯¥æ“ä½œå°†ä¸å¾—ä¸æ‰§è¡Œï¼Œè€Œè¯¥çº¿ç¨‹å°†é˜»å¡ã€‚</p><p>å› æ­¤ï¼Œé™¤äº†å°†æ“ä½œå°è£…åœ¨ <code>Future</code> ä¸­ä¹‹å¤–ï¼Œè¿˜éœ€è¦å°†å…¶é…ç½®ä¸ºåœ¨ä¸€ä¸ªå•ç‹¬çš„ <code>executionContext</code> ä¸­è¿è¡Œï¼Œè¯¥ä¸Šä¸‹æ–‡ä¸­å·²ç»é…ç½®äº†è¶³å¤Ÿçš„çº¿ç¨‹æ¥å¤„ç†é¢„æœŸçš„å¹¶å‘ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a target="_blank" rel="noopener" href="https://www.playframework.com/documentation/2.6.x/ThreadPools">äº†è§£Playçº¿ç¨‹æ± </a>ï¼Œå¹¶ä¸‹è½½æ˜¾ç¤ºæ•°æ®åº“é›†æˆçš„<a target="_blank" rel="noopener" href="https://playframework.com/download#example">Playç¤ºä¾‹æ¨¡æ¿</a></p></blockquote><p>It can also be helpful to use Actors for blocking operations.</p><p>Actors provide a clean model for handling timeouts and failures, setting up blocking execution contexts, and managing any state that may be associated with the service.</p><p>Also Actors provide patterns like <code>ScatterGatherFirstCompletedRouter</code> to address simultaneous cache and database requests and allow remote execution on a cluster of backend servers. But an Actor may be overkill depending on what you need.</p><blockquote><p>å¯¹äºé˜»å¡æ“ä½œåœºæ™¯ï¼Œä½¿ç”¨ Actors æ¨¡å¼æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚<code>Actors</code> æä¾›äº†ä¸€ä¸ªç®€å•ä¸€ä¸ªç®€å•çš„æ¨¡å‹ï¼Œæ¥å¤„ç†è¶…æ—¶ã€æ•…éšœã€è®¾ç½®é˜»å¡çš„ <code>executionContext</code> ä»¥åŠä¸æœåŠ¡å…³è”çš„ä»»ä½•çŠ¶æ€ã€‚</p><p>Actors è¿˜æä¾›äº†åƒ â€œScatterGatherFirstCompletedRouterâ€ è¿™æ ·çš„æ¨¡å¼æ¥å¤„ç†åŒæ­¥ç¼“å­˜å’Œæ•°æ®åº“è¯·æ±‚ï¼Œå¹¶å…è®¸åœ¨åç«¯æœåŠ¡å™¨é›†ç¾¤ä¸Šè¿œç¨‹æ‰§è¡Œã€‚ä½†æ˜¯ä¸€ä¸ª actor å¯èƒ½ä¼šå› ä¸ºä½ çš„éœ€è¦è€Œ overkillã€‚</p></blockquote><h3 id="Returning-futures"><a href="#Returning-futures" class="headerlink" title="Returning futures"></a>Returning futures</h3><blockquote><p>è¿”å› futures</p></blockquote><p>While we were using the <code>Action.apply</code> builder method to build actions until now, to send an asynchronous result we need to use the <code>Action.async</code> builder method:</p><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>Action.apply</code> æ—¶ï¼Œå°† <code>builder</code> æ–¹æ³•åº”ç”¨äº <code>actions</code> ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¦å‘é€å¼‚æ­¥ç»“æœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¼‚æ­¥çš„ Actiton builder æ–¹æ³•</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span> </span>= <span class="type">Action</span>.async &#123;</span><br><span class="line">  <span class="keyword">val</span> futureInt = scala.concurrent.<span class="type">Future</span> &#123; intensiveComputation() &#125;</span><br><span class="line">  futureInt.map(i =&gt; <span class="type">Ok</span>(<span class="string">&quot;Got result: &quot;</span> + i))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Actions-are-asynchronous-by-default"><a href="#Actions-are-asynchronous-by-default" class="headerlink" title="Actions are asynchronous by default"></a>Actions are asynchronous by default</h3><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Actions</code> æ˜¯å¼‚æ­¥çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„æ§åˆ¶å™¨ä»£ç ä¸­ï¼Œä»£ç çš„<code>&#123;Ok(â€¦)&#125;</code> éƒ¨åˆ†ä¸æ˜¯æ§åˆ¶å™¨çš„æ–¹æ³•ä½“ã€‚å®ƒæ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¢«ä¼ é€’ç»™ <code>Action</code> å¯¹è±¡çš„ <code>apply</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ª <code>Action</code> ç±»å‹çš„å¯¹è±¡ã€‚åœ¨å†…éƒ¨ï¼Œæ‚¨ç¼–å†™çš„åŒ¿åå‡½æ•°å°†è¢«è°ƒç”¨ï¼Œå…¶ç»“æœå°†è¿”å›åœ¨ <code>Future</code>ä¸­ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo</span> </span>= <span class="type">Action</span> &#123; request =&gt;</span><br><span class="line">  <span class="type">Ok</span>(<span class="string">&quot;Got request [&quot;</span> + request + <span class="string">&quot;]&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Note:</strong> Both <code>Action.apply</code> and <code>Action.async</code> create <code>Action</code> objects that are handled internally in the same way. There is a single kind of <code>Action</code>, which is asynchronous, and not two kinds (a synchronous one and an asynchronous one). The <code>.async</code> builder is just a facility to simplify creating actions based on APIs that return a <code>Future</code>, which makes it easier to write non-blocking code.</p><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p><code>Action.apply</code> å’Œ <code>Action.async</code> åœ¨å†…éƒ¨éƒ½ä»¥ç›¸åŒçš„æ–¹å¼æ¥å¤„ç† <code>Action</code> å¯¹è±¡ã€‚</p><p>æœ‰ä¸€ç§å•ç‹¬çš„ Actionï¼Œå®ƒæ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯ä¸æ˜¯a synchronous one and an asynchronous one ä¸­çš„ä¸€ç§ã€‚</p><p><code>.async</code> builderåªæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºåœ¨åˆ›å»º <code>actions</code> æ—¶åŸºäºè¿”å› <code>Future</code> result çš„ api çš„æ“ä½œè¿›è¡Œç®€åŒ–ï¼Œè¿™ä½¿å¾—ç¼–å†™éé˜»å¡ä»£ç æ›´åŠ å®¹æ˜“ã€‚</p><h3 id="Handling-time-outs"><a href="#Handling-time-outs" class="headerlink" title="Handling time-outs"></a>Handling time-outs</h3><blockquote><p>å¤„ç†è¶…æ—¶æƒ…å†µ</p></blockquote><p>æ­£ç¡®å¤„ç†è¶…æ—¶ï¼Œé¿å… <code>web</code> æµè§ˆå™¨é˜»å¡å¹¶åœ¨å‡ºç°é—®é¢˜æ—¶ç­‰å¾…ï¼Œè¿™é€šå¸¸å¾ˆæœ‰ç”¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>play.api.libs.concurrent.Futures</code> æ¥å°†éé˜»å¡çš„è¶…æ—¶åŒ…è£…åœ¨ä¸€ä¸ª <code>Futures</code> ä¸­</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.concurrent.duration._</span><br><span class="line"><span class="keyword">import</span> play.api.libs.concurrent.<span class="type">Futures</span>._</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span> </span>= <span class="type">Action</span>.async &#123;</span><br><span class="line">  <span class="comment">// ä½ å¯ä»¥éšå¼çš„æä¾›ä¸€ä¸ªè¶…æ—¶å‚æ•°ï¼Œè¿™é¢˜å“¦ä½ æ­Œå”±å¯ä»¥é€šè¿‡controllerçš„æ„é€ å‚æ•°æ¥è¾¾åˆ°ã€‚</span></span><br><span class="line">  intensiveComputation().withTimeout(<span class="number">1.</span>seconds).map &#123; i =&gt;</span><br><span class="line">    <span class="type">Ok</span>(<span class="string">&quot;Got result: &quot;</span> + i)</span><br><span class="line">  &#125;.recover &#123;</span><br><span class="line">    <span class="keyword">case</span> e: scala.concurrent.<span class="type">TimeoutException</span> =&gt;</span><br><span class="line">      <span class="type">InternalServerError</span>(<span class="string">&quot;timeout&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ³¨æ„-1"><a href="#æ³¨æ„-1" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>è¶…æ—¶(Timeout)ä¸å–æ¶ˆ(cancellation) æ˜¯ä¸åŒçš„ã€‚å¯¹äºè¶…æ—¶è€Œè¨€ï¼Œå³ä½¿å‡ºç°äº†è¶…æ—¶ï¼Œç»™å®šçš„ <code>Future</code> ä»ç„¶ä¼šå®Œæˆï¼Œå³ä½¿æœªè¿”å›å·²å®Œæˆçš„å€¼ã€‚</p></div><div class="article-licensing box"><div class="licensing-title"><p>ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (ä¸‰) Asynchronous results</p><p><a href="http://leihuazhe.github.io/p/fe729f21.html">http://leihuazhe.github.io/p/fe729f21.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>ä½œè€…</h6><p>Zane Ray</p></div></div><div class="level-item is-narrow"><div><h6>å‘å¸ƒäº</h6><p>2018-12-17</p></div></div><div class="level-item is-narrow"><div><h6>æ›´æ–°äº</h6><p>2021-05-06</p></div></div><div class="level-item is-narrow"><div><h6>è®¸å¯åè®®</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><hr style="height:1px;margin:1rem 0"><div class="level is-mobile is-flex"><div class="article-tags is-size-7 is-uppercase"><i class="fas fa-tags has-text-grey"></i>Â <a class="link-muted" rel="tag" href="/tags/Scala/">Scala, </a><a class="link-muted" rel="tag" href="/tags/Play/">Play</a></div></div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Ÿæ‰“èµä¸€ä¸‹ä½œè€…å§</h3><div class="buttons is-centered"><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>å¾®ä¿¡</span><span class="qrcode"><img src="/img/gathering_qr.png" alt="å¾®ä¿¡"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/p/87290a79.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (äº”) Dependency Injection</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/p/beeb0951.html"><span class="level-item">ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (äºŒ) Action Composition</span><i class="level-item fas fa-chevron-right"></i></a></div></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen order-1"><div class="card widget"><link href="/music/APlayer.min.css"><div id="aplayer" style="margin:0 auto"></div><script src="/music/APlayer.min.js"></script><script src="/music/APlayer_Music.js"></script></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">ç›®å½•</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Handling-asynchronous-results"><span class="level-left"><span class="level-item">1</span><span class="level-item">Handling asynchronous results</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Make-controllers-asynchronous"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">Make controllers asynchronous</span></span></a></li><li><a class="level is-mobile" href="#Creating-non-blocking-actions"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">Creating non-blocking actions</span></span></a></li><li><a class="level is-mobile" href="#How-to-create-a-Future-Result"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">How to create a Future[Result]</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#æ³¨æ„ç‚¹"><span class="level-left"><span class="level-item">1.3.1</span><span class="level-item">æ³¨æ„ç‚¹</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Returning-futures"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">Returning futures</span></span></a></li><li><a class="level is-mobile" href="#Actions-are-asynchronous-by-default"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">Actions are asynchronous by default</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#æ³¨æ„"><span class="level-left"><span class="level-item">1.5.1</span><span class="level-item">æ³¨æ„</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Handling-time-outs"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">Handling time-outs</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#æ³¨æ„-1"><span class="level-left"><span class="level-item">1.6.1</span><span class="level-item">æ³¨æ„</span></span></a></li></ul></li></ul></li></ul></div></div><style>#toc .menu-list>li>a.is-active+.menu-list{display:block}#toc .menu-list>li>a+.menu-list{display:none}</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><figure class="media-left"><a class="image" href="/p/ac45747d.html"><img src="/gallery/covers/56_1.jpg" alt="Spring å­¦ä¹  [1]"></a></figure><div class="media-content"><p class="date"><time datetime="2021-05-07T02:54:53.000Z">2021-05-07</time></p><p class="title"><a href="/p/ac45747d.html">Spring å­¦ä¹  [1]</a></p><p class="categories"><a href="/categories/Scala/">Scala</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/p/a8949b93.html"><img src="/gallery/covers/56_1.jpg" alt="Scalaå®æˆ˜ -- å¯¹Listä¸­çš„éƒ¨åˆ†å…ƒç´ è¿›è¡Œåˆå¹¶æ“ä½œ"></a></figure><div class="media-content"><p class="date"><time datetime="2019-04-01T11:43:12.000Z">2019-04-01</time></p><p class="title"><a href="/p/a8949b93.html">Scalaå®æˆ˜ -- å¯¹Listä¸­çš„éƒ¨åˆ†å…ƒç´ è¿›è¡Œåˆå¹¶æ“ä½œ</a></p><p class="categories"><a href="/categories/Scala/">Scala</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2019-01-09T16:00:00.000Z">2019-01-10</time></p><p class="title"><a href="/p/6e951315.html">ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (äº”) 2.5.x ç‰ˆæœ¬è‡ªå®šä¹‰ Action</a></p><p class="categories"><a href="/categories/Play/">Play</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2018-12-24T16:00:00.000Z">2018-12-25</time></p><p class="title"><a href="/p/87290a79.html">ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (äº”) Dependency Injection</a></p><p class="categories"><a href="/categories/Play/">Play</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time datetime="2018-12-16T16:00:00.000Z">2018-12-17</time></p><p class="title"><a href="/p/fe729f21.html">ğŸ® Play å…¥é—¨ä¸å­¦ä¹ (ä¸‰) Asynchronous results</a></p><p class="categories"><a href="/categories/Play/">Play</a></p></div></article></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dubbo/"><span class="tag">Dubbo</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Play/"><span class="tag">Play</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scala/"><span class="tag">Scala</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Zookeeper/"><span class="tag">Zookeeper</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/angular/"><span class="tag">angular</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/etcd/"><span class="tag">etcd</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/java/"><span class="tag">java</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/rocketmq/"><span class="tag">rocketmq</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring/"><span class="tag">spring</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">å‰ç«¯</span><span class="tag">2</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/maple.png" alt="éæ™®é€šç¨‹åºå‘˜" height="28"></a><p class="is-size-7"><span>&copy; 2021 Zane Ray</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN")</script><script>var IcarusThemeSettings={article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){loadInsight({contentUrl:"/content.json"},{hint:"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...",untitled:"(æ— æ ‡é¢˜)",posts:"æ–‡ç« ",pages:"é¡µé¢",categories:"åˆ†ç±»",tags:"æ ‡ç­¾"})})</script><script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script></body></html>